(()=>{var t={6313:t=>{var e=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,r,n;try{e=Map}catch(t){e=function(){}}try{r=Set}catch(t){r=function(){}}try{n=Promise}catch(t){n=function(){}}function i(s,a,l,c,u){"object"==typeof a&&(l=a.depth,c=a.prototype,u=a.includeNonEnumerable,a=a.circular);var h=[],d=[],f="undefined"!=typeof Buffer;return void 0===a&&(a=!0),void 0===l&&(l=1/0),function s(l,p){if(null===l)return null;if(0===p)return l;var y,v;if("object"!=typeof l)return l;if(t(l,e))y=new e;else if(t(l,r))y=new r;else if(t(l,n))y=new n((function(t,e){l.then((function(e){t(s(e,p-1))}),(function(t){e(s(t,p-1))}))}));else if(i.__isArray(l))y=[];else if(i.__isRegExp(l))y=new RegExp(l.source,o(l)),l.lastIndex&&(y.lastIndex=l.lastIndex);else if(i.__isDate(l))y=new Date(l.getTime());else{if(f&&Buffer.isBuffer(l))return y=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(y),y;t(l,Error)?y=Object.create(l):void 0===c?(v=Object.getPrototypeOf(l),y=Object.create(v)):(y=Object.create(c),v=c)}if(a){var g=h.indexOf(l);if(-1!=g)return d[g];h.push(l),d.push(y)}for(var m in t(l,e)&&l.forEach((function(t,e){var r=s(e,p-1),n=s(t,p-1);y.set(r,n)})),t(l,r)&&l.forEach((function(t){var e=s(t,p-1);y.add(e)})),l){var b;v&&(b=Object.getOwnPropertyDescriptor(v,m)),b&&null==b.set||(y[m]=s(l[m],p-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(l);for(m=0;m<w.length;m++){var I=w[m];(!(k=Object.getOwnPropertyDescriptor(l,I))||k.enumerable||u)&&(y[I]=s(l[I],p-1),k.enumerable||Object.defineProperty(y,I,{enumerable:!1}))}}if(u){var S=Object.getOwnPropertyNames(l);for(m=0;m<S.length;m++){var k,O=S[m];(k=Object.getOwnPropertyDescriptor(l,O))&&k.enumerable||(y[O]=s(l[O],p-1),Object.defineProperty(y,O,{enumerable:!1}))}}return y}(s,l)}function s(t){return Object.prototype.toString.call(t)}function o(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return i.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},i.__objToStr=s,i.__isDate=function(t){return"object"==typeof t&&"[object Date]"===s(t)},i.__isArray=function(t){return"object"==typeof t&&"[object Array]"===s(t)},i.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===s(t)},i.__getRegExpFlags=o,i}();t.exports&&(t.exports=e)},5643:t=>{t.exports=!1},4063:t=>{"use strict";t.exports=function t(e,r){if(e===r)return!0;if(e&&r&&"object"==typeof e&&"object"==typeof r){if(e.constructor!==r.constructor)return!1;var n,i,s;if(Array.isArray(e)){if((n=e.length)!=r.length)return!1;for(i=n;0!=i--;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if((n=(s=Object.keys(e)).length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,s[i]))return!1;for(i=n;0!=i--;){var o=s[i];if(!t(e[o],r[o]))return!1}return!0}return e!=e&&r!=r}},9134:t=>{t.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}},6898:t=>{"use strict";t.exports=t=>!!t&&("symbol"==typeof Symbol.observable&&"function"==typeof t[Symbol.observable]?t===t[Symbol.observable]():"function"==typeof t["@@observable"]&&t===t["@@observable"]())},7996:function(t,e){var r,n,i;n=[],void 0===(i="function"==typeof(r=function(){return function(){function t(t,e){if(this.app="loki",this.options=e||{},void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,(function(t){if("function"==typeof r){if(0===t.id)return void r(null);r(t.val)}else console.log(t.val)})):this.catalog=new e((function(e){i.catalog=e,i.loadDatabase(t,r)}))},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,r,n){var i=this.app,s=this;function o(t){t&&!0===t.success?n(null):n(new Error("Error saving database")),s.options.closeAfterSave&&s.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(i,t,r,o):this.catalog=new e((function(e){s.saveDatabase(t,r,o)}))},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,(function(t){var e=t.id;0!==e?i.catalog.deleteAppKey(e,r):"function"==typeof r&&r({success:!0})})):this.catalog=new e((function(e){i.catalog=e,i.deleteDatabase(t,r)}))},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList((function(r){r.forEach((function(r){r.startsWith(t)&&e.deleteDatabase(r)}))}))},t.prototype.getDatabaseList=function(t){var r=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(r,(function(e){for(var r=[],n=0;n<e.length;n++)r.push(e[n].key);"function"==typeof t?t(r):r.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){n.catalog=e,n.getDatabaseList(t)}))},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys((function(e){for(var r,n,i,s,o,a=[],l=0;l<e.length;l++)i=(r=e[l]).app||"",s=r.key||"",o=r.val||"",n=2*i.length+2*s.length+o.length+1,a.push({app:r.app,key:r.key,size:n});"function"==typeof t?t(a):a.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){r.catalog=e,r.getCatalogSummary(t)}))},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),r=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var r=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});r.createIndex("app","app",{unique:!1}),r.createIndex("key","key",{unique:!1}),r.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){r.db=e.target.result,"function"==typeof t&&t(r)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,r){var n,i=t+","+e,s=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(i);s.onsuccess=(n=r,function(t){var e=t.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof n?n(e):console.log(e)}),s.onerror=function(t){return function(e){if("function"!=typeof t)throw e;t({id:0,success:!1})}}(r)},e.prototype.getAppKeyById=function(t,e,r){this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(t).onsuccess=function(t,e){return function(r){"function"==typeof e?e(r.target.result,t):console.log(r.target.result)}}(r,e)},e.prototype.setAppKey=function(t,e,r,n){var i,s=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),o=s.index("appkey"),a=t+","+e,l=o.get(a);l.onsuccess=function(i){var o=i.target.result;null==o?o={app:t,key:e,appkey:t+","+e,val:r}:o.val=r;var a,c=s.put(o);c.onerror=(a=n,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(l.error))}),c.onsuccess=function(t){return function(e){"function"==typeof t&&t({success:!0})}}(n)},l.onerror=(i=n,function(t){"function"==typeof i?i({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(l.error))})},e.prototype.deleteAppKey=function(t,e){var r,n=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(t);n.onsuccess=(r=e,function(t){"function"==typeof r&&r({success:!0})}),n.onerror=function(t){return function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(n.error))}}(e)},e.prototype.getAppKeys=function(t,e){var r,n=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),i=IDBKeyRange.only(t),s=n.openCursor(i),o=[];s.onsuccess=function(t,e){return function(r){var n=r.target.result;if(n){var i=n.value;t.push(i),n.continue()}else"function"==typeof e?e(t):console.log(t)}}(o,e),s.onerror=(r=e,function(t){"function"==typeof r?r(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,r=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor(),n=[];r.onsuccess=function(t,e){return function(r){var n=r.target.result;if(n){var i=n.value;t.push(i),n.continue()}else"function"==typeof e?e(t):console.log(t)}}(n,t),r.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t}()})?r.apply(e,n):r)||(t.exports=i)},3050:function(t,e,r){var n,i,s;i=[],n=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty;function e(t){var r,i;if(Array.isArray(t)){for(i=0;i<t.length;i++)e(t[i]);n(t)}else if(null!==t&&"object"==typeof t){for(r in t)t.hasOwnProperty(r)&&e(t[r]);n(t)}}function n(t){Object.isFrozen(t)||Object.freeze(t)}function i(t){return Object.isFrozen(t)?g(t,"shallow"):t}var s={copyProperties:function(t,e){var r;for(r in t)e[r]=t[r]},resolveTransformObject:function(t,e,r){var n,i;if("number"!=typeof r&&(r=0),++r>=10)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(i=t[n].substring(8),e.hasOwnProperty(i)&&(t[n]=e[i])):"object"==typeof t[n]&&(t[n]=s.resolveTransformObject(t[n],e,r));return t},resolveTransformParams:function(t,e){var r,n,i=[];if(void 0===e)return t;for(r=0;r<t.length;r++)n=g(t[r],"shallow-recurse-objects"),i.push(s.resolveTransformObject(n,e));return i},getIn:function(t,e,r){if(null!=t){if(!r)return t[e];if("string"==typeof e&&(e=e.split(".")),!Array.isArray(e))throw new Error("path must be a string or array. Found "+typeof e);for(var n=0,i=e.length;null!=t&&n<i;)t=t[e[n++]];return n&&n==i?t:void 0}}},o={aeq:a,lt:l,gt:c};function a(t,e){var r,n,i,s;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==i||9!==s)return i===s}return r=Number(t),n=Number(e),r==r||n==n?r===n:(r=t.toString())==(n=e.toString())}function l(t,e,r){var n,i,s,o;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==s||9!==o)return s===o?r:s<o}return n=Number(t),i=Number(e),n==n&&i==i?n<i||!(n>i)&&r:n==n&&i!=i||(i!=i||n==n)&&(t<e||!(t>e)&&(t==e?r:(n=t.toString())<(i=e.toString())||n==i&&r))}function c(t,e,r){var n,i,s,o;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==s||9!==o)return s===o?r:s>o}return n=Number(t),i=Number(e),n==n&&i==i?n>i||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||t>e||!(t<e)&&(t==e?r:(n=t.toString())>(i=e.toString())||n==i&&r))}function u(t,e,r){return o.aeq(t,e)?0:o.lt(t,e,!1)?r?1:-1:o.gt(t,e,!1)?r?-1:1:0}function h(t,e,r){for(var n,i,o,a,l,c=0,h=0,d=t.length;h<d;h++)if(~(i=(n=t[h])[0]).indexOf(".")?(l=i.split("."),o=s.getIn(e,l,!0),a=s.getIn(r,l,!0)):(o=e[i],a=r[i]),0!==(c=u(o,a,n[1])))return c;return 0}function d(t,e,r,n,i,s){var o,a=s||0,l=e[a],c=!1;if("object"==typeof t&&l in t&&(o=t[l]),a+1>=e.length)c=r(o,n,i);else if(Array.isArray(o))for(var u=0,h=o.length;u<h&&!0!==(c=d(o[u],e,r,n,i,a+1));u+=1);else c=d(o,e,r,n,i,a+1);return c}function f(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(r){return t.call(e,r)}:null}function p(e,r,n){for(var i in r)if(t.call(r,i))return y[i](e,r[i],n);return!1}var y={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return o.aeq(t,e)},$gt:function(t,e){return o.gt(t,e,!1)},$gte:function(t,e){return o.gt(t,e,!0)},$lt:function(t,e){return o.lt(t,e,!1)},$lte:function(t,e){return o.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&o.gt(t,e[0],!0)&&o.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$inSet:function(t,e){return e.has(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!y.$containsAny(t,e)},$containsAny:function(t,e){var r=f(t);return null!==r&&(Array.isArray(e)?e.some(r):r(e))},$contains:function(t,e){var r=f(t);return null!==r&&(Array.isArray(e)?e.every(r):r(e))},$elemMatch:function(t,e){return!!Array.isArray(t)&&t.some((function(t){return Object.keys(e).every((function(r){var n=e[r];return"object"==typeof n&&n||(n={$eq:n}),-1!==r.indexOf(".")?d(t,r.split("."),p,e[r],t):p(t[r],n,t)}))}))},$type:function(t,e,r){var n=typeof t;return"object"===n&&(Array.isArray(t)?n="array":t instanceof Date&&(n="date")),"object"!=typeof e?n===e:p(n,e,r)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e,r){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:p(t.length,e,r))},$len:function(t,e,r){return"string"==typeof t&&("object"!=typeof e?t.length===e:p(t.length,e,r))},$where:function(t,e){return!0===e(t)},$not:function(t,e,r){return!p(t,e,r)},$and:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(!p(t,e[n],r))return!1;return!0},$or:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(p(t,e[n],r))return!0;return!1},$exists:function(t,e){return e?void 0!==t:void 0===t}};["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach((function(t){var e=y[t];y["$"+t]=function(t,r,n){if("string"==typeof r)return e(t,n[r]);if("function"==typeof r)return e(t,r(n));throw new Error("Invalid argument to $$ matcher")}}));var v={$eq:y.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function g(t,e){if(null==t)return null;var r;switch(e||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},t);break;case"shallow":r=Object.create(t.constructor.prototype),Object.keys(t).map((function(e){r[e]=t[e]}));break;case"shallow-assign":r=Object.create(t.constructor.prototype),Object.assign(r,t);break;case"shallow-recurse-objects":r=g(t,"shallow"),Object.keys(t).forEach((function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?r[e]=g(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(r[e]=m(t[e],"shallow-recurse-objects"))}))}return r}function m(t,e){if("parse-stringify"==e)return g(t,e);for(var r=[],n=0,i=t.length;n<i;n++)r[n]=g(t[n],e);return r}function b(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function w(){}function I(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};var n=function(){return void 0!==r.g&&(r.g.android||r.g.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==r.g&&r.g.window&&"undefined"!=typeof process?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA"};e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=n(),"undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function S(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function k(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function O(){try{this.fs=r(693)}catch(t){this.fs=null}}function x(){}function C(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function _(t,e){if("$regex"===t)Array.isArray(e)?e=new RegExp(e[0],e[1]):e instanceof RegExp||(e=new RegExp(e));else if("object"==typeof e)for(var r in e)"$regex"!==r&&"object"!=typeof e[r]||(e[r]=_(r,e[r]));return e}function P(t,e,r){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new C(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function A(e,r){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var n=this;(r=r||{}).hasOwnProperty("unique")&&(Array.isArray(r.unique)||(r.unique=[r.unique]),r.unique.forEach((function(t){n.uniqueNames.push(t)}))),r.hasOwnProperty("exact")&&r.exact.forEach((function(t){n.constraints.exact[t]=new F(t)})),this.adaptiveBinaryIndices=!r.hasOwnProperty("adaptiveBinaryIndices")||r.adaptiveBinaryIndices,this.transactional=!!r.hasOwnProperty("transactional")&&r.transactional,this.cloneObjects=!!r.hasOwnProperty("clone")&&r.clone,this.cloneMethod=r.hasOwnProperty("cloneMethod")?r.cloneMethod:"parse-stringify",this.asyncListeners=!!r.hasOwnProperty("asyncListeners")&&r.asyncListeners,this.disableMeta=!!r.hasOwnProperty("disableMeta")&&r.disableMeta,this.disableChangesApi=!r.hasOwnProperty("disableChangesApi")||r.disableChangesApi,this.disableDeltaChangesApi=!r.hasOwnProperty("disableDeltaChangesApi")||r.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!r.hasOwnProperty("autoupdate")&&r.autoupdate,this.serializableIndices=!r.hasOwnProperty("serializableIndices")||r.serializableIndices,this.disableFreeze=!r.hasOwnProperty("disableFreeze")||r.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(r.ttl||-1,r.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var i=[];if(r&&r.indices)if("[object Array]"===Object.prototype.toString.call(r.indices))i=r.indices;else{if("string"!=typeof r.indices)throw new TypeError("Indices needs to be a string or an array of strings");i=[r.indices]}for(var s=0;s<i.length;s++)this.ensureIndex(i[s]);function o(e){var r="function"==typeof Set?new Set:[];r.add||(r.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach((function(t){r.add(t.object)})),r.forEach((function(e){if(!t.call(e,"$loki"))return n.removeAutoUpdateObserver(e);try{n.update(e)}catch(t){}}))}function a(t,e){return e?l(e,t):JSON.parse(JSON.stringify(t))}function l(t,e){var r=null!==e&&"object"==typeof e?Object.keys(e):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var i={},s=0;s<r.length;s++){var o=r[s];if(e.hasOwnProperty(o))if(!t.hasOwnProperty(o)||n.uniqueNames.indexOf(o)>=0||"$loki"==o||"meta"==o)i[o]=e[o];else{var a=l(t[o],e[o]);void 0!==a&&a!={}&&(i[o]=a)}}return 0===Object.keys(i).length?void 0:i}return t===e?void 0:e}function c(){n.changes=[]}this.observerCallback=o,this.getChangeDelta=a,this.getObjectDelta=l,this.getChanges=function(){return n.changes},this.flushChanges=c,this.setChangesApi=function(t){n.disableChangesApi=!t,t||(n.disableDeltaChangesApi=!1)},this.on("delete",(function(t){n.disableChangesApi||n.createChange(n.name,"R",t)})),this.on("warning",(function(t){n.lokiConsoleWrapper.warn(t)})),c()}function D(t){return-1!==t.indexOf(".")}function E(t){return parseFloat(t,10)}function j(t,e){return t+e}function M(t,e){return t-e}function L(t){return t.reduce(j,0)/t.length}function N(t){var e=L(t),r=L(t.map((function(t){var r=t-e;return r*r})));return Math.sqrt(r)}function $(t,e,r){if(!1===r)return t[e];for(var n=e.split("."),i=t;n.length>0;)i=i[n.shift()];return i}function z(t,e,r){for(var n,i,s=0,o=t.length;s<o;){if(i=s+o>>1,0===(n=r.apply(null,[e,t[i]])))return{found:!0,index:i};n<0?o=i:s=i+1}return{found:!1,index:o}}function T(t){return function(e,r){return z(e,r,t)}}function q(){}function B(t){this.field=t,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function F(t){this.index=Object.create(null),this.field=t}function R(t){this.field=t}return w.prototype.events={},w.prototype.asyncListeners=!1,w.prototype.on=function(t,e){var r,n=this;return Array.isArray(t)?(t.forEach((function(t){n.on(t,e)})),e):((r=this.events[t])||(r=this.events[t]=[]),r.push(e),e)},w.prototype.emit=function(t){var e,r=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].length&&(e=Array.prototype.slice.call(arguments,1),this.events[t].forEach((function(t){r.asyncListeners?setTimeout((function(){t.apply(r,e)}),1):t.apply(r,e)})))},w.prototype.addListener=w.prototype.on,w.prototype.removeListener=function(t,e){var r=this;if(Array.isArray(t))t.forEach((function(t){r.removeListener(t,e)}));else if(this.events[t]){var n=this.events[t];n.splice(n.indexOf(e),1)}},I.prototype=new w,I.prototype.constructor=I,I.prototype.getIndexedAdapter=function(){return r(7996)},I.prototype.configureOptions=function(t,e){var r={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"},n={fs:O,localStorage:x,memory:S};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new n[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),t.autoload&&e){var i=this;setTimeout((function(){i.loadDatabase(t,t.autoloadCallback)}),1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod=r[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))},I.prototype.copy=function(t){var e,r,n=new I(this.filename,{env:"NA"});if(t=t||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,e=n.collections.length,r=0;r<e;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},I.prototype.addCollection=function(t,e){var r,n=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===t)return this.collections[r];var i=new A(t,e);return i.isIncremental=this.isIncremental,this.collections.push(i),this.verbose&&(i.lokiConsoleWrapper=console),i},I.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},I.prototype.getCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},I.prototype.renameCollection=function(t,e){var r=this.getCollection(t);return r&&(r.name=e),r},I.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},I.prototype.removeCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t){var n=new A(t,{}),i=this.collections[e];for(var s in i)i.hasOwnProperty(s)&&n.hasOwnProperty(s)&&(i[s]=n[s]);return void this.collections.splice(e,1)}},I.prototype.getName=function(){return this.name},I.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},I.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},I.prototype.toJson=I.prototype.serialize,I.prototype.serializeDestructured=function(t){var e,r,n,i,s,o=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((s=new I(this.filename)).loadJSONObject(this),e=0;e<s.collections.length;e++)s.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return s.serialize({serializationMethod:"normal"});for(o.push(s.serialize({serializationMethod:"normal"})),s=null,e=0;e<this.collections.length;e++)if(n=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)o.push(n[r]),n[r]=null;o.push("")}else o.push(n);return t.partitioned?(t.delimited,o):t.delimited?(o.push(""),o.join(t.delimiter)):(o.push(""),o)},I.prototype.serializeCollection=function(t){var e,r,n=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,n=[],r=0;r<e;r++)n.push(JSON.stringify(this.collections[t.collectionIndex].data[r]));return t.delimited?(n.push(""),n.join(t.delimiter)):n},I.prototype.deserializeDestructured=function(t,e){var r,n,i,s=[],o=0,a=1,l=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?r=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(n=(r=JSON.parse(t[0])).collections.length,o=0;o<n;o++)r.collections[o].data=this.deserializeCollection(t[o+1],e);return r}if(e.delimited){if(s=t.split(e.delimiter),t=null,0===s.length)return null}else s=t;for(n=(r=JSON.parse(s[0])).collections.length,s[0]=null;!l;)s[a],""===s[a]?++o>n&&(l=!0):(i=JSON.parse(s[a]),r.collections[o].data.push(i)),s[a++]=null;return r},I.prototype.deserializeCollection=function(t,e){var r,n,i=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(i=t.split(e.delimiter)).pop():i=t,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},I.prototype.loadJSON=function(t,e){var r;r=0===t.length?{}:"destructured"===this.options.serializationMethod?this.deserializeDestructured(t):JSON.parse(t),this.loadJSONObject(r,e)},I.prototype.loadJSONObject=function(t,r){var n,i,o,a,l,c,u=0,h=t.collections?t.collections.length:0;function d(t){var e,n=r[t.name];return n.proto?(e=n.inflate||s.copyProperties,function(t){var r=new n.proto;return e(t,r),r}):n.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&r&&!r.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];u<h;u+=1){if(n=t.collections[u],(i=this.addCollection(n.name,{disableChangesApi:n.disableChangesApi,disableDeltaChangesApi:n.disableDeltaChangesApi,disableMeta:n.disableMeta,disableFreeze:!n.hasOwnProperty("disableFreeze")||n.disableFreeze})).adaptiveBinaryIndices=!!n.hasOwnProperty("adaptiveBinaryIndices")&&!0===n.adaptiveBinaryIndices,i.transactional=n.transactional,i.asyncListeners=n.asyncListeners,i.cloneObjects=n.cloneObjects,i.cloneMethod=n.cloneMethod||"parse-stringify",i.autoupdate=n.autoupdate,i.changes=n.changes,i.dirtyIds=n.dirtyIds||[],r&&!0===r.retainDirtyFlags?i.dirty=n.dirty:i.dirty=!1,o=n.data.length,a=0,r&&r.hasOwnProperty(n.name))for(l=d(n);a<o;a++)c=l(n.data[a]),i.data[a]=c,i.addAutoUpdateObserver(c),i.disableFreeze||e(i.data[a]);else for(;a<o;a++)i.data[a]=n.data[a],i.addAutoUpdateObserver(i.data[a]),i.disableFreeze||e(i.data[a]);if(i.maxId=void 0===n.maxId?0:n.maxId,void 0!==n.binaryIndices&&(i.binaryIndices=n.binaryIndices),void 0!==n.transforms&&(i.transforms=n.transforms),i.uniqueNames=[],n.hasOwnProperty("uniqueNames")&&(i.uniqueNames=n.uniqueNames),void 0!==n.DynamicViews){for(var f=0;f<n.DynamicViews.length;f++){var p=n.DynamicViews[f],y=i.addDynamicView(p.name,p.options);y.resultdata=p.resultdata,y.resultsdirty=p.resultsdirty,y.filterPipeline=p.filterPipeline,y.sortCriteriaSimple=p.sortCriteriaSimple,y.sortCriteria=p.sortCriteria,y.sortFunction=null,y.sortDirty=p.sortDirty,i.disableFreeze||(e(y.filterPipeline),y.sortCriteriaSimple?e(y.sortCriteriaSimple):y.sortCriteria&&e(y.sortCriteria)),y.resultset.filteredrows=p.resultset.filteredrows,y.resultset.filterInitialized=p.resultset.filterInitialized,y.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(i.ensureAllIndexes(!0),i.dirty=!0)}}},I.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},I.prototype.generateChangesNotification=function(t){function e(t){return t.name}var r=[],n=t||this.collections.map(e);return this.collections.forEach((function(t){-1!==n.indexOf(e(t))&&(r=r.concat(t.getChanges()))})),r},I.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},I.prototype.clearChanges=function(){this.collections.forEach((function(t){t.flushChanges&&t.flushChanges()}))},S.prototype.loadDatabase=function(t,e){var r=this;this.options.asyncResponses?setTimeout((function(){r.hashStore.hasOwnProperty(t)?e(r.hashStore[t].value):e(null)}),this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},S.prototype.saveDatabase=function(t,e,r){var n,i=this;this.options.asyncResponses?setTimeout((function(){n=i.hashStore.hasOwnProperty(t)?i.hashStore[t].savecount:0,i.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r()}),this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r())},S.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},k.prototype.loadDatabase=function(t,e){var r=this;this.dbname=t,this.dbref=new I(t),this.adapter.loadDatabase(t,(function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var n=JSON.parse(t);r.dbref.loadJSONObject(n),n=null,r.dbref.collections.length,0!==r.dbref.collections.length?(r.pageIterator={collection:0,pageIndex:0},r.loadNextPartition(0,(function(){e(r.dbref)}))):e(r.dbref)}else e(t)}))},k.prototype.loadNextPartition=function(t,e){var r=this.dbname+"."+t,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(r,(function(r){var i=n.dbref.deserializeCollection(r,{delimited:!0,collectionIndex:t});n.dbref.collections[t].data=i,++t<n.dbref.collections.length?n.loadNextPartition(t,e):e()}))},k.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=this;this.adapter.loadDatabase(e,(function(e){var n=e.split(r.options.delimiter);e="";var i,s=n.length,o=""===n[s-1];for(o&&(n.pop(),""===n[(s=n.length)-1]&&1===s&&(n.pop(),s=n.length)),i=0;i<s;i++)r.dbref.collections[r.pageIterator.collection].data.push(JSON.parse(n[i])),n[i]=null;n=[],o?++r.pageIterator.collection<r.dbref.collections.length?r.loadNextPartition(r.pageIterator.collection,t):t():(r.pageIterator.pageIndex++,r.loadNextPage(t))}))},k.prototype.exportDatabase=function(t,e,r){var n,i=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],n=0;n<i;n++)e.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition((function(t){r(t)}))},k.prototype.saveNextPartition=function(t){var e=this,r=this.dirtyPartitions.shift(),n=this.dbname+(-1===r?"":"."+r);if(this.options.paging&&-1!==r)return this.pageIterator={collection:r,docIndex:0,pageIndex:0},void this.saveNextPage((function(r){0===e.dirtyPartitions.length?t(r):e.saveNextPartition(t)}));var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:r});this.adapter.saveDatabase(n,i,(function(r){r?t(r):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)}))},k.prototype.saveNextPage=function(t){var e=this,r=this.dbref.collections[this.pageIterator.collection],n=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,s=r.data.length,o=this.options.delimiter.length,a="",l="",c=!1,u=!1,h=function(r){l="",r&&t(r),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===r.data.length&&(c=!0);;)if(c||(a=JSON.stringify(r.data[this.pageIterator.docIndex]),l+=a,i+=a.length,++this.pageIterator.docIndex>=s&&(c=!0)),i>=this.options.pageSize&&(u=!0),u&&!c||(l+=this.options.delimiter,i+=o),c||u)return void this.adapter.saveDatabase(n,l,h)},O.prototype.loadDatabase=function(t,e){var r=this;this.fs.stat(t,(function(n,i){!n&&i.isFile()?r.fs.readFile(t,{encoding:"utf8"},(function(t,r){e(t?new Error(t):r)})):e(null)}))},O.prototype.saveDatabase=function(t,e,r){var n=this,i=t+"~";this.fs.writeFile(i,e,(function(e){e?r(new Error(e)):n.fs.rename(i,t,r)}))},O.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,(function(t){t?e(new Error(t)):e()}))},x.prototype.loadDatabase=function(t,e){b()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},x.prototype.saveDatabase=function(t,e,r){b()?(localStorage.setItem(t,e),r(null)):r(new Error("localStorage is not available"))},x.prototype.deleteDatabase=function(t,e){b()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},I.prototype.throttledSaveDrain=function(t,e){var r=this,n=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push((function(){return r.throttledSavePending?e.recursiveWaitLimit&&n-e.started>e.recursiveWaitLimitDuration?void t(!1):void r.throttledSaveDrain(t,e):void t(!0)}))}else t(!0)},I.prototype.loadDatabaseInternal=function(t,e){var r=e||function(t,e){if(t)throw t},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,(function(e){if("string"==typeof e){var i=!1;try{n.loadJSON(e,t||{}),i=!0}catch(t){r(t)}i&&(r(null),n.emit("loaded","database "+n.filename+" loaded"))}else{if(!e)return r(null),void n.emit("loaded","empty database "+n.filename+" loaded");if(e instanceof Error)return void r(e);if("object"==typeof e)return n.loadJSONObject(e,t||{}),r(null),void n.emit("loaded","database "+n.filename+" loaded");r("unexpected adapter response : "+e)}})):r(new Error("persistenceAdapter not configured"))},I.prototype.loadDatabase=function(t,e){var r=this;this.throttledSaves?this.throttledSaveDrain((function(n){if(n)return r.throttledSavePending=!0,void r.loadDatabaseInternal(t,(function(t){0===r.throttledCallbacks.length?r.throttledSavePending=!1:r.saveDatabase(),"function"==typeof e&&e(t)}));"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))}),t):this.loadDatabaseInternal(t,e)},I.prototype.saveDatabaseInternal=function(t){var e,r=t||function(t){if(t)throw t},n=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,(function(){if(n.ignoreAutosave=!1,!e){var t=n.copy({removeNonSerializable:!0});return e=n.collections.map((function(t){return[t.dirty,t.dirtyIds]})),n.collections.forEach((function(t){t.dirty=!1,t.dirtyIds=[]})),t}r(new Error("adapter error - getLokiCopy called more than once"))}),(function(t){n.ignoreAutosave=!1,t&&e&&n.collections.forEach((function(t,r){var n=e[r];t.dirty=t.dirty||n[0],t.dirtyIds=t.dirtyIds.concat(n[1])})),r(t)}))):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),(function(t){n.autosaveClearFlags(),r(t)})):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),(function(t){r(t)}))):r(new Error("persistenceAdapter not configured"))},I.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var r=this;this.saveDatabaseInternal((function(t){r.throttledSavePending=!1,e.forEach((function(e){"function"==typeof e&&setTimeout((function(){e(t)}),1)})),r.throttledCallbacks.length>0&&r.saveDatabase()}))}else this.saveDatabaseInternal(t)},I.prototype.save=I.prototype.saveDatabase,I.prototype.deleteDatabase=function(t,e){var r=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(r=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,(function(t){r(t)})):r(new Error("persistenceAdapter not configured"))},I.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},I.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},I.prototype.autosaveEnable=function(t,e){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval((function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(e)}),r)},I.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},C.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},C.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},C.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new C(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},C.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new C(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},C.prototype.copy=function(){var t=new C(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},C.prototype.branch=C.prototype.copy,C.prototype.transform=function(t,e){var r,n,i=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==e&&(t=s.resolveTransformParams(t,e)),r=0;r<t.length;r++)switch((n=t[r]).type){case"find":i.find(n.value);break;case"where":i.where(n.value);break;case"simplesort":i.simplesort(n.property,n.desc||n.options);break;case"compoundsort":i.compoundsort(n.value);break;case"sort":i.sort(n.value);break;case"limit":i=i.limit(n.value);break;case"offset":i=i.offset(n.value);break;case"map":i=i.map(n.value,n.dataOptions);break;case"eqJoin":i=i.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":i=i.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":i.update(n.value);break;case"remove":i.remove()}return i},C.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,r,n=(e=t,r=this.collection.data,function(t,n){return e(r[t],r[n])});return this.filteredrows.sort(n),this},C.prototype.simplesort=function(t,e){var r,n=10,i=this.collection.data.length,o=this.filteredrows.length,a=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===o){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&a&&(r=i/o,e.useJavascriptSorting&&(n=6),r<=n||e.forceIndexIntersect)){var l,c=this.filteredrows,h={};for(l=0;l<o;l++)h[c[l]]=!0;var d=this.collection.binaryIndices[t].values;return this.filteredrows=d.filter((function(t){return h[t]})),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort((function(e,r){return e[t]===r[t]?0:e[t]>r[t]?1:e[t]<r[t]?-1:void 0}));var f,p,y,v,g,m,b=(f=t,p=e.desc,y=this.collection.data,function(t,e){return~f.indexOf(".")?(m=f.split("."),v=s.getIn(y[t],m,!0),g=s.getIn(y[e],m,!0)):(v=y[t][f],g=y[e][f]),u(v,g,p)});return this.filteredrows.sort(b),this},C.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var r=0,n=t.length;r<n;r+=1)e=t[r],Array.isArray(e)||(t[r]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var i,s,o=(i=t,s=this.collection.data,function(t,e){return h(i,s[t],s[e])});return this.filteredrows.sort(o),this},C.prototype.findOr=function(t){for(var e=null,r=0,n=0,i=[],s=[],o=0,a=(this.count(),0),l=t.length;a<l;a++)for(n=(e=this.branch().find(t[a]).filteredrows).length,r=0;r<n;r++)void 0===s[o=e[r]]&&(s[o]=!0,i.push(o));return this.filteredrows=i,this.filterInitialized=!0,this},C.prototype.$or=C.prototype.findOr,C.prototype.findAnd=function(t){for(var e=0,r=t.length;e<r;e++){if(0===this.count())return this;this.find(t[e])}return this},C.prototype.$and=C.prototype.findAnd,C.prototype.find=function(e,r){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var n,i,o,a,l,c,u,h=e||"getAll",f=!1,p=[],g=[],m=null;if(r=r||!1,"object"==typeof h){for(n in h)(a={})[n]=h[n],g.push(a),t.call(h,n)&&(i=n,o=h[n]);if(g.length>1)return this.find({$and:g},r)}if(!i||"getAll"===h)return r&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if("$and"===i||"$or"===i)return this[i](o),r&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===o||"object"!=typeof o||o instanceof Date)l="$eq",c=o;else{if("object"!=typeof o)throw new Error("Do not know what you want to do.");for(u in o)if(t.call(o,u)){l=u,c=o[u];break}}"$regex"!==l&&"object"!=typeof c||(c=_(l,c));var b=-1!==i.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[i]&&v[l]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(i),f=!0,m=this.collection.binaryIndices[i]),!f&&"$in"===l&&Array.isArray(c)&&"undefined"!=typeof Set&&(c=new Set(c),l="$inSet");var w,I,S=y[l],k=this.collection.data,O=0,x=0,C=0;if(this.filterInitialized){if(x=(w=this.filteredrows).length,b){for(i=i.split("."),O=0;O<x;O++)if(d(I=k[C=w[O]],i,S,c,I)&&(p.push(C),r))return this.filteredrows=p,this}else for(O=0;O<x;O++)if(S((I=k[C=w[O]])[i],c,I)&&(p.push(C),r))return this.filteredrows=p,this}else if(f){var P=this.collection.calculateRange(l,i,c);if("$in"!==l){for(O=P[0];O<=P[1];O++)if(!0!==v[l]){if(v[l](s.getIn(k[m.values[O]],i,b),c)&&(p.push(m.values[O]),r))return this.filteredrows=p,this.filterInitialized=!0,this}else if(p.push(m.values[O]),r)return this.filteredrows=p,this.filterInitialized=!0,this}else for(O=0,x=P.length;O<x;O++)if(p.push(m.values[P[O]]),r)return this.filteredrows=p,this.filterInitialized=!0,this}else if(x=k.length,b){for(i=i.split("."),O=0;O<x;O++)if(d(I=k[O],i,S,c,I)&&(p.push(O),r))return this.filteredrows=p,this.filterInitialized=!0,this}else for(O=0;O<x;O++)if(S((I=k[O])[i],c,I)&&(p.push(O),r))return this.filteredrows=p,this.filterInitialized=!0,this;return this.filteredrows=p,this.filterInitialized=!0,this},C.prototype.where=function(t){var e,r=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===e(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);return this.filteredrows=r,this}for(var i=this.collection.data.length;i--;)!0===e(this.collection.data[i])&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}catch(t){throw t}},C.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},C.prototype.data=function(t){var e,r,n,i,s=[],o=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(r=o.length,i=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)e=g(o[n],i),t.removeMeta&&(delete e.$loki,delete e.meta),s.push(e);return s}return o.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(r=a.length,this.collection.cloneObjects||t.forceClones)for(i=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)e=g(o[a[n]],i),t.removeMeta&&(delete e.$loki,delete e.meta),s.push(e);else for(n=0;n<r;n++)s.push(o[a[n]]);return s},C.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(t(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]])):(t(e=g(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(e));return this},C.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},C.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},C.prototype.eqJoin=function(t,e,r,n,i){var s,o,a,l=[],c=[],u=[],h="function"==typeof e,d="function"==typeof r,f={};if(s=(l=this.data(i)).length,t instanceof A)c=t.chain().data(i);else if(t instanceof C)c=t.data(i);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}o=c.length;for(var p=0;p<o;p++)f[a=d?r(c[p]):c[p][r]]=c[p];n||(n=function(t,e){return{left:t,right:e}});for(var y=0;y<s;y++)a=h?e(l[y]):l[y][e],u.push(n(l[y],f[a]||{}));return this.collection=new A("joinData"),this.collection.insert(u),this.filteredrows=[],this.filterInitialized=!1,this},C.prototype.map=function(t,e){var r=this.data(e).map(t);return this.collection=new A("mappedData"),this.collection.insert(r),this.filteredrows=[],this.filterInitialized=!1,this},P.prototype=new w,P.prototype.constructor=P,P.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},P.prototype.rematerialize=function(t){var e,r,n;t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new C(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var i=Object.isFrozen(this.filterPipeline);if(t.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),r=e=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var s=this.filterPipeline;for(this.filterPipeline=[],e=s.length,n=0;n<e;n++)this.applyFind(s[n].val,s[n].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},P.prototype.branchResultset=function(t,e){var r=this.resultset.branch();return void 0===t?r:r.transform(t,e)},P.prototype.toJSON=function(){var t=new P(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},P.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var e=Object.isFrozen(this.filterPipeline),r=this.filterPipeline.length>0;this.filterPipeline=[],e&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase(),r&&this.emit("filter")},P.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.applySimpleSort=function(t,r){return this.sortCriteriaSimple={propname:t,options:r||!1},this.collection.disableFreeze||e(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.collection.disableFreeze||e(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},P.prototype.commit=function(){return this.cachedresultset=null,this},P.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},P.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,r=this.filterPipeline.length;e<r;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},P.prototype._addFilter=function(t){var r=Object.isFrozen(this.filterPipeline);r&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||e(t),this.filterPipeline.push(t),r&&Object.freeze(this.filterPipeline),this.resultset[t.type](t.val)},P.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline,e=Object.isFrozen(t);this.filterPipeline=[];for(var r=0,n=t.length;r<n;r+=1)this._addFilter(t[r]);return e&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},P.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);if(e>=0){var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[e]=t,r&&(n(t),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},P.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},P.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},P.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(e,1),r&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},P.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},P.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},P.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout((function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))}),this.options.minRebuildInterval)}},P.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout((function(){t.performSortPhase()}),this.options.minRebuildInterval):this.queueRebuildEvent()}},P.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},P.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,n=this.resultset.filteredrows,i=e?-1:n.indexOf(+t),s=n.length,o=new C(this.collection);o.filteredrows=[t],o.filterInitialized=!0;for(var a=0,l=this.filterPipeline.length;a<l;a++)o[(r=this.filterPipeline[a]).type](r.val);var c=0===o.filteredrows.length?-1:0;return-1!==i||-1!==c?-1===i&&-1!==c?(n.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1===c?(i<s-1?(n.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(n.length=s-1,this.options.persistent&&(this.resultdata.length=s-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1!==c?(this.options.persistent&&(this.resultdata[i]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},P.prototype.removeDocument=function(t){var e,r,n,i={},s={},o=[],a=this.resultset,l=this.resultset.filteredrows,c=l.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),n=t.length,r=0;r<n;r++)i[t[r]]=!0;for(e=0;e<c;e++)i[l[e]]&&(s[e]=!0);Object.keys(s).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter((function(t,e){return!s[e]})),this.options.persistent&&(this.resultdata=this.resultdata.filter((function(t,e){return!s[e]}))),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var u=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)o=t.filter(u(e)),a.filteredrows[e]-=o.length},P.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},A.prototype=new w,A.prototype.contructor=A,A.prototype.createChange=function(t,e,r,n){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},A.prototype.insertMeta=function(t){var e,r;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,r=0;r<e;r++)t[r].hasOwnProperty("meta")||(t[r].meta={}),t[r].meta.created=(new Date).getTime(),t[r].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},A.prototype.updateMeta=function(t){return this.disableMeta||!t||(this.disableFreeze||((t=i(t)).meta=i(t.meta)),t.meta.updated=(new Date).getTime(),t.meta.revision+=1),t},A.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},A.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},A.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},A.prototype.updateMetaWithChange=function(t,e,r){return t=this.updateMeta(t,r),this.createUpdateChange(t,e),t},A.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},A.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},A.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},A.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},A.prototype.getTransform=function(t){return this.transforms[t]},A.prototype.setTransform=function(t,e){this.transforms[t]=e},A.prototype.removeTransform=function(t){delete this.transforms[t]},A.prototype.byExample=function(t){var e,r,n;for(e in n=[],t)t.hasOwnProperty(e)&&n.push(((r={})[e]=t[e],r));return{$and:n}},A.prototype.findObject=function(t){return this.findOne(this.byExample(t))},A.prototype.findObjects=function(t){return this.find(this.byExample(t))},A.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var r=Date.now();t.chain().where((function(t){var n=t.meta.updated||t.meta.created;return e<r-n})).remove()}},A.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},A.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),r=0;r<t;r+=1)e[r]=r;return e},A.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},A.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var r={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=r;var n,i,a,l,c,u=(n=t,i=this.data,c=!!~n.indexOf(".")&&n.split("."),function(t,e){if(c?(a=s.getIn(i[t],c,!0),l=s.getIn(i[e],c,!0)):(a=i[t][n],l=i[e][n]),a!==l){if(o.lt(a,l,!1))return-1;if(o.gt(a,l,!1))return 1}return 0});r.values.sort(u),r.dirty=!1,this.dirty=!0}},A.prototype.checkAllIndexes=function(e){var r,n=this.binaryIndices,i=[];for(r in n)t.call(n,r)&&(this.checkIndex(r,e)||i.push(r));return i},A.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var r,n,i,o,a,l=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),(o=(a=this.binaryIndices[t].values).length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===o)return!0;var c=-1!==t.indexOf(".");if(1===o)l=0===a[0];else if(e.randomSampling){if(y.$lte(s.getIn(this.data[a[0]],t,c),s.getIn(this.data[a[1]],t,c))||(l=!1),y.$lte(s.getIn(this.data[a[o-2]],t,c),s.getIn(this.data[a[o-1]],t,c))||(l=!1),l)for(n=Math.floor((o-1)*e.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(o-1)),!y.$lte(s.getIn(this.data[a[i]],t,c),s.getIn(this.data[a[i+1]],t,c))){l=!1;break}}else for(r=0;r<o-1;r++)if(!y.$lte(s.getIn(this.data[a[r]],t,c),s.getIn(this.data[a[r+1]],t,c))){l=!1;break}return!l&&e.repair&&this.ensureIndex(t,!0),l},A.prototype.getBinaryIndexValues=function(t){var e,r=this.binaryIndices[t].values,n=[];for(e=0;e<r.length;e++)n.push(s.getIn(this.data[r[e]],t,!0));return n},A.prototype.getUniqueIndex=function(t,e){var r=this.constraints.unique[t];return!r&&e?this.ensureUniqueIndex(t):r},A.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new B(t),this.data.forEach((function(t){e.set(t)})),e},A.prototype.ensureAllIndexes=function(e){var r,n=this.binaryIndices;for(r in n)t.call(n,r)&&this.ensureIndex(r,e)},A.prototype.flagBinaryIndexesDirty=function(){var e,r=this.binaryIndices;for(e in r)t.call(r,e)&&(r[e].dirty=!0)},A.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},A.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},A.prototype.ensureId=function(){if(!this.idIndex){for(var t=this.data,e=0,r=t.length,n=new Array(r);e<r;e++)n[e]=t[e].$loki;this.idIndex=n}},A.prototype.ensureIdAsync=function(t){this.async((function(){this.ensureId()}),t)},A.prototype.addDynamicView=function(t,e){var r=new P(this,t,e);return this.DynamicViews.push(r),r},A.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter((function(e){return e.name!==t}))},A.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},A.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},A.prototype.findAndRemove=function(t){this.chain().find(t).remove()},A.prototype.insert=function(t,e){if(!Array.isArray(t))return this.insertOne(t);var r,n=[],i=e&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;i&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",t);for(var s=0,o=t.length;s<o;s++){if(!(r=this.insertOne(t[s],!0)))return;n.push(r)}}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),1===(n=this.cloneObjects?g(n,this.cloneMethod):n).length?n[0]:n},A.prototype.insertOne=function(t,r){var n,s=null;if("object"!=typeof t?s=new TypeError("Document needs to be an object"):null===t&&(s=new TypeError("Object cannot be null")),null!==s)throw this.emit("error",s),s;var o=this.cloneObjects?g(t,this.cloneMethod):t;if(this.disableFreeze||(o=i(o)),this.disableMeta||(void 0===o.meta?o.meta={revision:0,created:0}:this.disableFreeze||(o.meta=i(o.meta))),r||this.emit("pre-insert",o),this.add(o))return this.disableChangesApi?this.insertMeta(o):this.insertMetaWithChange(o),this.disableFreeze||e(o),n=this.cloneObjects?g(o,this.cloneMethod):o,r||this.emit("insert",n),this.addAutoUpdateObserver(n),n},A.prototype.clear=function(t){var e=this;t=t||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===t.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach((function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}))},A.prototype.update=function(r){var n,i,s;if(Array.isArray(r)){s=r.length,(n=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<s;i+=1)this.update(r[i])}finally{n&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(r,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var o,a,l,c,u,h=this.get(r.$loki,!0),d=this;if(!h)throw new Error("Trying to update a document not in collection.");o=h[0],l=h[1],a=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?g(r,this.cloneMethod):r,this.emit("pre-update",r),this.uniqueNames.forEach((function(t){d.getUniqueIndex(t,!0).update(o,a)})),this.data[l]=a,a!==r&&this.addAutoUpdateObserver(r);for(var f=0;f<this.DynamicViews.length;f++)this.DynamicViews[f].evaluateDocument(l,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(c in p)this.adaptiveBinaryIndexUpdate(l,c)}else this.flagBinaryIndexesDirty();return this.idIndex[l]=a.$loki,this.isIncremental&&this.dirtyIds.push(a.$loki),this.commit(),this.dirty=!0,a=this.disableChangesApi?this.updateMeta(a):this.updateMetaWithChange(a,o),this.disableFreeze||e(a),u=this.cloneObjects?g(a,this.cloneMethod):a,this.emit("update",u,o),u}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}}},A.prototype.add=function(t){if("object"!=typeof t)throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var e=this.maxId;t.$loki=e,this.disableMeta||(t.meta.version=0);for(var r=0,n=this.uniqueNames.length;r<n;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(t);this.idIndex&&this.idIndex.push(e),this.isIncremental&&this.dirtyIds.push(e),this.data.push(t);var i=this.data.length-1,s=this.DynamicViews.length;for(r=0;r<s;r++)this.DynamicViews[r].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){var o=this.binaryIndices;for(var a in o)this.adaptiveBinaryIndexInsert(i,a)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?g(t,this.cloneMethod):t}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}},A.prototype.updateWhere=function(t,e){var r,n=this.where(t),i=0;try{for(;i<n.length;i++)r=e(n[i]),this.update(r)}catch(t){this.rollback(),this.lokiConsoleWrapper.error(t.message)}},A.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},A.prototype.removeDataOnly=function(){this.remove(this.data.slice())},A.prototype.removeBatchByPositions=function(t){var e,r,n,i,s=t.length,o={},a=Object.keys(this.binaryIndices).length,l=Object.keys(this.constraints.unique).length,c=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,u=this;try{for(this.startTransaction(),this.ensureId(),n=0;n<s;n++)o[this.idIndex[t[n]]]=!0;if((e=this.DynamicViews.length)>0||a>0||l>0){if(e>0)for(r=0;r<e;r++)this.DynamicViews[r].removeDocument(t);if(this.adaptiveBinaryIndices&&!c){var h,d=this.binaryIndices;for(h in d)this.adaptiveBinaryIndexRemove(t,h)}else this.flagBinaryIndexesDirty();l&&this.uniqueNames.forEach((function(e){var r=u.getUniqueIndex(e);if(r)for(n=0;n<s;n++)null!==(i=u.data[t[n]])[e]&&void 0!==i[e]&&r.remove(i[e])}))}if(!this.disableChangesApi||this.events.delete.length>1)for(n=0;n<s;n++)this.emit("delete",this.data[t[n]]);if(this.data=this.data.filter((function(t){return!o[t.$loki]})),this.isIncremental)for(n=0;n<s;n++)this.dirtyIds.push(this.idIndex[t[n]]);this.idIndex=this.idIndex.filter((function(t){return!o[t]})),this.adaptiveBinaryIndices&&c&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),c&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}},A.prototype.removeBatch=function(t){var e,r=t.length,n=this.data.length,i={},s=[];for(e=0;e<n;e++)i[this.data[e].$loki]=e;for(e=0;e<r;e++)"object"==typeof t[e]?s.push(i[t[e].$loki]):s.push(i[t[e]]);this.removeBatchByPositions(s)},A.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var r=this.get(e.$loki,!0),s=r[1],o=this;this.uniqueNames.forEach((function(t){if(null!==e[t]&&void 0!==e[t]){var r=o.getUniqueIndex(t);r&&r.remove(e[t])}}));for(var a=0;a<this.DynamicViews.length;a++)this.DynamicViews[a].removeDocument(s);if(this.adaptiveBinaryIndices){var l,c=this.binaryIndices;for(l in c)this.adaptiveBinaryIndexRemove(s,l)}else this.flagBinaryIndexesDirty();return this.data.splice(s,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(s,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",r[0]),this.disableFreeze||(e=i(e)),delete e.$loki,delete e.meta,this.disableFreeze||n(e),e}catch(t){return this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}}},A.prototype.get=function(t,e){this.idIndex||this.ensureId();var r=e||!1,n=this.idIndex,i=n.length-1,s=0,o=s+i>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;n[s]<n[i];)n[o=s+i>>1]<t?s=o+1:i=o;return i===s&&n[s]===t?r?[this.data[s],s]:this.data[s]:null},A.prototype.getBinaryIndexPosition=function(t,e){var r=s.getIn(this.data[t],e,!0),n=this.binaryIndices[e].values,i=this.calculateRange("$eq",e,r);if(0===i[0]&&-1===i[1])return null;for(var o=i[0],a=i[1],l=o;l<=a;l++)if(n[l]===t)return l;return null},A.prototype.adaptiveBinaryIndexInsert=function(t,e){var r=-1!==e.indexOf("."),n=this.binaryIndices[e].values,i=s.getIn(this.data[t],e,r);!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=s.getIn(this.data[t],e));var o=0===n.length?0:this.calculateRangeStart(e,i,!0,r);this.binaryIndices[e].values.splice(o,0,t)},A.prototype.adaptiveBinaryIndexUpdate=function(t,e){var r,n=this.binaryIndices[e].values,i=n.length;for(r=0;r<i&&n[r]!==t;r++);this.binaryIndices[e].values.splice(r,1),this.adaptiveBinaryIndexInsert(t,e)},A.prototype.adaptiveBinaryIndexRemove=function(t,e,r){var n,i,s,o,a,l,c,u=this.binaryIndices[e],h={};if(Array.isArray(t)){if(1!==(o=t.length)){for(s=0;s<o;s++)h[t[s]]=!0;if(u.values=u.values.filter((function(t){return!h[t]})),!0===r)return;var d=t.slice();for(d.sort((function(t,e){return t-e})),n=u.values.length,i=0;i<n;i++){for(a=u.values[i],l=0,s=0;s<o&&a>d[s];s++)l++;u.values[i]-=l}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(u.values.splice(c,1),!0!==r)for(n=u.values.length,i=0;i<n;i++)u.values[i]>t&&u.values[i]--},A.prototype.calculateRangeStart=function(t,e,r,n){var i=this.data,a=this.binaryIndices[t].values,l=0,c=a.length-1,u=0;if(0===a.length)return-1;for(s.getIn(i[a[l]],t,n),s.getIn(i[a[c]],t,n);l<c;)u=l+c>>1,o.lt(s.getIn(i[a[u]],t,n),e,!1)?l=u+1:c=u;var h=l;return o.aeq(e,s.getIn(i[a[h]],t,n))?h:o.lt(e,s.getIn(i[a[h]],t,n),!1)?r?h:h-1:r?h+1:h},A.prototype.calculateRangeEnd=function(t,e,r){var n=this.data,i=this.binaryIndices[t].values,a=0,l=i.length-1,c=0;if(0===i.length)return-1;for(s.getIn(n[i[a]],t,r),s.getIn(n[i[l]],t,r);a<l;)c=a+l>>1,o.lt(e,s.getIn(n[i[c]],t,r),!1)?l=c:a=c+1;var u=l;return o.aeq(e,s.getIn(n[i[u]],t,r))?u:o.gt(e,s.getIn(n[i[u]],t,r),!1)?u+1:o.aeq(e,s.getIn(n[i[u-1]],t,r))?u-1:u},A.prototype.calculateRange=function(t,e,r){var n,i,a,l=this.data,c=this.binaryIndices[e].values,u=0,h=c.length-1;if(0===l.length)return[0,-1];var d=-1!==e.indexOf("."),f=s.getIn(l[c[u]],e,d),p=s.getIn(l[c[h]],e,d);switch(t){case"$eq":case"$aeq":case"$dteq":if(o.lt(r,f,!1)||o.gt(r,p,!1))return[0,-1];break;case"$gt":if(o.gt(r,p,!0))return[0,-1];if(o.gt(f,r,!1))return[u,h];break;case"$gte":if(o.gt(r,p,!1))return[0,-1];if(o.gt(f,r,!0))return[u,h];break;case"$lt":if(o.lt(r,f,!0))return[0,-1];if(o.lt(p,r,!1))return[u,h];break;case"$lte":if(o.lt(r,f,!1))return[0,-1];if(o.lt(p,r,!0))return[u,h];break;case"$between":return o.gt(r[0],p,!1)||o.lt(r[1],f,!1)?[0,-1]:((n=this.calculateRangeStart(e,r[0],!1,d))<0&&n++,(a=this.calculateRangeEnd(e,r[1],d))>h&&a--,o.gt(s.getIn(l[c[n]],e,d),r[0],!0)||n++,o.lt(s.getIn(l[c[a]],e,d),r[1],!0)||a--,a<n?[0,-1]:[n,a]);case"$in":for(var y=[],v=[],g=0,m=r.length;g<m;g++)for(var b=this.calculateRange("$eq",e,r[g]),w=b[0];w<=b[1];w++)void 0===y[w]&&(y[w]=!0,v.push(w));return v}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(e,r,!1,d),i=s.getIn(l[c[n]],e,d)}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":a=this.calculateRangeEnd(e,r,d),s.getIn(l[c[a]],e,d)}switch(t){case"$eq":case"$aeq":case"$dteq":return o.aeq(i,r)?[n,a]:[0,-1];case"$gt":return o.aeq(s.getIn(l[c[a]],e,d),r)?[a+1,h]:[a,h];case"$gte":return o.aeq(s.getIn(l[c[n]],e,d),r)?[n,h]:[n+1,h];case"$lt":return o.aeq(s.getIn(l[c[n]],e,d),r)?[u,n-1]:[u,n];case"$lte":return o.aeq(s.getIn(l[c[a]],e,d),r)?[u,a]:[u,a-1];default:return[0,l.length-1]}},A.prototype.by=function(t,e){var r;if(void 0===e)return r=this,function(e){return r.by(t,e)};var n=this.getUniqueIndex(t,!0).get(e);return this.cloneObjects?g(n,this.cloneMethod):n},A.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?g(e[0],this.cloneMethod):e[0]},A.prototype.chain=function(t,e){var r=new C(this);return void 0===t?r:r.transform(t,e)},A.prototype.find=function(t){return this.chain().find(t).data()},A.prototype.findOneUnindexed=function(t,e){for(var r=this.data.length;r--;)if(s.getIn(this.data[r],t,!0)===e)return this.data[r];return null},A.prototype.startTransaction=function(){if(this.transactional){this.cachedData=g(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},A.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},A.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},A.prototype.async=function(t,e){setTimeout((function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()}),0)},A.prototype.where=function(t){return this.chain().where(t).data()},A.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},A.prototype.eqJoin=function(t,e,r,n,i){return new C(this).eqJoin(t,e,r,n,i)},A.prototype.stages={},A.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},A.prototype.commitLog=[],A.prototype.stage=function(t,e){var r=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=r,r},A.prototype.commitStage=function(t,e){var r,n=this.getStage(t),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:e,data:JSON.parse(JSON.stringify(n[r]))});this.stages[t]={}},A.prototype.no_op=function(){},A.prototype.extract=function(t){for(var e=0,r=this.data.length,n=D(t),i=[];e<r;e+=1)i.push($(this.data[e],t,n));return i},A.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},A.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},A.prototype.maxRecord=function(t){for(var e,r=0,n=this.data.length,i=D(t),s={index:0,value:void 0};r<n;r+=1)void 0!==e?e<$(this.data[r],t,i)&&(e=$(this.data[r],t,i),s.index=this.data[r].$loki):(e=$(this.data[r],t,i),s.index=this.data[r].$loki);return s.value=e,s},A.prototype.minRecord=function(t){for(var e,r=0,n=this.data.length,i=D(t),s={index:0,value:void 0};r<n;r+=1)void 0!==e?e>$(this.data[r],t,i)&&(e=$(this.data[r],t,i),s.index=this.data[r].$loki):(e=$(this.data[r],t,i),s.index=this.data[r].$loki);return s.value=e,s},A.prototype.extractNumerical=function(t){return this.extract(t).map(E).filter(Number).filter((function(t){return!isNaN(t)}))},A.prototype.avg=function(t){return L(this.extractNumerical(t))},A.prototype.stdDev=function(t){return N(this.extractNumerical(t))},A.prototype.mode=function(t){var e,r,n,i={},s=this.extract(t);for(r in s.forEach((function(t){i[t]?i[t]+=1:i[t]=1})),i)e?e<i[r]&&(n=r):(n=r,e=i[r]);return n},A.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(M);var r=Math.floor(e.length/2);return e.length%2?e[r]:(e[r-1]+e[r])/2},q.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new T(t)},bs:function(){return new T(this.sort)},set:function(t,e){var r=this.bs(this.keys,t);r.found?this.values[r.index]=e:(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,e))},get:function(t){return this.values[z(this.keys,t,this.sort).index]}},B.prototype.keyMap={},B.prototype.lokiMap={},B.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},B.prototype.get=function(t){return this.keyMap[t]},B.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},B.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var r=this.lokiMap[t.$loki];this.set(e),this.keyMap[r]=void 0}else this.keyMap[t[this.field]]=e},B.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},B.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},F.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var r=this.index[t];for(var n in r)r[n]==e&&r.splice(n,1);r.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},R.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},bs:function(){return new T(this.sort)},setSort:function(t){this.bs=new T(t)},set:function(t,e){var r=z(this.keys,t,this.sort);r.found?this.values[r.index].push(e):(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,[e]))},get:function(t){var e=z(this.keys,t,this.sort);return e.found?this.values[e.index]:[]},getLt:function(t){var e=z(this.keys,t,this.sort),r=e.index;return e.found&&r--,this.getAll(t,0,r)},getGt:function(t){var e=z(this.keys,t,this.sort),r=e.index;return e.found&&r++,this.getAll(t,r,this.keys.length)},getAll:function(t,e,r){for(var n=[],i=e;i<r;i++)n=n.concat(this.values[i]);return n},getPos:function(t){return z(this.keys,t,this.sort)},remove:function(t,e){var r=z(this.keys,t,this.sort).index,n=this.values[r];for(var i in n)n[i]==e&&n.splice(i,1);n.length<1&&(this.keys.splice(r,1),this.values.splice(r,1))},clear:function(){this.keys=[],this.values=[]}},I.deepFreeze=e,I.freeze=n,I.unFreeze=i,I.LokiOps=y,I.Collection=A,I.DynamicView=P,I.Resultset=C,I.KeyValueStore=q,I.LokiMemoryAdapter=S,I.LokiPartitioningAdapter=k,I.LokiLocalStorageAdapter=x,I.LokiFsAdapter=O,I.persistenceAdapters={fs:O,localStorage:x},I.aeq=a,I.lt=l,I.gt=c,I.Comparators=o,I}()},void 0===(s="function"==typeof n?n.apply(e,i):n)||(t.exports=s)},1528:function(t,e){var r,n,i;!function(s,o){"use strict";"object"==typeof t.exports?t.exports=o():(n=[],void 0===(i="function"==typeof(r=o)?r.apply(e,n):r)||(t.exports=i))}(0,(function(){"use strict";var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function r(t){if(!t)return!0;if(i(t)&&0===t.length)return!0;if("string"!=typeof t){for(var r in t)if(e(t,r))return!1;return!0}return!1}function n(e){return t.call(e)}var i=Array.isArray||function(e){return"[object Array]"===t.call(e)};function s(t){var e=parseInt(t);return e.toString()===t?e:t}function o(t){var o,a,l=function(t){return Object.keys(l).reduce((function(e,r){return"create"===r||"function"==typeof l[r]&&(e[r]=l[r].bind(l,t)),e}),{})};function c(t,e){if(o(t,e))return t[e]}function u(t,e,r,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return u(t,e.split(".").map(s),r,n);var i=e[0],o=a(t,i);return 1===e.length?(void 0!==o&&n||(t[i]=r),o):(void 0===o&&("number"==typeof e[1]?t[i]=[]:t[i]={}),u(t[i],e.slice(1),r,n))}return o=(t=t||{}).includeInheritedProps?function(){return!0}:function(t,r){return"number"==typeof r&&Array.isArray(t)||e(t,r)},a=t.includeInheritedProps?function(t,e){"string"!=typeof e&&"number"!=typeof e&&(e=String(e));var r=c(t,e);if("__proto__"===e||"prototype"===e||"constructor"===e&&"function"==typeof r)throw new Error("For security reasons, object's magic properties cannot be set");return r}:function(t,e){return c(t,e)},l.has=function(r,n){if("number"==typeof n?n=[n]:"string"==typeof n&&(n=n.split(".")),!n||0===n.length)return!!r;for(var o=0;o<n.length;o++){var a=s(n[o]);if(!("number"==typeof a&&i(r)&&a<r.length||(t.includeInheritedProps?a in Object(r):e(r,a))))return!1;r=r[a]}return!0},l.ensureExists=function(t,e,r){return u(t,e,r,!0)},l.set=function(t,e,r,n){return u(t,e,r,n)},l.insert=function(t,e,r,n){var s=l.get(t,e);n=~~n,i(s)||(s=[],l.set(t,e,s)),s.splice(n,0,r)},l.empty=function(t,e){var s,a;if(!r(e)&&(null!=t&&(s=l.get(t,e)))){if("string"==typeof s)return l.set(t,e,"");if(function(t){return"boolean"==typeof t||"[object Boolean]"===n(t)}(s))return l.set(t,e,!1);if("number"==typeof s)return l.set(t,e,0);if(i(s))s.length=0;else{if(!function(t){return"object"==typeof t&&"[object Object]"===n(t)}(s))return l.set(t,e,null);for(a in s)o(s,a)&&delete s[a]}}},l.push=function(t,e){var r=l.get(t,e);i(r)||(r=[],l.set(t,e,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},l.coalesce=function(t,e,r){for(var n,i=0,s=e.length;i<s;i++)if(void 0!==(n=l.get(t,e[i])))return n;return r},l.get=function(t,e,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return r;if("string"==typeof e)return l.get(t,e.split("."),r);var n=s(e[0]),i=a(t,n);return void 0===i?r:1===e.length?i:l.get(t[n],e.slice(1),r)},l.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(r(e))return t;if("string"==typeof e)return l.del(t,e.split("."));var n=s(e[0]);return a(t,n),o(t,n)?1!==e.length?l.del(t[n],e.slice(1)):(i(t)?t.splice(n,1):delete t[n],t):t},l}var a=o();return a.create=o,a.withInheritedProps=o({includeInheritedProps:!0}),a}))},1368:t=>{t.exports=function(t){"use strict";var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(t,e){var r=t[0],n=t[1],i=t[2],s=t[3];n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+e[1]-389564586|0)<<12|s>>>20)+r|0)&r|~s&n)+e[2]+606105819|0)<<17|i>>>15)+s|0)&s|~i&r)+e[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+e[5]+1200080426|0)<<12|s>>>20)+r|0)&r|~s&n)+e[6]-1473231341|0)<<17|i>>>15)+s|0)&s|~i&r)+e[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+e[9]-1958414417|0)<<12|s>>>20)+r|0)&r|~s&n)+e[10]-42063|0)<<17|i>>>15)+s|0)&s|~i&r)+e[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+e[13]-40341101|0)<<12|s>>>20)+r|0)&r|~s&n)+e[14]-1502002290|0)<<17|i>>>15)+s|0)&s|~i&r)+e[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+e[6]-1069501632|0)<<9|s>>>23)+r|0)&n|r&~n)+e[11]+643717713|0)<<14|i>>>18)+s|0)&r|s&~r)+e[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+e[10]+38016083|0)<<9|s>>>23)+r|0)&n|r&~n)+e[15]-660478335|0)<<14|i>>>18)+s|0)&r|s&~r)+e[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+e[14]-1019803690|0)<<9|s>>>23)+r|0)&n|r&~n)+e[3]-187363961|0)<<14|i>>>18)+s|0)&r|s&~r)+e[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+e[2]-51403784|0)<<9|s>>>23)+r|0)&n|r&~n)+e[7]+1735328473|0)<<14|i>>>18)+s|0)&r|s&~r)+e[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+e[8]-2022574463|0)<<11|s>>>21)+r|0)^r^n)+e[11]+1839030562|0)<<16|i>>>16)+s|0)^s^r)+e[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+e[4]+1272893353|0)<<11|s>>>21)+r|0)^r^n)+e[7]-155497632|0)<<16|i>>>16)+s|0)^s^r)+e[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+e[0]-358537222|0)<<11|s>>>21)+r|0)^r^n)+e[3]-722521979|0)<<16|i>>>16)+s|0)^s^r)+e[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+e[12]-421815835|0)<<11|s>>>21)+r|0)^r^n)+e[15]+530742520|0)<<16|i>>>16)+s|0)^s^r)+e[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+e[7]+1126891415|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[14]-1416354905|0)<<15|i>>>17)+s|0)|~r))+e[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+e[3]-1894986606|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[10]-1051523|0)<<15|i>>>17)+s|0)|~r))+e[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+e[15]-30611744|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[6]-1560198380|0)<<15|i>>>17)+s|0)|~r))+e[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+e[11]-1120210379|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[2]+718787259|0)<<15|i>>>17)+s|0)|~r))+e[9]-343485551|0)<<21|n>>>11)+i|0,t[0]=r+t[0]|0,t[1]=n+t[1]|0,t[2]=i+t[2]|0,t[3]=s+t[3]|0}function n(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r}function i(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return r}function s(t){var e,i,s,o,a,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)r(u,n(t.substring(e-64,e)));for(i=(t=t.substring(e-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(r(u,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,r(u,s),u}function o(t){var e,n,s,o,a,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)r(u,i(t.subarray(e-64,e)));for(n=(t=e-64<c?t.subarray(e-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=t[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(r(u,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,r(u,s),u}function a(t){var r,n="";for(r=0;r<4;r+=1)n+=e[t>>8*r+4&15]+e[t>>8*r&15];return n}function l(t){var e;for(e=0;e<t.length;e+=1)t[e]=a(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function u(t,e){var r,n=t.length,i=new ArrayBuffer(n),s=new Uint8Array(i);for(r=0;r<n;r+=1)s[r]=t.charCodeAt(r);return e?s:i}function h(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function d(t,e,r){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t)),n.set(new Uint8Array(e),t.byteLength),r?n:n.buffer}function f(t){var e,r=[],n=t.length;for(e=0;e<n-1;e+=2)r.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return l(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(r,n){var i,s,o,a,l=this.byteLength,c=e(r,l),u=l;return n!==t&&(u=e(n,l)),c>u?new ArrayBuffer(0):(i=u-c,s=new ArrayBuffer(i),o=new Uint8Array(s),a=new Uint8Array(this,c,i),o.set(a),s)}}(),p.prototype.append=function(t){return this.appendBinary(c(t)),this},p.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;e<=i;e+=64)r(this._hash,n(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},p.prototype.end=function(t){var e,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(s,i),r=l(this._hash),t&&(r=f(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(t,e){var n,i,s,o=e;if(t[o>>2]|=128<<(o%4<<3),o>55)for(r(this._hash,t),o=0;o<16;o+=1)t[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),s=parseInt(n[1],16)||0,t[14]=i,t[15]=s,r(this._hash,t)},p.hash=function(t,e){return p.hashBinary(c(t),e)},p.hashBinary=function(t,e){var r=l(s(t));return e?f(r):r},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(t){var e,n=d(this._buff.buffer,t,!0),s=n.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)r(this._hash,i(n.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(t){var e,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=n[e]<<(e%4<<3);return this._finish(s,i),r=l(this._hash),t&&(r=f(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var t=p.prototype.getState.call(this);return t.buff=h(t.buff),t},p.ArrayBuffer.prototype.setState=function(t){return t.buff=u(t.buff,!0),p.prototype.setState.call(this,t)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(t,e){var r=l(o(new Uint8Array(t)));return e?f(r):r},p}()},8322:t=>{t.exports=function(t){"use strict";var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(t,e){var r=t[0],n=t[1],i=t[2],s=t[3];n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+e[1]-389564586|0)<<12|s>>>20)+r|0)&r|~s&n)+e[2]+606105819|0)<<17|i>>>15)+s|0)&s|~i&r)+e[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+e[5]+1200080426|0)<<12|s>>>20)+r|0)&r|~s&n)+e[6]-1473231341|0)<<17|i>>>15)+s|0)&s|~i&r)+e[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+e[9]-1958414417|0)<<12|s>>>20)+r|0)&r|~s&n)+e[10]-42063|0)<<17|i>>>15)+s|0)&s|~i&r)+e[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+e[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+e[13]-40341101|0)<<12|s>>>20)+r|0)&r|~s&n)+e[14]-1502002290|0)<<17|i>>>15)+s|0)&s|~i&r)+e[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+e[6]-1069501632|0)<<9|s>>>23)+r|0)&n|r&~n)+e[11]+643717713|0)<<14|i>>>18)+s|0)&r|s&~r)+e[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+e[10]+38016083|0)<<9|s>>>23)+r|0)&n|r&~n)+e[15]-660478335|0)<<14|i>>>18)+s|0)&r|s&~r)+e[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+e[14]-1019803690|0)<<9|s>>>23)+r|0)&n|r&~n)+e[3]-187363961|0)<<14|i>>>18)+s|0)&r|s&~r)+e[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+e[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+e[2]-51403784|0)<<9|s>>>23)+r|0)&n|r&~n)+e[7]+1735328473|0)<<14|i>>>18)+s|0)&r|s&~r)+e[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+e[8]-2022574463|0)<<11|s>>>21)+r|0)^r^n)+e[11]+1839030562|0)<<16|i>>>16)+s|0)^s^r)+e[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+e[4]+1272893353|0)<<11|s>>>21)+r|0)^r^n)+e[7]-155497632|0)<<16|i>>>16)+s|0)^s^r)+e[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+e[0]-358537222|0)<<11|s>>>21)+r|0)^r^n)+e[3]-722521979|0)<<16|i>>>16)+s|0)^s^r)+e[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+e[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+e[12]-421815835|0)<<11|s>>>21)+r|0)^r^n)+e[15]+530742520|0)<<16|i>>>16)+s|0)^s^r)+e[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+e[7]+1126891415|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[14]-1416354905|0)<<15|i>>>17)+s|0)|~r))+e[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+e[3]-1894986606|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[10]-1051523|0)<<15|i>>>17)+s|0)|~r))+e[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+e[15]-30611744|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[6]-1560198380|0)<<15|i>>>17)+s|0)|~r))+e[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+e[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+e[11]-1120210379|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+e[2]+718787259|0)<<15|i>>>17)+s|0)|~r))+e[9]-343485551|0)<<21|n>>>11)+i|0,t[0]=r+t[0]|0,t[1]=n+t[1]|0,t[2]=i+t[2]|0,t[3]=s+t[3]|0}function n(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r}function i(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return r}function s(t){var e,i,s,o,a,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)r(u,n(t.substring(e-64,e)));for(i=(t=t.substring(e-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(r(u,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,r(u,s),u}function o(t){var e,n,s,o,a,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)r(u,i(t.subarray(e-64,e)));for(n=(t=e-64<c?t.subarray(e-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=t[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(r(u,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,r(u,s),u}function a(t){var r,n="";for(r=0;r<4;r+=1)n+=e[t>>8*r+4&15]+e[t>>8*r&15];return n}function l(t){var e;for(e=0;e<t.length;e+=1)t[e]=a(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function u(t,e){var r,n=t.length,i=new ArrayBuffer(n),s=new Uint8Array(i);for(r=0;r<n;r+=1)s[r]=t.charCodeAt(r);return e?s:i}function h(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function d(t,e,r){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t)),n.set(new Uint8Array(e),t.byteLength),r?n:n.buffer}function f(t){var e,r=[],n=t.length;for(e=0;e<n-1;e+=2)r.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return l(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(r,n){var i,s,o,a,l=this.byteLength,c=e(r,l),u=l;return n!==t&&(u=e(n,l)),c>u?new ArrayBuffer(0):(i=u-c,s=new ArrayBuffer(i),o=new Uint8Array(s),a=new Uint8Array(this,c,i),o.set(a),s)}}(),p.prototype.append=function(t){return this.appendBinary(c(t)),this},p.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;e<=i;e+=64)r(this._hash,n(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},p.prototype.end=function(t){var e,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(s,i),r=l(this._hash),t&&(r=f(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(t,e){var n,i,s,o=e;if(t[o>>2]|=128<<(o%4<<3),o>55)for(r(this._hash,t),o=0;o<16;o+=1)t[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),s=parseInt(n[1],16)||0,t[14]=i,t[15]=s,r(this._hash,t)},p.hash=function(t,e){return p.hashBinary(c(t),e)},p.hashBinary=function(t,e){var r=l(s(t));return e?f(r):r},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(t){var e,n=d(this._buff.buffer,t,!0),s=n.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)r(this._hash,i(n.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(t){var e,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=n[e]<<(e%4<<3);return this._finish(s,i),r=l(this._hash),t&&(r=f(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var t=p.prototype.getState.call(this);return t.buff=h(t.buff),t},p.ArrayBuffer.prototype.setState=function(t){return t.buff=u(t.buff,!0),p.prototype.setState.call(this,t)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(t,e){var r=l(o(new Uint8Array(t)));return e?f(r):r},p}()},2467:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;const n=r(7381);let i=n.DefaultSerializer;e.registerSerializer=function(t){i=n.extendSerializer(i,t)},e.deserialize=function(t){return i.deserialize(t)},e.serialize=function(t){return i.serialize(t)}},7381:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0,e.extendSerializer=function(t,e){const r=t.deserialize.bind(t),n=t.serialize.bind(t);return{deserialize:t=>e.deserialize(t,r),serialize:t=>e.serialize(t,n)}};const r={deserialize:t=>Object.assign(Error(t.message),{name:t.name,stack:t.stack}),serialize:t=>({__error_marker:"$$error",message:t.message,name:t.name,stack:t.stack})};e.DefaultSerializer={deserialize(t){return(e=t)&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker?r.deserialize(t):t;var e},serialize:t=>t instanceof Error?r.serialize(t):t}},8258:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")},8180:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;const n=r(8258);e.isTransferDescriptor=function(t){return t&&"object"==typeof t&&t[n.$transferable]},e.Transfer=function(t,e){if(!e){if(!(r=t)||"object"!=typeof r)throw Error();e=[t]}var r;return{[n.$transferable]:!0,send:t,transferables:e}}},3229:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(e.MasterMessageType||(e.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(e.WorkerMessageType||(e.WorkerMessageType={}))},3447:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={isWorkerRuntime:function(){const t="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||t)},postMessageToMaster:function(t,e){self.postMessage(t,e)},subscribeToMasterMessages:function(t){const e=e=>{t(e.data)};return self.addEventListener("message",e),()=>{self.removeEventListener("message",e)}}}},1934:function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const s=i(r(6898)),o=r(2467),a=r(8180),l=r(3229),c=i(r(3447));var u=r(2467);Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return u.registerSerializer}});var h=r(8180);Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return h.Transfer}}),e.isWorkerRuntime=c.default.isWorkerRuntime;let d=!1;const f=new Map,p=t=>t&&t.type===l.MasterMessageType.run,y=t=>s.default(t)||function(t){return t&&"object"==typeof t&&"function"==typeof t.subscribe}(t);function v(t){return a.isTransferDescriptor(t)?{payload:t.send,transferables:t.transferables}:{payload:t,transferables:void 0}}function g(t,e){const{payload:r,transferables:n}=v(e),i={type:l.WorkerMessageType.error,uid:t,error:o.serialize(r)};c.default.postMessageToMaster(i,n)}function m(t,e,r){const{payload:n,transferables:i}=v(r),s={type:l.WorkerMessageType.result,uid:t,complete:!!e||void 0,payload:n};c.default.postMessageToMaster(s,i)}function b(t){try{const e={type:l.WorkerMessageType.uncaughtError,error:o.serialize(t)};c.default.postMessageToMaster(e)}catch(e){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",e,"\nOriginal error:",t)}}function w(t,e,r){return n(this,void 0,void 0,(function*(){let n;try{n=e(...r)}catch(e){return g(t,e)}const i=y(n)?"observable":"promise";if(function(t,e){const r={type:l.WorkerMessageType.running,uid:t,resultType:e};c.default.postMessageToMaster(r)}(t,i),y(n)){const e=n.subscribe((e=>m(t,!1,o.serialize(e))),(e=>{g(t,o.serialize(e)),f.delete(t)}),(()=>{m(t,!0),f.delete(t)}));f.set(t,e)}else try{const e=yield n;m(t,!0,o.serialize(e))}catch(e){g(t,o.serialize(e))}}))}e.expose=function(t){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(d)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(d=!0,"function"==typeof t)c.default.subscribeToMasterMessages((e=>{p(e)&&!e.method&&w(e.uid,t,e.args.map(o.deserialize))})),function(){const t={type:l.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(t)}();else{if("object"!=typeof t||!t)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${t}`);c.default.subscribeToMasterMessages((e=>{p(e)&&e.method&&w(e.uid,t[e.method],e.args.map(o.deserialize))}));!function(t){const e={type:l.WorkerMessageType.init,exposed:{type:"module",methods:t}};c.default.postMessageToMaster(e)}(Object.keys(t).filter((e=>"function"==typeof t[e])))}c.default.subscribeToMasterMessages((t=>{if((e=t)&&e.type===l.MasterMessageType.cancel){const e=t.uid,r=f.get(e);r&&(r.unsubscribe(),f.delete(e))}var e}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",(t=>{setTimeout((()=>b(t.error||t)),250)})),self.addEventListener("unhandledrejection",(t=>{const e=t.reason;e&&"string"==typeof e.message&&setTimeout((()=>b(e)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",(t=>{setTimeout((()=>b(t)),250)})),process.on("unhandledRejection",(t=>{t&&"string"==typeof t.message&&setTimeout((()=>b(t)),250)})))},693:()=>{},199:()=>{}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";r(4063),r(1528);function t(t){return"string"==typeof t?t:t.key}var e=r(3050),n=r.n(e),i=(r(6313),r(8322)),s=r.n(i),o=r(9134),a=r.n(o);let l=0;function c(){let t=(new Date).getTime();return t<=l&&(t=l+1),l=t,t}function u(t=0){return new Promise((e=>setTimeout(e,t)))}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);const h=Promise.resolve();function d(t=null){return"object"==typeof window&&window.requestIdleCallback?new Promise((e=>window.requestIdleCallback(e,{timeout:t}))):u(0)}function f(t){if(!t)throw new Error("ensureNotFalsy() is falsy");return t}function p(t=10){let e="";const r="abcdefghijklmnopqrstuvwxyz";for(let n=0;n<t;n++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}function y(t){return Object.assign({},t)}a()();function v(t){const e=t.split("-");return{height:parseInt(e[0],10),hash:e[1]}}function g(t){const e=Object.assign({},t,{_rev_tree:void 0}),r=JSON.stringify(e);return s().hash(r)}function m(t,e){const r=t.get(e);if(!r)throw new Error("missing value from map "+e);return r}var b=function(t,e){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},b(t,e)};function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}Object.create;function I(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function S(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,s=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function k(t,e){for(var r=0,n=e.length,i=t.length;r<n;r++,i++)t[i]=e[r];return t}Object.create;function O(t){return"function"==typeof t}function x(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var C=x((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function _(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var P=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,r,n,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=I(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(O(l))try{l()}catch(t){i=t instanceof C?t.errors:[t]}var c=this._teardowns;if(c){this._teardowns=null;try{for(var u=I(c),h=u.next();!h.done;h=u.next()){var d=h.value;try{E(d)}catch(t){i=null!=i?i:[],t instanceof C?i=k(k([],S(i)),S(t.errors)):i.push(t)}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(i)throw new C(i)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)E(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&_(e,t)},t.prototype.remove=function(e){var r=this._teardowns;r&&_(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),A=P.EMPTY;function D(t){return t instanceof P||t&&"closed"in t&&O(t.remove)&&O(t.add)&&O(t.unsubscribe)}function E(t){O(t)?t():t.unsubscribe()}var j={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},M={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=M.delegate;return((null==r?void 0:r.setTimeout)||setTimeout).apply(void 0,k([],S(t)))},clearTimeout:function(t){var e=M.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function L(t){M.setTimeout((function(){var e=j.onUnhandledError;if(!e)throw t;e(t)}))}function N(){}var $=z("C",void 0,void 0);function z(t,e,r){return{kind:t,value:e,error:r}}var T=null;function q(t){if(j.useDeprecatedSynchronousErrorHandling){var e=!T;if(e&&(T={errorThrown:!1,error:null}),t(),e){var r=T,n=r.errorThrown,i=r.error;if(T=null,n)throw i}}else t()}function B(t){j.useDeprecatedSynchronousErrorHandling&&T&&(T.errorThrown=!0,T.error=t)}var F=function(t){function e(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,D(e)&&e.add(r)):r.destination=J,r}return w(e,t),e.create=function(t,e,r){return new R(t,e,r)},e.prototype.next=function(t){this.isStopped?V(function(t){return z("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?V(z("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?V($,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(P),R=function(t){function e(e,r,n){var i,s=t.call(this)||this;if(O(e))i=e;else if(e){var o;i=e.next,r=e.error,n=e.complete,s&&j.useDeprecatedNextContext?(o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()}:o=e,i=null==i?void 0:i.bind(o),r=null==r?void 0:r.bind(o),n=null==n?void 0:n.bind(o)}return s.destination={next:i?U(i,s):N,error:U(null!=r?r:W,s),complete:n?U(n,s):N},s}return w(e,t),e}(F);function U(t,e){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{t.apply(void 0,k([],S(e)))}catch(t){j.useDeprecatedSynchronousErrorHandling?B(t):L(t)}}}function W(t){throw t}function V(t,e){var r=j.onStoppedNotification;r&&M.setTimeout((function(){return r(t,e)}))}var J={closed:!0,next:N,error:W,complete:N},K="function"==typeof Symbol&&Symbol.observable||"@@observable";function Q(t){return t}function H(t){return 0===t.length?Q:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var G=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n,i=this,s=(n=t)&&n instanceof F||function(t){return t&&O(t.next)&&O(t.error)&&O(t.complete)}(n)&&D(n)?t:new R(t,e,r);return q((function(){var t=i,e=t.operator,r=t.source;s.add(e?e.call(s,r):r?i._subscribe(s):i._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=Y(e))((function(e,n){var i;i=r.subscribe((function(e){try{t(e)}catch(t){n(t),null==i||i.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[K]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return H(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Y(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function Y(t){var e;return null!==(e=null!=t?t:j.Promise)&&void 0!==e?e:Promise}var X=x((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Z=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return w(e,t),e.prototype.lift=function(t){var e=new tt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new X},e.prototype.next=function(t){var e=this;q((function(){var r,n;if(e._throwIfClosed(),!e.isStopped){var i=e.observers.slice();try{for(var s=I(i),o=s.next();!o.done;o=s.next()){o.value.next(t)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}}))},e.prototype.error=function(t){var e=this;q((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var r=e.observers;r.length;)r.shift().error(t)}}))},e.prototype.complete=function(){var t=this;q((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,r=e.hasError,n=e.isStopped,i=e.observers;return r||n?A:(i.push(t),new P((function(){return _(i,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,r=e.hasError,n=e.thrownError,i=e.isStopped;r?t.error(n):i&&t.complete()},e.prototype.asObservable=function(){var t=new G;return t.source=this,t},e.create=function(t,e){return new tt(t,e)},e}(G),tt=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return w(e,t),e.prototype.next=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)},e.prototype.error=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:A},e}(Z);const et={isDevMode:()=>!1,deepFreezeWhenDevMode:t=>t,validatePassword(t){throw function(t){const e=t.split("-");let r="RxDB";return e.forEach((t=>{var e;r+=(e=t,(e+="").charAt(0).toUpperCase()+e.substr(1))})),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { ${r} } from 'rxdb/plugins/${t}';\n            addRxPlugin(${r});\n        `)}("encryption")},tunnelErrorMessage:t=>`RxDB Error-Code ${t}.\n        - To find out what this means, use the dev-mode-plugin https://pubkey.github.io/rxdb/custom-build.html#dev-mode\n        - Or search for this code https://github.com/pubkey/rxdb/search?q=${t}\n        `};function rt(t,e,r){return"RxError ("+e+"):\n"+t+"\n"+function(t){let e="";return 0===Object.keys(t).length||(e+="Given parameters: {\n",e+=Object.keys(t).map((e=>{let r="[object Object]";try{r=JSON.stringify(t[e],((t,e)=>void 0===e?null:e),2)}catch(t){}return e+":"+r})).join("\n"),e+="}"),e}(r)}class nt extends Error{constructor(t,e,r={}){const n=rt(e,t,r);super(n),this.code=t,this.message=n,this.parameters=r,this.rxdb=!0}get name(){return"RxError ("+this.code+")"}toString(){return this.message}get typeError(){return!1}}TypeError;function it(t,e){return new nt(t,et.tunnelErrorMessage(t),e)}var st=r(5643),ot=r.n(st);const at={add:function(t){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){t()}),!0),window.addEventListener("unload",(function(){t()}),!0)}}};var lt=r(199),ct=r.n(lt),ut=ot()?ct():at,ht=new Set,dt=!1;function ft(t){if(dt||(dt=!0,ut.add(pt)),"function"!=typeof t)throw new Error("Listener is no function");return ht.add(t),{remove:function(){return ht.delete(t)},run:function(){return ht.delete(t),t()}}}function pt(){var t=[];return ht.forEach((function(e){t.push(e()),ht.delete(e)})),Promise.all(t)}class yt{constructor(t,e){this.lokiDatabase=t,this.databaseSettings=e,this.writesSinceLastRun=0,this.saveQueue=h,this.saveQueueC=0}addWrite(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()}async run(){return!this.databaseSettings.adapter||this.saveQueueC>2||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then((async()=>{if(await Promise.all([d(),u(100)]),0===this.writesSinceLastRun)return;if(await Promise.all([d(),u(100)]),await d(),0===this.writesSinceLastRun)return;const t=this.writesSinceLastRun;return this.writesSinceLastRun=0,new Promise(((e,r)=>{this.lokiDatabase.saveDatabase((n=>{n?(this.writesSinceLastRun=this.writesSinceLastRun+t,r(n)):(this.databaseSettings.autosaveCallback&&this.databaseSettings.autosaveCallback(),e())}))}))})).catch((()=>{})).then((()=>{this.saveQueueC=this.saveQueueC-1}))),this.saveQueue}}Promise.resolve(!1);var vt=Promise.resolve(!0),gt=Promise.resolve();function mt(t,e){return t||(t=0),new Promise((function(r){return setTimeout((function(){return r(e)}),t)}))}function bt(){return Math.random().toString(36).substring(2)}var wt=0,It=0;function St(){var t=(new Date).getTime();return t===wt?1e3*t+ ++It:(wt=t,It=0,1e3*t)}var kt="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);const Ot={create:function(t){var e={messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e},close:function(t){t.bc.close(),t.subFns=[]},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){try{return t.bc.postMessage(e,!1),gt}catch(t){return Promise.reject(t)}},canBeUsed:function(){if(kt&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:St};var xt=function(){function t(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}return t.prototype.has=function(t){return this.set.has(t)},t.prototype.add=function(t){var e=this;this.timeMap.set(t,Ct()),this.set.add(t),setTimeout((function(){!function(t){var e=Ct()-t.ttl,r=t.set[Symbol.iterator]();for(;;){var n=r.next().value;if(!n)return;if(!(t.timeMap.get(n)<e))return;t.timeMap.delete(n),t.set.delete(n)}}(e)}),0)},t.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},t}();function Ct(){return(new Date).getTime()}function _t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.parse(JSON.stringify(t));return void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&"function"==typeof t.idb.onclose&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}var Pt="messages";function At(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function Dt(t,e){var r=t.transaction(Pt).objectStore(Pt),n=[];return new Promise((function(t){(function(){try{var t=IDBKeyRange.bound(e+1,1/0);return r.openCursor(t)}catch(t){return r.openCursor()}}()).onsuccess=function(r){var i=r.target.result;i?i.value.id<e+1?i.continue(e+1):(n.push(i.value),i.continue()):t(n)}}))}function Et(t,e){return function(t,e){var r=(new Date).getTime()-e,n=t.transaction(Pt).objectStore(Pt),i=[];return new Promise((function(t){n.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var s=n.value;if(!(s.time<r))return void t(i);i.push(s),n.continue()}else t(i)}}))}(t,e).then((function(e){return Promise.all(e.map((function(e){return function(t,e){var r=t.transaction([Pt],"readwrite").objectStore(Pt).delete(e);return new Promise((function(t){r.onsuccess=function(){return t()}}))}(t,e.id)})))}))}function jt(t){t.closed||Mt(t).then((function(){return mt(t.options.idb.fallbackInterval)})).then((function(){return jt(t)}))}function Mt(t){return t.closed?gt:t.messagesCallback?Dt(t.db,t.lastCursorId).then((function(e){var r=e.filter((function(t){return!!t})).map((function(e){return e.id>t.lastCursorId&&(t.lastCursorId=e.id),e})).filter((function(e){return function(t,e){return!(t.uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime)}(e,t)})).sort((function(t,e){return t.time-e.time}));return r.forEach((function(e){t.messagesCallback&&(t.eMIs.add(e.id),t.messagesCallback(e.data))})),gt})):gt}const Lt={create:function(t,e){return e=_t(e),function(t){var e="pubkey.broadcast-channel-0-"+t,r=At().open(e,1);return r.onupgradeneeded=function(t){t.target.result.createObjectStore(Pt,{keyPath:"id",autoIncrement:!0})},new Promise((function(t,e){r.onerror=function(t){return e(t)},r.onsuccess=function(){t(r.result)}}))}(t).then((function(r){var n={closed:!1,lastCursorId:0,channelName:t,options:e,uuid:bt(),eMIs:new xt(2*e.idb.ttl),writeBlockPromise:gt,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,e.idb.onclose&&e.idb.onclose()},jt(n),n}))},close:function(t){t.closed=!0,t.db.close()},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e,Mt(t)},postMessage:function(t,e){return t.writeBlockPromise=t.writeBlockPromise.then((function(){return function(t,e,r){var n={uuid:e,time:(new Date).getTime(),data:r},i=t.transaction([Pt],"readwrite");return new Promise((function(t,e){i.oncomplete=function(){return t()},i.onerror=function(t){return e(t)},i.objectStore(Pt).add(n)}))}(t.db,t.uuid,e)})).then((function(){var e,r;0===(e=0,r=10,Math.floor(Math.random()*(r-e+1)+e))&&Et(t.db,t.options.idb.ttl)})),t.writeBlockPromise},canBeUsed:function(){return!kt&&!!At()},type:"idb",averageResponseTime:function(t){return 2*t.idb.fallbackInterval},microSeconds:St};function Nt(){var t;if("undefined"==typeof window)return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return t}function $t(t){return"pubkey.broadcastChannel-"+t}function zt(){if(kt)return!1;var t=Nt();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch(t){return!1}return!0}const Tt={create:function(t,e){if(e=_t(e),!zt())throw new Error("BroadcastChannel: localstorage cannot be used");var r=bt(),n=new xt(e.localstorage.removeTimeout),i={channelName:t,uuid:r,eMIs:n};return i.listener=function(t,e){var r=$t(t),n=function(t){t.key===r&&e(JSON.parse(t.newValue))};return window.addEventListener("storage",n),n}(t,(function(t){i.messagesCallback&&t.uuid!==r&&t.token&&!n.has(t.token)&&(t.data.time&&t.data.time<i.messagesCallbackTime||(n.add(t.token),i.messagesCallback(t.data)))})),i},close:function(t){var e;e=t.listener,window.removeEventListener("storage",e)},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(r){mt().then((function(){var n=$t(t.channelName),i={token:bt(),time:(new Date).getTime(),data:e,uuid:t.uuid},s=JSON.stringify(i);Nt().setItem(n,s);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=s,window.dispatchEvent(o),r()}))}))},canBeUsed:zt,type:"localstorage",averageResponseTime:function(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:St};var qt=St,Bt=new Set;const Ft={create:function(t){var e={name:t,messagesCallback:null};return Bt.add(e),e},close:function(t){Bt.delete(t)},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(r){return setTimeout((function(){Array.from(Bt).filter((function(e){return e.name===t.name})).filter((function(e){return e!==t})).filter((function(t){return!!t.messagesCallback})).forEach((function(t){return t.messagesCallback(e)})),r()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:qt};var Rt=[Ot,Lt,Tt];var Ut,Wt=new Set,Vt=0,Jt=function(t,e){var r,n,i;this.id=Vt++,Wt.add(this),this.name=t,Ut&&(e=Ut),this.options=_t(e),this.method=function(t){var e=[].concat(t.methods,Rt).filter(Boolean);if(t.type){if("simulate"===t.type)return Ft;var r=e.find((function(e){return e.type===t.type}));if(r)return r;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||kt||(e=e.filter((function(t){return"idb"!==t.type})));var n=e.find((function(t){return t.canBeUsed()}));if(n)return n;throw new Error("No useable method found in "+JSON.stringify(Rt.map((function(t){return t.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,n=(r=this).method.create(r.name,r.options),(i=n)&&"function"==typeof i.then?(r._prepP=n,n.then((function(t){r._state=t}))):r._state=n};function Kt(t,e,r){var n={time:t.method.microSeconds(),type:e,data:r};return(t._prepP?t._prepP:gt).then((function(){var e=t.method.postMessage(t._state,n);return t._uMP.add(e),e.catch().then((function(){return t._uMP.delete(e)})),e}))}function Qt(t){return t._addEL.message.length>0||t._addEL.internal.length>0}function Ht(t,e,r){t._addEL[e].push(r),function(t){if(!t._iL&&Qt(t)){var e=function(e){t._addEL[e.type].forEach((function(t){e.time>=t.time&&t.fn(e.data)}))},r=t.method.microSeconds();t._prepP?t._prepP.then((function(){t._iL=!0,t.method.onMessage(t._state,e,r)})):(t._iL=!0,t.method.onMessage(t._state,e,r))}}(t)}function Gt(t,e,r){t._addEL[e]=t._addEL[e].filter((function(t){return t!==r})),function(t){if(t._iL&&!Qt(t)){t._iL=!1;var e=t.method.microSeconds();t.method.onMessage(t._state,null,e)}}(t)}Jt._pubkey=!0,Jt.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return Kt(this,"message",t)},postInternal:function(t){return Kt(this,"internal",t)},set onmessage(t){var e={time:this.method.microSeconds(),fn:t};Gt(this,"message",this._onML),t&&"function"==typeof t?(this._onML=e,Ht(this,"message",e)):this._onML=null},addEventListener:function(t,e){Ht(this,t,{time:this.method.microSeconds(),fn:e})},removeEventListener:function(t,e){Gt(this,t,this._addEL[t].find((function(t){return t.fn===e})))},close:function(){var t=this;if(!this.closed){Wt.delete(this),this.closed=!0;var e=this._prepP?this._prepP:gt;return this._onML=null,this._addEL.message=[],e.then((function(){return Promise.all(Array.from(t._uMP))})).then((function(){return Promise.all(t._befC.map((function(t){return t()})))})).then((function(){return t.method.close(t._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Yt=function(t,e){var r=this;this.broadcastChannel=t,this._options=e,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=bt(),this._aplQ=gt,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var n=function(t){"leader"===t.context&&("death"===t.action&&(r.hasLeader=!1),"tell"===t.action&&(r.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",n),this._lstns.push(n)};function Xt(t,e){var r={context:"leader",action:e,token:t.token};return t.broadcastChannel.postInternal(r)}function Zt(t,e){if(t._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");e=function(t,e){return t||(t={}),(t=JSON.parse(JSON.stringify(t))).fallbackInterval||(t.fallbackInterval=3e3),t.responseTime||(t.responseTime=e.method.averageResponseTime(e.options)),t}(e,t);var r=new Yt(t,e);return t._befC.push((function(){return r.die()})),t._leaderElector=r,r}Yt.prototype={applyOnce:function(t){var e=this;if(this.isLeader)return mt(0,!0);if(this.isDead)return mt(0,!1);if(this._aplQC>1)return this._aplQ;var r=function(){if(e.isLeader)return vt;var r,n=!1,i=new Promise((function(t){r=function(){n=!0,t()}})),s=[],o=function(t){"leader"===t.context&&t.token!=e.token&&(s.push(t),"apply"===t.action&&t.token>e.token&&r(),"tell"===t.action&&(r(),e.hasLeader=!0))};e.broadcastChannel.addEventListener("internal",o);var a=t?4*e._options.responseTime:e._options.responseTime;return Xt(e,"apply").then((function(){return Promise.race([mt(a),i.then((function(){return Promise.reject(new Error)}))])})).then((function(){return Xt(e,"apply")})).then((function(){return Promise.race([mt(a),i.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return e.broadcastChannel.removeEventListener("internal",o),!n&&function(t){t.isLeader=!0,t.hasLeader=!0;var e=ft((function(){return t.die()}));t._unl.push(e);var r=function(e){"leader"===e.context&&"apply"===e.action&&Xt(t,"tell"),"leader"!==e.context||"tell"!==e.action||t._dpLC||(t._dpLC=!0,t._dpL(),Xt(t,"tell"))};return t.broadcastChannel.addEventListener("internal",r),t._lstns.push(r),Xt(t,"tell")}(e).then((function(){return!0}))}))};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return r()})).then((function(){e._aplQC=e._aplQC-1})),this._aplQ.then((function(){return e.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(t){if(t.isLeader)return gt;return new Promise((function(e){var r=!1;function n(){r||(r=!0,t.broadcastChannel.removeEventListener("internal",i),e(!0))}t.applyOnce().then((function(){t.isLeader&&n()})),function e(){return mt(t._options.fallbackInterval).then((function(){if(!t.isDead&&!r)return t.isLeader?void n():t.applyOnce(!0).then((function(){t.isLeader?n():e()}))}))}();var i=function(e){"leader"===e.context&&"death"===e.action&&(t.hasLeader=!1,t.applyOnce().then((function(){t.isLeader&&n()})))};t.broadcastChannel.addEventListener("internal",i),t._lstns.push(i)}))}(this)),this._aLP},set onduplicate(t){this._dpL=t},die:function(){var t=this;return this._lstns.forEach((function(e){return t.broadcastChannel.removeEventListener("internal",e)})),this._lstns=[],this._unl.forEach((function(t){return t.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,Xt(this,"death")}};const te="-rxdb-changes",ee="rxdb-lokijs-remote-request",re="rxdb-lokijs-remote-request-key-object";function ne(t){if(!t.$loki)return t;const e=y(t);return delete e.$loki,delete e.$lastWriteAt,e}function ie(t,e,r){return(t?"local":"non-local")+"|"+e+"|"+r}const se=new Set,oe={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},ae=new Map;function le(t,e){let r=ae.get(t);if(!r){const i=!!e.adapter;r=(async()=>{let r=i?"adapter":"memory";e.persistenceMethod&&(r=e.persistenceMethod);const s=Object.assign({autoload:i,persistenceMethod:r,verbose:!0},e,{autoload:!1,autosave:!1,throttledSaves:!1}),o=new(n())(t+".db",y(s)),a=new yt(o,s);if(i){const t=new Promise(((t,e)=>{o.loadDatabase({},(r=>{s.autoloadCallback&&s.autoloadCallback(r),r?e(r):t()}))}));a.saveQueue=a.saveQueue.then((()=>t)),await t}const l=[];i&&l.push(ft((()=>a.run())));return{database:o,databaseSettings:s,saveQueue:a,collections:{},unloads:l}})(),ae.set(t,r)}return r}async function ce(t,e){const r=await ae.get(t);r&&(await r.saveQueue.run(),e.forEach((t=>{const e=t.name;delete r.collections[e]})),0===Object.keys(r.collections).length&&(ae.delete(t),r.unloads.forEach((t=>t.remove())),await new Promise(((t,e)=>{r.database.close((r=>{r?e(r):t()}))}))))}function ue(e,r){const n=t(e.primaryKey),i=r.sort?r.sort:[{[n]:"asc"}];return(t,e)=>{let n=0;if(i.find((r=>{const i=Object.keys(r)[0],s="asc"===Object.values(r)[0]?1:-1,o=t[i],a=e[i];return o!==a&&(o>a?(n=1*s,!0):(n=-1*s,!0))})),!n)throw it("SNH",{args:{query:r,a:t,b:e}});return n}}function he(t,e){let r=t.leaderElectorByLokiDbName.get(e);if(r)r.intancesCount=r.intancesCount+1;else{r={leaderElector:Zt(new Jt("rxdb-lokijs-"+e)),intancesCount:1},t.leaderElectorByLokiDbName.set(e,r)}return r.leaderElector}function de(t,e){const r=t.leaderElectorByLokiDbName.get(e);r&&(r.intancesCount=r.intancesCount-1,0===r.intancesCount&&(r.leaderElector.broadcastChannel.close(),t.leaderElectorByLokiDbName.delete(e)))}let fe=c();class pe{constructor(e,r,n,i,s,o,a){this.storage=e,this.databaseName=r,this.collectionName=n,this.schema=i,this.internals=s,this.options=o,this.databaseSettings=a,this.changes$=new Z,this.lastChangefeedSequence=0,this.instanceId=fe++,this.closed=!1,this.primaryPath=t(this.schema.primaryKey),se.add(this),this.internals.leaderElector&&this.internals.leaderElector.awaitLeadership().then((()=>{f(this.internals.leaderElector).broadcastChannel.addEventListener("message",(async t=>{if(t.type===ee&&t.requestId&&t.databaseName===this.databaseName&&t.collectionName===this.collectionName&&!t.response){const e=t.operation,r=t.params;let n,i=!1;try{n=await this[e](...r)}catch(t){n=t,i=!0}const s={response:!0,requestId:t.requestId,databaseName:this.databaseName,collectionName:this.collectionName,result:n,isError:i,type:t.type};f(this.internals.leaderElector).broadcastChannel.postMessage(s)}}))}))}getLocalState(){return f(this.internals.localState)}async mustUseLocalState(){if(this.closed)return!1;if(this.internals.localState)return this.internals.localState;const t=f(this.internals.leaderElector);for(;!t.hasLeader;)await t.applyOnce(),await u(0);return this.internals.localState?this.internals.localState:!(!t.isLeader||this.internals.localState)&&(this.internals.localState=ye({databaseName:this.databaseName,collectionName:this.collectionName,options:this.options,schema:this.schema,multiInstance:!!this.internals.leaderElector},this.databaseSettings),this.getLocalState())}async requestRemoteInstance(t,e){const r=f(this.internals.leaderElector).broadcastChannel,n=p(12),i=new Promise(((t,e)=>{const i=s=>{s.type===ee&&!0===s.response&&s.requestId===n&&(s.isError?(r.removeEventListener("message",i),e(s.result)):(r.removeEventListener("message",i),t(s.result)))};r.addEventListener("message",i)}));r.postMessage({response:!1,type:ee,operation:t,params:e,requestId:n,databaseName:this.databaseName,collectionName:this.collectionName});return await i}async addChangeDocumentMeta(t){const e=await this.getLocalState();if(!this.lastChangefeedSequence){const t=e.changesCollection.chain().simplesort("sequence",!0).limit(1).data()[0];t&&(this.lastChangefeedSequence=t.sequence)}const r=this.lastChangefeedSequence+1;e.changesCollection.insert({id:t,sequence:r}),this.lastChangefeedSequence=r}async bulkWrite(t){if(0===t.length)throw it("P2",{args:{documentWrites:t}});const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("bulkWrite",[t]);await u(0);const r={success:{},error:{}},n={id:p(10),events:[]};return t.forEach((t=>{const i=c(),s=t.document[this.primaryPath],o=e.collection.by(this.primaryPath,s);if(o){const a=o._rev;if(!t.previous&&o._deleted&&(t.previous=o),!t.previous&&!o._deleted||t.previous&&a!==t.previous._rev){const e={isError:!0,status:409,documentId:s,writeRow:t};r.error[s]=e}else{const l=v(a).height+1+"-"+g(t.document),u=!!t.document._deleted,h=Object.assign({},t.document,{$loki:o.$loki,$lastWriteAt:i,_rev:l,_deleted:u,_attachments:{}});e.collection.update(h),this.addChangeDocumentMeta(s);let d=null;if(t.previous&&t.previous._deleted&&!h._deleted)d={id:s,operation:"INSERT",previous:null,doc:ne(h)};else if(!t.previous||t.previous._deleted||h._deleted){if(t.previous&&!t.previous._deleted&&h._deleted){const e=y(t.previous);e._rev=l,d={id:s,operation:"DELETE",previous:e,doc:null}}}else d={id:s,operation:"UPDATE",previous:t.previous,doc:ne(h)};if(!d)throw it("SNH",{args:{writeRow:t}});n.events.push({eventId:ie(!1,s,l),documentId:s,change:d,startTime:i,endTime:c()}),r.success[s]=ne(h)}}else{const o="1-"+g(t.document),a=!!t.document._deleted,l=Object.assign({},t.document,{_rev:o,_deleted:a,_attachments:{}}),u=y(l);u.$lastWriteAt=i,e.collection.insert(u),a||(this.addChangeDocumentMeta(s),n.events.push({eventId:ie(!1,s,o),documentId:s,change:{doc:l,id:s,operation:"INSERT",previous:null},startTime:i,endTime:c()})),r.success[s]=l}})),e.databaseState.saveQueue.addWrite(),this.changes$.next(n),r}async bulkAddRevisions(t){if(0===t.length)throw it("P3",{args:{documents:t}});const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("bulkAddRevisions",[t]);await u(0);const r={id:p(10),events:[]};t.forEach((t=>{const n=c(),i=t[this.primaryPath],s=e.collection.by(this.primaryPath,i);if(s){const o=v(t._rev),a=v(s._rev);let l=!1;if(o.height!==a.height?o.height>a.height&&(l=!0):o.hash>a.hash&&(l=!0),l){const o=y(t);o.$loki=s.$loki,o.$lastWriteAt=n,e.collection.update(o);let a=null;s._deleted&&!t._deleted?a={id:i,operation:"INSERT",previous:null,doc:t}:s._deleted||t._deleted?!s._deleted&&t._deleted?a={id:i,operation:"DELETE",previous:ne(s),doc:null}:s._deleted&&t._deleted&&(a=null):a={id:i,operation:"UPDATE",previous:ne(s),doc:t},a&&(r.events.push({documentId:i,eventId:ie(!1,i,t._rev),change:a,startTime:n,endTime:c()}),this.addChangeDocumentMeta(i))}}else{const s=y(t);s.$lastWriteAt=n,e.collection.insert(s),r.events.push({documentId:i,eventId:ie(!1,i,t._rev),change:{doc:t,id:i,operation:"INSERT",previous:null},startTime:n,endTime:c()}),this.addChangeDocumentMeta(i)}})),e.databaseState.saveQueue.addWrite(),this.changes$.next(r)}async findDocumentsById(t,e){const r=await this.mustUseLocalState();if(!r)return this.requestRemoteInstance("findDocumentsById",[t,e]);const n={};return t.forEach((t=>{const i=r.collection.by(this.primaryPath,t);!i||i._deleted&&!e||(n[t]=ne(i))})),n}async query(t){const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("query",[t]);let r=e.collection.chain().find(t.selector);t.sort&&(r=r.sort(ue(this.schema,t))),t.skip&&(r=r.offset(t.skip)),t.limit&&(r=r.limit(t.limit));return{documents:r.data().map((t=>ne(t)))}}getAttachmentData(t,e){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")}async getChangedDocuments(t){const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("getChangedDocuments",[t]);const r="before"===t.direction,n="after"===t.direction?"$gt":"$lt";let i=e.changesCollection.chain().find({sequence:{[n]:t.sinceSequence}}).simplesort("sequence",r);t.limit&&(i=i.limit(t.limit));const s=i.data().map((t=>({id:t.id,sequence:t.sequence}))),o=r?s[0]:(a=s)[a.length-1];var a;return{changedDocuments:s,lastSequence:o?o.sequence:t.sinceSequence}}changeStream(){return this.changes$.asObservable()}async close(){if(this.closed=!0,this.changes$.complete(),se.delete(this),this.internals.localState){const t=await this.internals.localState,e=await le(this.databaseName,this.databaseSettings);await e.saveQueue.run(),await ce(this.databaseName,[t.collection,t.changesCollection])}de(this.storage,this.databaseName)}async remove(){const t=await this.mustUseLocalState();if(!t)return this.requestRemoteInstance("remove",[]);t.databaseState.database.removeCollection(this.collectionName),t.databaseState.database.removeCollection(t.changesCollection.name),this.close()}}async function ye(e,r){e.options||(e.options={});const n=await le(e.databaseName,r),i=[];e.schema.indexes&&e.schema.indexes.forEach((t=>{Array.isArray(t)||i.push(t)}));const s=t(e.schema.primaryKey);i.push(s);const o=Object.assign({},e.options.collection,{indices:i,unique:[s]},oe),a=n.database.addCollection(e.collectionName,o);n.collections[e.collectionName]=a;const l=e.collectionName+te,c=Object.assign({unique:["eventId"],indices:["sequence"]},oe),u=n.database.addCollection(l,c);n.collections[e.collectionName]=u;return{databaseState:n,collection:a,changesCollection:u}}let ve=1;class ge{constructor(t,e,r,n,i,s){this.storage=t,this.databaseName=e,this.collectionName=r,this.internals=n,this.options=i,this.databaseSettings=s,this.changes$=new Z,this.instanceId=ve++,this.closed=!1,se.add(this),this.internals.leaderElector&&this.internals.leaderElector.awaitLeadership().then((()=>{f(this.internals.leaderElector).broadcastChannel.addEventListener("message",(async t=>{if(t.type===re&&t.requestId&&t.databaseName===this.databaseName&&t.collectionName===this.collectionName&&!t.response){const e=t.operation,r=t.params;let n,i=!1;try{n=await this[e](...r)}catch(t){i=!0,n=t}const s={response:!0,requestId:t.requestId,databaseName:this.databaseName,collectionName:this.collectionName,result:n,isError:i,type:t.type};f(this.internals.leaderElector).broadcastChannel.postMessage(s)}}))}))}getLocalState(){return f(this.internals.localState)}async mustUseLocalState(){if(this.closed)return!1;if(this.internals.localState)return this.internals.localState;const t=f(this.internals.leaderElector);for(;!t.hasLeader;)await t.applyOnce(),await u(0);return this.internals.localState?this.internals.localState:!(!t.isLeader||this.internals.localState)&&(this.internals.localState=me({databaseName:this.databaseName,collectionName:this.collectionName,options:this.options,multiInstance:!!this.internals.leaderElector},this.databaseSettings),this.getLocalState())}async requestRemoteInstance(t,e){const r=f(this.internals.leaderElector).broadcastChannel,n=p(12),i=new Promise(((t,e)=>{const i=s=>{s.type===re&&!0===s.response&&s.requestId===n&&(s.isError?(r.removeEventListener("message",i),e(s.result)):(r.removeEventListener("message",i),t(s.result)))};r.addEventListener("message",i)}));r.postMessage({response:!1,type:re,operation:t,params:e,requestId:n,databaseName:this.databaseName,collectionName:this.collectionName});return await i}async bulkWrite(t){if(0===t.length)throw it("P2",{args:{documentWrites:t}});const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("bulkWrite",[t]);const r=c();await u(0);const n={success:{},error:{}},i=new Map,s={id:p(10),events:[]};return t.forEach((t=>{const o=t.document._id;i.set(o,t);const a=y(t.document),l=e.collection.by("_id",o),u=t.previous?t.previous:e.collection.by("_id",o),h=(u?v(u._rev).height+1:1)+"-"+g(t.document);if(a._rev=h,l){if(!t.previous||l._rev!==t.previous._rev){const e={isError:!0,status:409,documentId:o,writeRow:t};return void(n.error[o]=e)}{const t=y(a);t.$loki=l.$loki,t.$lastWriteAt=r,e.collection.update(t)}}else{const t=y(a);t.$lastWriteAt=r,e.collection.insert(t)}n.success[o]=ne(a);const d=c();let f;if(t.previous)if(t.document._deleted){const e=y(t.previous);e._rev=h,f={operation:"DELETE",doc:null,id:o,previous:e}}else f={operation:"UPDATE",doc:a,id:o,previous:t.previous};else f={operation:"INSERT",doc:a,id:o,previous:null};if(!t.document._deleted||t.previous&&!t.previous._deleted){const t="DELETE"===f.operation?f.previous:f.doc,e={eventId:ie(!0,t._id,t._rev?t._rev:""),documentId:o,change:f,startTime:r,endTime:d};s.events.push(e)}else;})),e.databaseState.saveQueue.addWrite(),this.changes$.next(s),n}async findLocalDocumentsById(t){const e=await this.mustUseLocalState();if(!e)return this.requestRemoteInstance("findLocalDocumentsById",[t]);await u(0);const r={};return t.forEach((t=>{const n=e.collection.by("_id",t);n&&!n._deleted&&(r[t]=ne(n))})),r}changeStream(){return this.changes$.asObservable()}async close(){if(this.closed=!0,this.changes$.complete(),se.delete(this),this.internals.localState){const t=await this.getLocalState();await ce(this.databaseName,[f(t.collection),f(t.changesCollection)])}de(this.storage,this.databaseName)}async remove(){const t=await this.mustUseLocalState();if(!t)return this.requestRemoteInstance("remove",[]);t.databaseState.database.removeCollection(t.collection.name),t.databaseState.database.removeCollection(t.changesCollection.name),this.close()}}async function me(t,e){t.options||(t.options={});const r=await le(t.databaseName,e),n=Object.assign({},t.options.collection,{indices:[],unique:["_id"]},oe),i=r.database.addCollection(t.collectionName,n);r.collections[t.collectionName]=i;const s=t.collectionName+te,o=Object.assign({unique:["eventId"],indices:["sequence"]},oe),a=r.database.addCollection(s,o);return r.collections[s]=i,{changesCollection:a,collection:i,databaseState:r}}var be=function(t){return btoa(t)};var we=r(1368),Ie=r.n(we),Se=self.setImmediate||self.setTimeout;function ke(t,e,r,n,i){(r>0||n<e.size)&&(e=function(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.slice(e,r)}(e,r,n)),function(t,e){var r=new FileReader;r.onloadend=function(t){var r=t.target.result||new ArrayBuffer(0);e(r)},r.readAsArrayBuffer(t)}(e,(function(e){t.append(e),i()}))}function Oe(t,e,r,n,i){(r>0||n<e.length)&&(e=e.substring(r,n)),t.appendBinary(e),i()}function xe(t,e){var r="string"==typeof t,n=r?t.length:t.size,i=Math.min(32768,n),s=Math.ceil(n/i),o=0,a=r?new(Ie()):new(Ie().ArrayBuffer),l=r?Oe:ke;function c(){Se(h)}function u(){var t=function(t){return be(t)}(a.end(!0));e(t),a.destroy()}function h(){var e=o*i,r=e+i;o++,l(a,t,e,r,o<s?c:u)}h()}const Ce={hash:t=>new Promise((e=>{xe(t,(t=>{e(t)}))})),hashKey:"md5",prepareQuery(e,r){const n=t(e.primaryKey);if(Object.keys(r.selector).length>0?r.selector={$and:[{_deleted:!1},r.selector]}:r.selector={_deleted:!1},r.sort){r.sort.find((t=>{return e=t,Object.keys(e)[0]===n;var e}))||r.sort.push({[n]:"asc"})}else r.sort=[{[n]:"asc"}];return r},getSortComparator:(t,e)=>ue(t,e),getQueryMatcher:(t,e)=>t=>{const r=y(t);r._deleted=!!r._deleted;const i={data:[r],binaryIndices:{}};Object.setPrototypeOf(i,n().Collection.prototype);const s={collection:i};Object.setPrototypeOf(s,n().Resultset.prototype),s.find(e.selector,!0);return s.filteredrows.length>0}};class _e{constructor(t){this.databaseSettings=t,this.name="lokijs",this.statics=Ce,this.leaderElectorByLokiDbName=new Map}async createStorageInstance(t){return async function(t,e,r){const n={};if(e.multiInstance){const r=he(t,e.databaseName);n.leaderElector=r}else n.localState=ye(e,r),await n.localState;const i=new pe(t,e.databaseName,e.collectionName,e.schema,n,e.options,r);return e.multiInstance&&f(n.leaderElector).awaitLeadership().then((()=>{i.mustUseLocalState()})),i}(this,t,this.databaseSettings)}async createKeyObjectStorageInstance(t){return y(t).collectionName=t.collectionName+"-key-object",async function(t,e,r){const n={};if(e.multiInstance){const r=he(t,e.databaseName);n.leaderElector=r}else n.localState=me(e,r),await n.localState;const i=new ge(t,e.databaseName,e.collectionName,n,e.options,r);return e.multiInstance&&f(n.leaderElector).awaitLeadership().then((()=>i.mustUseLocalState())),i}(this,t,this.databaseSettings)}}var Pe=r(1934);const Ae=Pe.expose;Pe.registerSerializer,Pe.Transfer;!function(t){let e=0;const r=new Map,n={async createStorageInstance(n){const i=e++,s=await t.storage.createStorageInstance(n);return r.set(i,s),i},bulkWrite:(t,e)=>m(r,t).bulkWrite(e),bulkAddRevisions:(t,e)=>m(r,t).bulkAddRevisions(e),findDocumentsById:(t,e,n)=>m(r,t).findDocumentsById(e,n),query:(t,e)=>m(r,t).query(e),getAttachmentData:(t,e,n)=>m(r,t).getAttachmentData(e,n),getChangedDocuments:(t,e)=>m(r,t).getChangedDocuments(e),changeStream:t=>m(r,t).changeStream(),close:t=>m(r,t).close(),remove:t=>m(r,t).remove(),async createKeyObjectStorageInstance(n){const i=e++,s=await t.storage.createKeyObjectStorageInstance(n);return r.set(i,s),i},bulkWriteLocal:(t,e)=>m(r,t).bulkWrite(e),findLocalDocumentsById:(t,e)=>m(r,t).findLocalDocumentsById(e)};Ae(n)}({storage:function(t={}){return new _e(t)}()})})()})();
//# sourceMappingURL=lokijs-memory.worker.js.map