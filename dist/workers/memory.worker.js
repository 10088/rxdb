(()=>{"use strict";var e={898:e=>{e.exports=e=>!!e&&("symbol"==typeof Symbol.observable&&"function"==typeof e[Symbol.observable]?e===e[Symbol.observable]():"function"==typeof e["@@observable"]&&e===e["@@observable"]())},467:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.deserialize=t.registerSerializer=void 0;const r=n(381);let o=r.DefaultSerializer;t.registerSerializer=function(e){o=r.extendSerializer(o,e)},t.deserialize=function(e){return o.deserialize(e)},t.serialize=function(e){return o.serialize(e)}},381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSerializer=t.extendSerializer=void 0,t.extendSerializer=function(e,t){const n=e.deserialize.bind(e),r=e.serialize.bind(e);return{deserialize:e=>t.deserialize(e,n),serialize:e=>t.serialize(e,r)}};const n={deserialize:e=>Object.assign(Error(e.message),{name:e.name,stack:e.stack}),serialize:e=>({__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack})};t.DefaultSerializer={deserialize(e){return(t=e)&&"object"==typeof t&&"__error_marker"in t&&"$$error"===t.__error_marker?n.deserialize(e):e;var t},serialize:e=>e instanceof Error?n.serialize(e):e}},258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$worker=t.$transferable=t.$terminate=t.$events=t.$errors=void 0,t.$errors=Symbol("thread.errors"),t.$events=Symbol("thread.events"),t.$terminate=Symbol("thread.terminate"),t.$transferable=Symbol("thread.transferable"),t.$worker=Symbol("thread.worker")},180:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.isTransferDescriptor=void 0;const r=n(258);t.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[r.$transferable]},t.Transfer=function(e,t){if(!t){if(!(n=e)||"object"!=typeof n)throw Error();t=[e]}var n;return{[r.$transferable]:!0,send:e,transferables:t}}},229:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerMessageType=t.MasterMessageType=void 0,function(e){e.cancel="cancel",e.run="run"}(t.MasterMessageType||(t.MasterMessageType={})),function(e){e.error="error",e.init="init",e.result="result",e.running="running",e.uncaughtError="uncaughtError"}(t.WorkerMessageType||(t.WorkerMessageType={}))},447:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default={isWorkerRuntime:function(){const e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}}},934:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.expose=t.isWorkerRuntime=t.Transfer=t.registerSerializer=void 0;const i=o(n(898)),s=n(467),a=n(180),u=n(229),c=o(n(447));var l=n(467);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var h=n(180);Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return h.Transfer}}),t.isWorkerRuntime=c.default.isWorkerRuntime;let f=!1;const d=new Map,p=e=>e&&e.type===u.MasterMessageType.run,y=e=>i.default(e)||function(e){return e&&"object"==typeof e&&"function"==typeof e.subscribe}(e);function m(e){return a.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function v(e,t){const{payload:n,transferables:r}=m(t),o={type:u.WorkerMessageType.error,uid:e,error:s.serialize(n)};c.default.postMessageToMaster(o,r)}function g(e,t,n){const{payload:r,transferables:o}=m(n),i={type:u.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:r};c.default.postMessageToMaster(i,o)}function b(e){try{const t={type:u.WorkerMessageType.uncaughtError,error:s.serialize(e)};c.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",t,"\nOriginal error:",e)}}function w(e,t,n){return r(this,void 0,void 0,(function*(){let r;try{r=t(...n)}catch(t){return v(e,t)}const o=y(r)?"observable":"promise";if(function(e,t){const n={type:u.WorkerMessageType.running,uid:e,resultType:t};c.default.postMessageToMaster(n)}(e,o),y(r)){const t=r.subscribe((t=>g(e,!1,s.serialize(t))),(t=>{v(e,s.serialize(t)),d.delete(e)}),(()=>{g(e,!0),d.delete(e)}));d.set(e,t)}else try{const t=yield r;g(e,!0,s.serialize(t))}catch(t){v(e,s.serialize(t))}}))}t.expose=function(e){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(f)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(f=!0,"function"==typeof e)c.default.subscribeToMasterMessages((t=>{p(t)&&!t.method&&w(t.uid,e,t.args.map(s.deserialize))})),function(){const e={type:u.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(e)}();else{if("object"!=typeof e||!e)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${e}`);c.default.subscribeToMasterMessages((t=>{p(t)&&t.method&&w(t.uid,e[t.method],t.args.map(s.deserialize))}));!function(e){const t={type:u.WorkerMessageType.init,exposed:{type:"module",methods:e}};c.default.postMessageToMaster(t)}(Object.keys(e).filter((t=>"function"==typeof e[t])))}c.default.subscribeToMasterMessages((e=>{if((t=e)&&t.type===u.MasterMessageType.cancel){const t=e.uid,n=d.get(t);n&&(n.unsubscribe(),d.delete(t))}var t}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",(e=>{setTimeout((()=>b(e.error||e)),250)})),self.addEventListener("unhandledrejection",(e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout((()=>b(t)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",(e=>{setTimeout((()=>b(e)),250)})),process.on("unhandledRejection",(e=>{e&&"string"==typeof e.message&&setTimeout((()=>b(e)),250)})))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"===e(n)?n:String(n)}function r(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=u()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&i(o,n.prototype),o},c.apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return c(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i(n,e)},l(e)}var h={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+e+"\n        "};function f(e,t,n){return"RxError ("+t+"):\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="Given parameters: {\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n=JSON.stringify(e[t],((e,t)=>void 0===t?null:t),2)}catch(e){}return t+":"+n})).join("\n"),t+="}")}(n)}var d=function(e){function t(t,n,r={}){var o,i=f(n,t,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.parameters=r,o.rxdb=!0,o}return s(t,e),t.prototype.toString=function(){return this.message},o(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),t}(l(Error));TypeError;function p(e,t){return new d(e,h.tunnelErrorMessage(e),t)}function y(e){if(!e)throw new Error("ensureNotFalsy() is falsy");return e}function m(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function v(e=10){for(var t="",n="abcdefghijklmnopqrstuvwxyz",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}var g=0;function b(){var e=(new Date).getTime();(e+=.01)<=g&&(e=g+.01);var t=parseFloat(e.toFixed(2));return g=t,t}function w(e){return function(e,t){var n,r,o,i=0;if("undefined"==typeof TextEncoder||t){o=[];for(var s=0;s<e.length;s++)o.push(e.charCodeAt(s))}else o=(new TextEncoder).encode(e);for(n=0,r=e.length;n<r;n++)i=(i<<5)-i+o[n],i|=0;return i<0&&(i*=-1),i.toString(36)}(e)}function _(e){return Object.assign({},e)}function x(e){return{previous:e.previous,document:E(e.document)}}function E(e){var t=_(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,o,i;t._attachments[e]=(i=(r=n).data)?{digest:w(i),length:(o=i,atob(o).length),type:r.type}:r})),t}function k(e,t,n){var r=n.document[t],o=[!!n.previous,n.previous&&n.previous._deleted,!!n.document._deleted].map((e=>e?"1":"0")).join("");return e.databaseName+"|"+e.collectionName+"|"+r+"||"+o+"|"+n.document._rev}const O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,S=Object.keys,j=Array.isArray;function P(e,t){return"object"!=typeof t||S(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||O.Promise||(O.Promise=Promise);const A=Object.getPrototypeOf,I={}.hasOwnProperty;function T(e,t){return I.call(e,t)}function C(e,t){"function"==typeof t&&(t=t(A(e))),("undefined"==typeof Reflect?S:Reflect.ownKeys)(t).forEach((n=>{M(e,n,t[n])}))}const K=Object.defineProperty;function M(e,t,n,r){K(e,t,P(n&&T(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function D(e){return{from:function(t){return e.prototype=Object.create(t.prototype),M(e.prototype,"constructor",e),{extend:C.bind(null,e.prototype)}}}}const $=Object.getOwnPropertyDescriptor;function R(e,t){let n;return $(e,t)||(n=A(e))&&R(n,t)}const N=[].slice;function F(e,t,n){return N.call(e,t,n)}function B(e,t){return t(e)}function q(e){if(!e)throw new Error("Assertion Failed")}function L(e){O.setImmediate?setImmediate(e):setTimeout(e,0)}function z(e,t){return e.reduce(((e,n,r)=>{var o=t(n,r);return o&&(e[o[0]]=o[1]),e}),{})}function U(e,t){if(T(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=U(e,t[r]);n.push(i)}return n}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return void 0===a?void 0:U(a,t.substr(s+1))}}function W(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){q("string"!=typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)W(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var s=t.substr(0,i),a=t.substr(i+1);if(""===a)void 0===n?j(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var u=e[s];u&&T(e,s)||(u=e[s]={}),W(u,a,n)}}else void 0===n?j(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function V(e){var t={};for(var n in e)T(e,n)&&(t[n]=e[n]);return t}const Y=[].concat;function H(e){return Y.apply([],e)}const G="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(H([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>O[e])),Q=G.map((e=>O[e]));z(G,(e=>[e,!0]));let X=null;function J(e){X="undefined"!=typeof WeakMap&&new WeakMap;const t=Z(e);return X=null,t}function Z(e){if(!e||"object"!=typeof e)return e;let t=X&&X.get(e);if(t)return t;if(j(e)){t=[],X&&X.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Z(e[n]))}else if(Q.indexOf(e.constructor)>=0)t=e;else{const n=A(e);for(var o in t=n===Object.prototype?{}:Object.create(n),X&&X.set(e,t),e)T(e,o)&&(t[o]=Z(e[o]))}return t}const{toString:ee}={};function te(e){return ee.call(e).slice(8,-1)}const ne="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",re="symbol"==typeof ne?function(e){var t;return null!=e&&(t=e[ne])&&t.apply(e)}:function(){return null},oe={};function ie(e){var t,n,r,o;if(1===arguments.length){if(j(e))return e.slice();if(this===oe&&"string"==typeof e)return[e];if(o=re(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const se="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var ae="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ue(e,t){ae=e,ce=t}var ce=()=>!0;const le=!new Error("").stack;function he(){if(le)try{throw he.arguments,new Error}catch(e){return e}return new Error}function fe(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(ce).map((e=>"\n"+e)).join("")):""}var de=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],pe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(de),ye={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function me(e,t){this._e=he(),this.name=e,this.message=t}function ve(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function ge(e,t,n,r){this._e=he(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=ve(e,t)}function be(e,t){this._e=he(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=ve(e,t)}D(me).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+fe(this._e,2))}},toString:function(){return this.name+": "+this.message}}),D(ge).from(me),D(be).from(me);var we=pe.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const _e=me;var xe=pe.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=he(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=ye[t]||n,this.inner=null)}return D(r).from(_e),e[t]=r,e}),{});xe.Syntax=SyntaxError,xe.Type=TypeError,xe.Range=RangeError;var Ee=de.reduce(((e,t)=>(e[t+"Error"]=xe[t],e)),{}),ke=pe.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=xe[t]),e)),{});function Oe(){}function Se(e){return e}function je(e,t){return null==e||e===Se?t:function(n){return t(e(n))}}function Pe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ae(e,t){return e===Oe?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Pe(r,this.onsuccess):r),o&&(this.onerror=this.onerror?Pe(o,this.onerror):o),void 0!==i?i:n}}function Ie(e,t){return e===Oe?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Pe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Pe(r,this.onerror):r)}}function Te(e,t){return e===Oe?t:function(n){var r=e.apply(this,arguments);P(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?Pe(o,this.onsuccess):o),i&&(this.onerror=this.onerror?Pe(i,this.onerror):i),void 0===r?void 0===s?void 0:s:P(r,s)}}function Ce(e,t){return e===Oe?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Ke(e,t){return e===Oe?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}ke.ModifyError=ge,ke.DexieError=me,ke.BulkError=be;var Me={};const[De,$e,Re]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,A(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,A(t),e]})(),Ne=$e&&$e.then,Fe=De&&De.constructor,Be=!!Re;var qe=!1,Le=Re?()=>{Re.then(ht)}:O.setImmediate?setImmediate.bind(null,ht):O.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{ht(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(ht,0)},ze=function(e,t){Je.push([e,t]),We&&(Le(),We=!1)},Ue=!0,We=!0,Ve=[],Ye=[],He=null,Ge=Se,Qe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Dt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{Dt(e[0],e[1])}catch(e){}}))}},Xe=Qe,Je=[],Ze=0,et=[];function tt(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Oe,this._lib=!1;var t=this._PSD=Xe;if(ae&&(this._stackHolder=he(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Me)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&it(this,this._value))}this._state=null,this._value=null,++t.ref,ot(this,e)}const nt={get:function(){var e=Xe,t=_t;function n(n,r){var o=!e.global&&(e!==Xe||t!==_t);const i=o&&!Ot();var s=new tt(((t,s)=>{at(this,new rt(Kt(n,e,o,i),Kt(r,e,o,i),t,s,e))}));return ae&&lt(s,this),s}return n.prototype=Me,n},set:function(e){M(this,"then",e&&e.prototype===Me?nt:{get:function(){return e},set:nt.set})}};function rt(e,t,n,r,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=o}function ot(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&ft();t&&"function"==typeof t.then?ot(e,((e,n)=>{t instanceof tt?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,st(e)),n&&dt()}}),it.bind(null,e))}catch(t){it(e,t)}}function it(e,t){if(Ye.push(t),null===e._state){var n=e._lib&&ft();t=Ge(t),e._state=!1,e._value=t,ae&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=R(t,"stack");t._promise=e,M(t,"stack",{get:()=>qe?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Ve.some((t=>t._value===e._value))||Ve.push(e)}(e),st(e),n&&dt()}}function st(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)at(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===Ze&&(++Ze,ze((()=>{0==--Ze&&pt()}),[]))}function at(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ze,ze(ut,[n,e,t])}else e._listeners.push(t)}function ut(e,t,n){try{He=t;var r,o=t._value;t._state?r=e(o):(Ye.length&&(Ye=[]),r=e(o),-1===Ye.indexOf(o)&&function(e){for(var t=Ve.length;t;)if(Ve[--t]._value===e._value)return void Ve.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{He=null,0==--Ze&&pt(),--n.psd.ref||n.psd.finalize()}}function ct(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var o,i,s=e._value;null!=s?(o=s.name||"Error",i=s.message||s,r=fe(s,0)):(o=s,i=""),t.push(o+(i?": "+i:"")+r)}return ae&&((r=fe(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&ct(e._prev,t,n)),t}function lt(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function ht(){ft()&&dt()}function ft(){var e=Ue;return Ue=!1,We=!1,e}function dt(){var e,t,n;do{for(;Je.length>0;)for(e=Je,Je=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Je.length>0);Ue=!0,We=!0}function pt(){var e=Ve;Ve=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=et.slice(0),n=t.length;n;)t[--n]()}function yt(e){return new tt(Me,!1,e)}function mt(e,t){var n=Xe;return function(){var r=ft(),o=Xe;try{return At(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{At(o,!1),r&&dt()}}}C(tt.prototype,{then:nt,_then:function(e,t){at(this,new rt(null,null,e,t,Xe))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):yt(e))):this.then(null,(e=>e&&e.name===t?n(e):yt(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),yt(t))))},stack:{get:function(){if(this._stack)return this._stack;try{qe=!0;var e=ct(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{qe=!1}}},timeout:function(e,t){return e<1/0?new tt(((n,r)=>{var o=setTimeout((()=>r(new xe.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&M(tt.prototype,Symbol.toStringTag,"Dexie.Promise"),Qe.env=It(),C(tt,{all:function(){var e=ie.apply(null,arguments).map(St);return new tt((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((o,i)=>tt.resolve(o).then((n=>{e[i]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof tt)return e;if(e&&"function"==typeof e.then)return new tt(((t,n)=>{e.then(t,n)}));var t=new tt(Me,!0,e);return lt(t,He),t},reject:yt,race:function(){var e=ie.apply(null,arguments).map(St);return new tt(((t,n)=>{e.map((e=>tt.resolve(e).then(t,n)))}))},PSD:{get:()=>Xe,set:e=>Xe=e},totalEchoes:{get:()=>_t},newPSD:Et,usePSD:Tt,scheduler:{get:()=>ze,set:e=>{ze=e}},rejectionMapper:{get:()=>Ge,set:e=>{Ge=e}},follow:(e,t)=>new tt(((n,r)=>Et(((t,n)=>{var r=Xe;r.unhandleds=[],r.onunhandled=n,r.finalize=Pe((function(){!function(e){et.push((function t(){e(),et.splice(et.indexOf(t),1)})),++Ze,ze((()=>{0==--Ze&&pt()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),Fe&&(Fe.allSettled&&M(tt,"allSettled",(function(){const e=ie.apply(null,arguments).map(St);return new tt((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,o)=>tt.resolve(e).then((e=>r[o]={status:"fulfilled",value:e}),(e=>r[o]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),Fe.any&&"undefined"!=typeof AggregateError&&M(tt,"any",(function(){const e=ie.apply(null,arguments).map(St);return new tt(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const o=new Array(r);e.forEach(((e,i)=>tt.resolve(e).then((e=>t(e)),(e=>{o[i]=e,--r||n(new AggregateError(o))}))))}))})));const vt={awaits:0,echoes:0,id:0};var gt=0,bt=[],wt=0,_t=0,xt=0;function Et(e,t,n,r){var o=Xe,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++xt;var s=Qe.env;i.env=Be?{Promise:tt,PromiseProp:{value:tt,configurable:!0,writable:!0},all:tt.all,race:tt.race,allSettled:tt.allSettled,any:tt.any,resolve:tt.resolve,reject:tt.reject,nthen:Mt(s.nthen,i),gthen:Mt(s.gthen,i)}:{},t&&P(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Tt(i,e,n,r);return 0===i.ref&&i.finalize(),a}function kt(){return vt.id||(vt.id=++gt),++vt.awaits,vt.echoes+=100,vt.id}function Ot(){return!!vt.awaits&&(0==--vt.awaits&&(vt.id=0),vt.echoes=100*vt.awaits,!0)}function St(e){return vt.echoes&&e&&e.constructor===Fe?(kt(),e.then((e=>(Ot(),e)),(e=>(Ot(),$t(e))))):e}function jt(e){++_t,vt.echoes&&0!=--vt.echoes||(vt.echoes=vt.id=0),bt.push(Xe),At(e,!0)}function Pt(){var e=bt[bt.length-1];bt.pop(),At(e,!1)}function At(e,t){var n=Xe;if((t?!vt.echoes||wt++&&e===Xe:!wt||--wt&&e===Xe)||Ct(t?jt.bind(null,e):Pt),e!==Xe&&(Xe=e,n===Qe&&(Qe.env=It()),Be)){var r=Qe.env.Promise,o=e.env;$e.then=o.nthen,r.prototype.then=o.gthen,(n.global||e.global)&&(Object.defineProperty(O,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function It(){var e=O.Promise;return Be?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(O,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:$e.then,gthen:e.prototype.then}:{}}function Tt(e,t,n,r,o){var i=Xe;try{return At(e,!0),t(n,r,o)}finally{At(i,!1)}}function Ct(e){Ne.call(De,e)}function Kt(e,t,n,r){return"function"!=typeof e?e:function(){var o=Xe;n&&kt(),At(t,!0);try{return e.apply(this,arguments)}finally{At(o,!1),r&&Ct(Ot)}}}function Mt(e,t){return function(n,r){return e.call(this,Kt(n,t),Kt(r,t))}}function Dt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,o={promise:t,reason:e};if(O.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),P(r,o)):O.CustomEvent&&P(r=new CustomEvent("unhandledrejection",{detail:o}),o),r&&O.dispatchEvent&&(dispatchEvent(r),!O.PromiseRejectionEvent&&O.onunhandledrejection))try{O.onunhandledrejection(r)}catch(e){}ae&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+Ne).indexOf("[native code]")&&(kt=Ot=Oe);var $t=tt.reject;function Rt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Xe.letThrough||e._vip)){var o=e._createTransaction(t,n,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===we.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Rt(e,t,n,r)))):$t(o)}return o._promise(t,((e,t)=>Et((()=>(Xe.trans=o,r(e,t,o)))))).then((e=>o._completion.then((()=>e))))}if(e._state.openComplete)return $t(new xe.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return $t(new xe.DatabaseClosed);e.open().catch(Oe)}return e._state.dbReadyPromise.then((()=>Rt(e,t,n,r)))}const Nt=String.fromCharCode(65535),Ft="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Bt=[],qt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Lt=qt,zt=qt,Ut=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Wt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Vt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Yt(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=J(t))[e],t)}function Ht(){throw xe.Type()}class Gt{_trans(e,t,n){const r=this._tx||Xe.trans,o=this.name;function i(e,n,r){if(!r.schema[o])throw new xe.NotFound("Table "+o+" not part of transaction");return t(r.idbtrans,r)}const s=ft();try{return r&&r.db===this.db?r===Xe.trans?r._promise(e,i,n):Et((()=>r._promise(e,i,n)),{trans:r,transless:Xe.transless||Xe}):Rt(this.db,e,[this.name],i)}finally{s&&dt()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(j(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=S(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==Nt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&ae&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,o=this.db._deps.indexedDB;function i(e,t){try{return 0===o.cmp(e,t)}catch(e){return!1}}const[s,a]=t.reduce((([t,n],o)=>{const s=r[o],a=e[o];return[t||s,t||!s?Wt(n,s&&s.multi?e=>{const t=U(e,o);return j(t)&&t.some((e=>i(a,e)))}:e=>i(a,U(e,o))):n]}),[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(a):n?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,j(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){const{db:t,name:n}=this;this.schema.mappedClass=e,e.prototype instanceof Ht&&(e=class extends e{get db(){return t}table(){return n}});const r=new Set;for(let t=e.prototype;t;t=A(t))Object.getOwnPropertyNames(t).forEach((e=>r.add(e)));const o=t=>{if(!t)return t;const n=Object.create(e.prototype);for(let e in t)if(!r.has(e))try{n[e]=t[e]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),e}defineClass(){return this.mapToClass((function(e){P(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=Yt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[o]}))).then((e=>e.numFailures?tt.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{W(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||j(e))return this.where(":id").equals(e).modify(t);{const n=U(e,this.schema.primKey.keyPath);if(void 0===n)return $t(new xe.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?S(t).forEach((n=>{W(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=Yt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[o],keys:null!=t?[t]:null}))).then((e=>e.numFailures?tt.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{W(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?tt.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Vt}))).then((e=>e.numFailures?tt.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new xe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new xe.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let a=i&&n?e.map(Yt(i)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new be(`${this.name}.bulkAdd(): ${e} of ${s} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new xe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new xe.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let a=i&&n?e.map(Yt(i)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new be(`${this.name}.bulkPut(): ${e} of ${s} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new be(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Qt(e){var t={},n=function(n,r){if(r){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[n].subscribe.apply(null,i),e}if("string"==typeof n)return t[n]};n.addEventType=i;for(var r=1,o=arguments.length;r<o;++r)i(arguments[r]);return n;function i(e,r,o){if("object"==typeof e)return s(e);r||(r=Ce),o||(o=Oe);var i={subscribers:[],fire:o,subscribe:function(e){-1===i.subscribers.indexOf(e)&&(i.subscribers.push(e),i.fire=r(i.fire,e))},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e})),i.fire=i.subscribers.reduce(r,o)}};return t[e]=n[e]=i,i}function s(e){S(e).forEach((function(t){var n=e[t];if(j(n))i(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new xe.InvalidArgument("Invalid event config");var r=i(t,Se,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){L((function(){e.apply(null,t)}))}))}))}}))}}function Xt(e,t){return D(t).from({prototype:e}),t}function Jt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Zt(e,t){e.filter=Wt(e.filter,t)}function en(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Wt(r(),t()):t,e.justLimit=n&&!r}function tn(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new xe.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function nn(e,t,n){const r=tn(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function rn(e,t,n,r){const o=e.replayFilter?Wt(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},s=(e,n,r)=>{if(!o||o(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),T(i,a)||(i[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),on(nn(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return on(nn(e,r,n),Wt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function on(e,t,n,r){var o=mt(r?(e,t,o)=>n(r(e),t,o):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=Oe}),(t=>{e.fail(t),n=Oe}))||o(e.value,e,(e=>n=e)),n()}))}))}function sn(e,t){try{const n=an(e),r=an(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(un(e),un(t));case"Array":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n){const r=sn(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function an(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=te(e);return"ArrayBuffer"===n?"binary":n}function un(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class cn{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,$t.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,$t.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Wt(t.algorithm,e)}_iterate(e,t){return rn(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&P(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>rn(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Jt(t,!0))return n.count({trans:e,query:{index:tn(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return rn(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],o=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function a(e,t){var n=i(e,o),r=i(t,o);return n<r?-s:n>r?s:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Jt(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=tn(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return rn(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Jt(t)?en(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):en(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),en(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Zt(this._ctx,(function(n,r,o){return!e(n.value)||(r(o),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Zt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Wt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Jt(t,!0)&&t.limit>0)return this._read((e=>{var n=tn(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Zt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=T(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var o=S(e),i=o.length;r=function(t){for(var n=!1,r=0;r<i;++r){var s=o[r],a=e[s];U(t,s)!==a&&(W(t,s,a),n=!0)}return n}}const s=t.table.core,{outbound:a,extractKey:u}=s.schema.primaryKey,c=this.db._options.modifyChunkSize||200,l=[];let h=0;const f=[],d=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of S(n))l.push(n[e])};return this.clone().primaryKeys().then((o=>{const i=l=>{const h=Math.min(c,o.length-l);return s.getMany({trans:n,keys:o.slice(l,l+h),cache:"immutable"}).then((f=>{const p=[],y=[],m=a?[]:null,v=[];for(let e=0;e<h;++e){const t=f[e],n={value:J(t),primKey:o[l+e]};!1!==r.call(n,n.value,n)&&(null==n.value?v.push(o[l+e]):a||0===sn(u(t),u(n.value))?(y.push(n.value),a&&m.push(o[l+e])):(v.push(o[l+e]),p.push(n.value)))}const g=Jt(t)&&t.limit===1/0&&("function"!=typeof e||e===ln)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&s.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)v.splice(parseInt(t),1);d(p.length,e)}))).then((()=>(y.length>0||g&&"object"==typeof e)&&s.mutate({trans:n,type:"put",keys:m,values:y,criteria:g,changeSpec:"function"!=typeof e&&e}).then((e=>d(y.length,e))))).then((()=>(v.length>0||g&&e===ln)&&s.mutate({trans:n,type:"delete",keys:v,criteria:g}).then((e=>d(v.length,e))))).then((()=>o.length>l+h&&i(l+c)))}))};return i(0).then((()=>{if(l.length>0)throw new ge("Error modifying one or more objects",l,h,f);return o.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Jt(e)&&(e.isPrimKey&&!zt||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then((({failures:e,lastResult:n,results:r,numFailures:o})=>{if(o)throw new ge("Could not delete some values",Object.keys(e).map((t=>e[t])),t-o);return t-o}))))})):this.modify(ln)}}const ln=(e,t)=>t.value=null;function hn(e,t){return e<t?-1:e===t?0:1}function fn(e,t){return e>t?-1:e===t?0:1}function dn(e,t,n){var r=e instanceof bn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function pn(e){return new e.Collection(e,(()=>gn(""))).limit(0)}function yn(e,t,n,r,o,i){for(var s=Math.min(e.length,r.length),a=-1,u=0;u<s;++u){var c=t[u];if(c!==r[u])return o(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):o(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;o(e[u],c)<0&&(a=u)}return s<r.length&&"next"===i?e+n.substr(e.length):s<e.length&&"prev"===i?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function mn(e,t,n,r){var o,i,s,a,u,c,l,h=n.length;if(!n.every((e=>"string"==typeof e)))return dn(e,"String expected.");function f(e){o=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),s="next"===e?hn:fn;var t=n.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),u=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}f("next");var d=new e.Collection(e,(()=>vn(a[0],u[h-1]+r)));d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm((function(e,n,r){var o=e.key;if("string"!=typeof o)return!1;var f=i(o);if(t(f,u,p))return!0;for(var d=null,y=p;y<h;++y){var m=yn(o,f,a[y],u[y],s,c);null===m&&null===d?p=y+1:(null===d||s(d,m)>0)&&(d=m)}return n(null!==d?function(){e.continue(d+l)}:r),!1})),d}function vn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function gn(e){return{type:1,lower:e,upper:e}}class bn{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?pn(this):new this.Collection(this,(()=>vn(e,t,!n,!r)))}catch(e){return dn(this,Ft)}}equals(e){return null==e?dn(this,Ft):new this.Collection(this,(()=>gn(e)))}above(e){return null==e?dn(this,Ft):new this.Collection(this,(()=>vn(e,void 0,!0)))}aboveOrEqual(e){return null==e?dn(this,Ft):new this.Collection(this,(()=>vn(e,void 0,!1)))}below(e){return null==e?dn(this,Ft):new this.Collection(this,(()=>vn(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?dn(this,Ft):new this.Collection(this,(()=>vn(void 0,e)))}startsWith(e){return"string"!=typeof e?dn(this,"String expected."):this.between(e,e+Nt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):mn(this,((e,t)=>0===e.indexOf(t[0])),[e],Nt)}equalsIgnoreCase(e){return mn(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=ie.apply(oe,arguments);return 0===e.length?pn(this):mn(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=ie.apply(oe,arguments);return 0===e.length?pn(this):mn(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,Nt)}anyOf(){const e=ie.apply(oe,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return dn(this,Ft)}if(0===e.length)return pn(this);const n=new this.Collection(this,(()=>vn(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,o,i)=>{const s=n.key;for(;t(s,e[r])>0;)if(++r,r===e.length)return o(i),!1;return 0===t(s,e[r])||(o((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=ie.apply(oe,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return dn(this,Ft)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,o=this._descending,i=this._min,s=this._max;if(0===e.length)return pn(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return dn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",xe.InvalidArgument);const a=!t||!1!==t.includeLowers,u=t&&!0===t.includeUppers;let c,l=r;function h(e,t){return l(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,o=e.length;for(;r<o;++r){const o=e[r];if(n(t[0],o[1])<0&&n(t[1],o[0])>0){o[0]=i(o[0],t[0]),o[1]=s(o[1],t[1]);break}}return r===o&&e.push(t),e}),[]),c.sort(h)}catch(e){return dn(this,Ft)}let f=0;const d=u?e=>r(e,c[f][1])>0:e=>r(e,c[f][1])>=0,p=a?e=>o(e,c[f][0])>0:e=>o(e,c[f][0])>=0;let y=d;const m=new this.Collection(this,(()=>vn(c[0][0],c[c.length-1][1],!a,!u)));return m._ondirectionchange=e=>{"next"===e?(y=d,l=r):(y=p,l=o),c.sort(h)},m._addAlgorithm(((e,t,n)=>{for(var o=e.key;y(o);)if(++f,f===c.length)return t(n),!1;return!!function(e){return!d(e)&&!p(e)}(o)||(0===this._cmp(o,c[f][1])||0===this._cmp(o,c[f][0])||t((()=>{l===r?e.continue(c[f][0]):e.continue(c[f][1])})),!1)})),m}startsWithAnyOf(){const e=ie.apply(oe,arguments);return e.every((e=>"string"==typeof e))?0===e.length?pn(this):this.inAnyRange(e.map((e=>[e,e+Nt]))):dn(this,"startsWithAnyOf() only works with strings")}}function wn(e){return mt((function(t){return _n(t),e(t.target.error),!1}))}function _n(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const xn=Qt(null,"storagemutated");class En{_lock(){return q(!Xe.global),++this._reculock,1!==this._reculock||Xe.global||(Xe.lockOwnerFor=this),this}_unlock(){if(q(!Xe.global),0==--this._reculock)for(Xe.global||(Xe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Tt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Xe.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(q(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new xe.DatabaseClosed(n);case"MissingAPIError":throw new xe.MissingAPI(n.message,n);default:throw new xe.OpenFailed(n)}if(!this.active)throw new xe.TransactionInactive;return q(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=mt((t=>{_n(t),this._reject(e.error)})),e.onabort=mt((t=>{_n(t),this.active&&this._reject(new xe.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=mt((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&xn.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return $t(new xe.ReadOnly("Transaction is readonly"));if(!this.active)return $t(new xe.TransactionInactive);if(this._locked())return new tt(((r,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,o)},Xe])}));if(n)return Et((()=>{var e=new tt(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new tt(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=tt.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new tt(((e,r)=>{n.then((n=>t._waitingQueue.push(mt(e.bind(null,n)))),(e=>t._waitingQueue.push(mt(r.bind(null,e))))).finally((()=>{t._waitingFor===o&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new xe.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(T(t,e))return t[e];const n=this.schema[e];if(!n)throw new xe.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function kn(e,t,n,r,o,i,s){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:i,src:(n&&!s?"&":"")+(r?"*":"")+(o?"++":"")+On(t)}}function On(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Sn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:z(n,(e=>[e.name,e]))}}let jn=e=>{try{return e.only([[]]),jn=()=>[[]],[[]]}catch(e){return jn=()=>Nt,Nt}};function Pn(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>U(t,e)}(e):t=>U(t,e)}function An(e){return[].slice.call(e)}let In=0;function Tn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function Cn(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:o,upperOpen:i}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!o):t.bound(n,r,!!o,!!i)}const{schema:o,hasGetAll:i}=function(e,t){const n=An(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=j(t),o=null==t,i={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:Pn(t)},indexes:An(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:o}=e,s={name:t,compound:j(o),keyPath:o,unique:n,multiEntry:r,extractKey:Pn(o)};return i[Tn(o)]=s,s})),getIndexByKeyPath:e=>i[Tn(e)]};return i[":id"]=s.primaryKey,null!=t&&(i[Tn(t)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),s=o.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:o,values:i,range:s}){return new Promise(((a,u)=>{a=mt(a);const c=e.objectStore(t),l=null==c.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:f}=o||i||{length:1};if(o&&i&&o.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const p=[],y=[];let m=0;const v=e=>{++m,_n(e)};if("deleteRange"===n){if(4===s.type)return a({numFailures:m,failures:y,results:[],lastResult:void 0});3===s.type?p.push(d=c.clear()):p.push(d=c.delete(r(s)))}else{const[e,t]=h?l?[i,o]:[i,null]:[o,null];if(h)for(let r=0;r<f;++r)p.push(d=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),d.onerror=v;else for(let t=0;t<f;++t)p.push(d=c[n](e[t])),d.onerror=v}const g=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),a({numFailures:m,failures:y,results:"delete"===n?o:p.map((e=>e.result)),lastResult:t})};d.onerror=e=>{v(e),g(e)},d.onsuccess=g}))},getMany:({trans:e,keys:n})=>new Promise(((r,o)=>{r=mt(r);const i=e.objectStore(t),s=n.length,a=new Array(s);let u,c=0,l=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++l===c&&r(a)},f=wn(o);for(let e=0;e<s;++e)null!=n[e]&&(u=i.get(n[e]),u._pos=e,u.onsuccess=h,u.onerror=f,++c);0===c&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,o)=>{r=mt(r);const i=e.objectStore(t).get(n);i.onsuccess=e=>r(e.target.result),i.onerror=wn(o)})),query:function(e){return n=>new Promise(((o,i)=>{o=mt(o);const{trans:s,values:a,limit:u,query:c}=n,l=u===1/0?void 0:u,{index:h,range:f}=c,d=s.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),y=r(f);if(0===u)return o({result:[]});if(e){const e=a?p.getAll(y,l):p.getAllKeys(y,l);e.onsuccess=e=>o({result:e.target.result}),e.onerror=wn(i)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(y):p.openKeyCursor(y),n=[];t.onsuccess=r=>{const i=t.result;return i?(n.push(a?i.value:i.primaryKey),++e===u?o({result:n}):void i.continue()):o({result:n})},t.onerror=wn(i)}}))}(i),openCursor:function({trans:e,values:n,query:o,reverse:i,unique:s}){return new Promise(((a,u)=>{a=mt(a);const{index:c,range:l}=o,h=e.objectStore(t),f=c.isPrimaryKey?h:h.index(c.name),d=i?s?"prevunique":"prev":s?"nextunique":"next",p=n||!("openKeyCursor"in f)?f.openCursor(r(l),d):f.openKeyCursor(r(l),d);p.onerror=wn(u),p.onsuccess=mt((t=>{const n=p.result;if(!n)return void a(null);n.___id=++In,n.done=!1;const r=n.continue.bind(n);let o=n.continuePrimaryKey;o&&(o=o.bind(n));const i=n.advance.bind(n),s=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=mt(u),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=mt(e),p.onerror=wn(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=s,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=mt((e=>{p.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=o,n.advance=i,a(),t},a(n)}),u)}))},count({query:e,trans:n}){const{index:o,range:i}=e;return new Promise(((e,s)=>{const a=n.objectStore(t),u=o.isPrimaryKey?a:a.index(o.name),c=r(i),l=c?u.count(c):u.count();l.onsuccess=mt((t=>e(t.target.result))),l.onerror=wn(s)}))}}}(e))),a={};return s.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:jn(t),schema:o}}function Kn({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},o){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(Cn(t,n,o),e.dbcore);return{dbcore:i}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function Mn({_novip:e},t,n,r){n.forEach((n=>{const o=r[n];t.forEach((t=>{const r=R(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?M(t,n,{get(){return this.table(n)},set(e){K(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,o))}))}))}function Dn({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function $n(e,t){return e._cfg.version-t._cfg.version}function Rn(e,t,n,r){const o=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,o);i.create(n),i._completion.catch(r);const s=i._reject.bind(i),a=Xe.transless||Xe;Et((()=>{Xe.trans=i,Xe.transless=a,0===t?(S(o).forEach((e=>{Fn(n,e,o[e].primKey,o[e].indexes)})),Kn(e,n),tt.follow((()=>e.on.populate.fire(i))).catch(s)):function({_novip:e},t,n,r){const o=[],i=e._versions;let s=e._dbSchema=qn(e,e.idbdb,r),a=!1;return i.filter((e=>e._cfg.version>=t)).forEach((i=>{o.push((()=>{const o=s,u=i._cfg.dbschema;Ln(e,o,r),Ln(e,u,r),s=e._dbSchema=u;const c=Nn(o,u);c.add.forEach((e=>{Fn(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((e=>{if(e.recreate)throw new xe.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>Bn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Bn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const l=i._cfg.contentUpgrade;if(l&&i._cfg.version>t){Kn(e,r),n._memoizedTables={},a=!0;let t=V(u);c.del.forEach((e=>{t[e]=o[e]})),Dn(e,[e.Transaction.prototype]),Mn(e,[e.Transaction.prototype],S(t),t),n.schema=t;const i=se(l);let s;i&&kt();const h=tt.follow((()=>{if(s=l(n),s&&i){var e=Ot.bind(null,null);s.then(e,e)}}));return s&&"function"==typeof s.then?tt.resolve(s):h.then((()=>s))}})),o.push((t=>{a&&Lt||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(i._cfg.dbschema,t),Dn(e,[e.Transaction.prototype]),Mn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return o.length?tt.resolve(o.shift()(n.idbtrans)).then(e):tt.resolve()}().then((()=>{var e,t;t=r,S(e=s).forEach((n=>{t.db.objectStoreNames.contains(n)||Fn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,i,n).catch(s)}))}function Nn(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const o=e[r],i=t[r];if(o){const e={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto&&!qt)e.recreate=!0,n.change.push(e);else{const t=o.idxByName,r=i.idxByName;let s;for(s in t)r[s]||e.del.push(s);for(s in r){const n=t[s],o=r[s];n?n.src!==o.src&&e.change.push(o):e.add.push(o)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,i])}return n}function Fn(e,t,n,r){const o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>Bn(o,e))),o}function Bn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function qn(e,t,n){const r={};return F(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let o=t.keyPath;const i=kn(On(o),o||"",!1,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),s=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);o=n.keyPath;var a=kn(n.name,o,!!n.unique,!!n.multiEntry,!1,o&&"string"!=typeof o,!1);s.push(a)}r[e]=Sn(e,i,s)})),r}function Ln({_novip:e},t,n){const r=n.db.objectStoreNames;for(let o=0;o<r.length;++o){const i=r[o],s=n.objectStore(i);e._hasGetAll="getAll"in s;for(let e=0;e<s.indexNames.length;++e){const n=s.indexNames[e],r=s.index(n).keyPath,o="string"==typeof r?r:"["+F(r).join("+")+"]";if(t[i]){const e=t[i].idxByName[o];e&&(e.name=n,delete t[i].idxByName[o],t[i].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&O.WorkerGlobalScope&&O instanceof O.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class zn{_parseStoresSpec(e,t){S(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return kn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),j(r),0===t)})),o=r.shift();if(o.multi)throw new xe.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new xe.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new xe.Schema("Index must have a name and cannot be an empty string")})),t[n]=Sn(n,o,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,e):e;const n=t._versions,r={};let o={};return n.forEach((e=>{P(r,e._cfg.storesSource),o=e._cfg.dbschema={},e._parseStoresSpec(r,o)})),t._dbSchema=o,Dn(t,[t._allTables,t,t.Transaction.prototype]),Mn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],S(o),o),t._storeNames=S(o),this}upgrade(e){return this._cfg.contentUpgrade=Ke(this._cfg.contentUpgrade||Oe,e),this}}function Un(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new hr("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Wn(e){return e&&"function"==typeof e.databases}function Vn(e){return Et((function(){return Xe.letThrough=!0,e()}))}function Yn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Hn(e){var t=t=>e.next(t),n=o(t),r=o((t=>e.throw(t)));function o(e){return t=>{var o=e(t),i=o.value;return o.done?i:i&&"function"==typeof i.then?i.then(n,r):j(i)?Promise.all(i).then(n,r):n(i)}}return o(t)()}function Gn(e,t,n){var r=arguments.length;if(r<2)throw new xe.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];n=o.pop();var i=H(o);return[e,i,n]}function Qn(e,t,n,r,o){return tt.resolve().then((()=>{const i=Xe.transless||Xe,s=e._createTransaction(t,n,e._dbSchema,r),a={trans:s,transless:i};if(r)s.idbtrans=r.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===we.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Qn(e,t,n,null,o)))):$t(r)}const u=se(o);let c;u&&kt();const l=tt.follow((()=>{if(c=o.call(s,s),c)if(u){var e=Ot.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Hn(c))}),a);return(c&&"function"==typeof c.then?tt.resolve(c).then((e=>s.active?e:$t(new xe.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>c))).then((e=>(r&&s._resolve(),s._completion.then((()=>e))))).catch((e=>(s._reject(e),$t(e))))}))}function Xn(e,t,n){const r=j(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Jn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,o={},i=[];function s(e,t,n){const r=Tn(e),a=o[r]=o[r]||[],u=null==e?0:"string"==typeof e?1:e.length,c=t>0,l={...n,isVirtual:c,keyTail:t,keyLength:u,extractKey:Pn(e),unique:!c&&n.unique};return a.push(l),l.isPrimaryKey||i.push(l),u>1&&s(2===u?e[0]:e.slice(0,u-1),t+1,n),a.sort(((e,t)=>e.keyTail-t.keyTail)),l}const a=s(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[a];for(const e of r.indexes)s(e.keyPath,0,e);function u(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,o=n.keyTail,{type:1===r.type?2:r.type,lower:Xn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,o),lowerOpen:!0,upper:Xn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,o),upperOpen:!0})}}:t;var r,o}const c={...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function(e){const t=o[Tn(e)];return t&&t[0]}},count:e=>n.count(u(e)),query:e=>n.query(u(e)),openCursor(t){const{keyTail:r,isVirtual:o,keyLength:i}=t.query.index;return o?n.openCursor(u(t)).then((n=>n&&function(n){const o=Object.create(n,{continue:{value:function(o){null!=o?n.continue(Xn(o,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,o){n.continuePrimaryKey(Xn(t,e.MAX_KEY,r),o)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>n.value}});return o}(n))):n.openCursor(t)}};return c}}}};function Zn(e,t,n,r){return n=n||{},r=r||"",S(e).forEach((o=>{if(T(t,o)){var i=e[o],s=t[o];if("object"==typeof i&&"object"==typeof s&&i&&s){const e=te(i);e!==te(s)?n[r+o]=t[o]:"Object"===e?Zn(i,s,n,r+o+"."):i!==s&&(n[r+o]=t[o])}else i!==s&&(n[r+o]=t[o])}else n[r+o]=void 0})),S(t).forEach((o=>{T(e,o)||(n[r+o]=t[o])})),n}const er={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,o={...n,mutate(e){const o=Xe.trans,{deleting:i,creating:s,updating:a}=o.table(t).hook;switch(e.type){case"add":if(s.fire===Oe)break;return o._promise("readwrite",(()=>u(e)),!0);case"put":if(s.fire===Oe&&a.fire===Oe)break;return o._promise("readwrite",(()=>u(e)),!0);case"delete":if(i.fire===Oe)break;return o._promise("readwrite",(()=>u(e)),!0);case"deleteRange":if(i.fire===Oe)break;return o._promise("readwrite",(()=>function(e){return c(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function u(e){const t=Xe.trans,o=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!o)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:o}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,o).then((u=>{const c=o.map(((n,o)=>{const c=u[o],l={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(l,n,c,t);else if("add"===e.type||void 0===c){const i=s.fire.call(l,n,e.values[o],t);null==n&&null!=i&&(n=i,e.keys[o]=n,r.outbound||W(e.values[o],r.keyPath,n))}else{const r=Zn(c,e.values[o]),i=a.fire.call(l,r,n,c,t);if(i){const t=e.values[o];Object.keys(i).forEach((e=>{T(t,e)?t[e]=i[e]:W(t,e,i[e])}))}}return l}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:i})=>{for(let r=0;r<o.length;++r){const i=n?n[r]:o[r],s=c[r];null==i?s.onerror&&s.onerror(t[r]):s.onsuccess&&s.onsuccess("put"===e.type&&u[r]?e.values[r]:i)}return{failures:t,results:n,numFailures:r,lastResult:i}})).catch((e=>(c.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function c(e,t,o){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:o}).then((({result:n})=>u({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<o?{failures:[],numFailures:0,lastResult:void 0}:c(e,{...t,lower:n[n.length-1],lowerOpen:!0},o)))))}}};return o}})};function tr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let o=0,i=0;o<t.keys.length&&i<e.length;++o)0===sn(t.keys[o],e[i])&&(r.push(n?J(t.values[o]):t.values[o]),++i);return r.length===e.length?r:null}catch(e){return null}}const nr={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=tr(e.keys,e.trans._cache,"clone"===e.cache);return t?tt.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?J(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function rr(e){return!("from"in e)}const or=function(e,t){if(!this){const t=new or;return e&&"d"in e&&P(t,e),t}P(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function ir(e,t,n){const r=sn(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(rr(e))return P(e,{from:t,to:n,d:1});const o=e.l,i=e.r;if(sn(n,e.from)<0)return o?ir(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ur(e);if(sn(t,e.to)>0)return i?ir(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ur(e);sn(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),sn(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const s=!e.r;o&&!e.l&&sr(e,o),i&&s&&sr(e,i)}function sr(e,t){rr(t)||function e(t,{from:n,to:r,l:o,r:i}){ir(t,n,r),o&&e(t,o),i&&e(t,i)}(e,t)}function ar(e){let t=rr(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&sn(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||sn(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ur(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=r>1?"r":r<-1?"l":"";if(o){const t="r"===o?"l":"r",n={...e},r=e[o];e.from=r.from,e.to=r.to,e[o]=r[o],n[o]=r[t],e[t]=n,n.d=cr(n)}e.d=cr(e)}function cr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}C(or.prototype,{add(e){return sr(this,e),this},addKey(e){return ir(this,e,e),this},addKeys(e){return e.forEach((e=>ir(this,e,e))),this},[ne](){return ar(this)}});const lr={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new or(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const o=e.table(r),{schema:i}=o,{primaryKey:s}=i,{extractKey:a,outbound:u}=s,c={...o,mutate:e=>{const s=e.trans,a=s.mutatedParts||(s.mutatedParts={}),u=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new or)},c=u(""),l=u(":dels"),{type:h}=e;let[f,d]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const p=e.trans._cache;return o.mutate(e).then((e=>{if(j(f)){"delete"!==h&&(f=e.results),c.addKeys(f);const t=tr(f,p);t||"add"===h||l.addKeys(f),(t||d)&&function(e,t,n,r){t.indexes.forEach((function(t){const o=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}const s=e=>t.multiEntry&&j(e)?e.forEach((e=>o.addKey(e))):o.addKey(e);(n||r).forEach(((e,t)=>{const o=n&&i(n[t]),a=r&&i(r[t]);0!==sn(o,a)&&(null!=o&&s(o),null!=a&&s(a))}))}))}(u,i,t,d)}else if(f){const e={from:f.lower,to:f.upper};l.add(e),c.add(e)}else c.add(n),l.add(n),i.indexes.forEach((e=>u(e.name).add(n)));return e}))}},l=({query:{index:t,range:n}})=>{var r,o;return[t,new or(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(o=n.upper)&&void 0!==o?o:e.MAX_KEY)]},h={get:e=>[s,new or(e.key)],getMany:e=>[s,(new or).addKeys(e.keys)],count:l,query:l,openCursor:l};return S(h).forEach((e=>{c[e]=function(i){const{subscr:s}=Xe;if(s){const c=e=>{const n=`idb://${t}/${r}/${e}`;return s[n]||(s[n]=new or)},l=c(""),f=c(":dels"),[d,p]=h[e](i);if(c(d.name||"").add(p),!d.isPrimaryKey){if("count"!==e){const t="query"===e&&u&&i.values&&o.query({...i,values:!1});return o[e].apply(this,arguments).then((n=>{if("query"===e){if(u&&i.values)return t.then((({result:e})=>(l.addKeys(e),n)));const e=i.values?n.result.map(a):n.result;i.values?l.addKeys(e):f.addKeys(e)}else if("openCursor"===e){const e=n,t=i.values;return e&&Object.create(e,{key:{get:()=>(f.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return f.addKey(t),t}},value:{get:()=>(t&&l.addKey(e.primaryKey),e.value)}})}return n}))}f.add(n)}}return o[e].apply(this,arguments)}})),c}}}};class hr{constructor(e,t){this._middlewares={},this.verno=0;const n=hr.dependencies;this._options=t={addons:hr.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Oe,dbReadyPromise:null,cancelOpen:Oe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new tt((e=>{o.dbReadyResolve=e})),o.openCanceller=new tt(((e,t)=>{o.cancelOpen=t})),this._state=o,this.name=e,this.on=Qt(this,"populate","blocked","versionchange","close",{ready:[Ke,Oe]}),this.on.ready.subscribe=B(this.on.ready.subscribe,(e=>(t,n)=>{hr.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||tt.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(i=this,Xt(cn.prototype,(function(e,t){this.db=i;let n=Vt,r=null;if(t)try{n=t()}catch(e){r=e}const o=e._ctx,s=o.table,a=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:a!==Se?a:null}}))),this.Table=function(e){return Xt(Gt.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Qt(null,{creating:[Ae,Oe],reading:[je,Se],updating:[Te,Oe],deleting:[Ie,Oe]})}))}(this),this.Transaction=function(e){return Xt(En.prototype,(function(t,n,r,o,i){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Qt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new tt(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),$t(e)}))}))}(this),this.Version=function(e){return Xt(zn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Xt(bn.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const o=e._deps.indexedDB;if(!o)throw new xe.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(e,t)=>o.cmp(t,e),this._max=(e,t)=>o.cmp(e,t)>0?e:t,this._min=(e,t)=>o.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=jn(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),Bt.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Jn),this.use(er),this.use(lr),this.use(nr),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new xe.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new xe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort($n),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Xe.letThrough||this._vip)?e():new tt(((e,t)=>{if(this._state.openComplete)return t(new xe.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new xe.DatabaseClosed);this.open().catch(Oe)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:t,level:null==n?10:n,name:r}),o.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?$t(t.dbOpenError):e));ae&&(t.openCanceller._stackHolder=he()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function o(){if(t.openCanceller!==r)throw new xe.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,s=null,a=!1;return tt.race([r,("undefined"==typeof navigator?tt.resolve():Yn()).then((()=>new tt(((r,i)=>{if(o(),!n)throw new xe.MissingAPI;const u=e.name,c=t.autoSchema?n.open(u):n.open(u,Math.round(10*e.verno));if(!c)throw new xe.MissingAPI;c.onerror=wn(i),c.onblocked=mt(e._fireOnBlocked),c.onupgradeneeded=mt((r=>{if(s=c.transaction,t.autoSchema&&!e._options.allowEmptyDB){c.onerror=_n,s.abort(),c.result.close();const e=n.deleteDatabase(u);e.onsuccess=e.onerror=mt((()=>{i(new xe.NoSuchDatabase(`Database ${u} doesnt exist`))}))}else{s.onerror=wn(i);var o=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=o<1,e._novip.idbdb=c.result,Rn(e,o/10,s,i)}}),i),c.onsuccess=mt((()=>{s=null;const n=e._novip.idbdb=c.result,o=F(n.objectStoreNames);if(o.length>0)try{const r=n.transaction(1===(i=o).length?i[0]:i,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=qn(0,t,n);e._storeNames=F(t.objectStoreNames,0),Mn(e,[e._allTables],S(r),r)}(e,n,r):(Ln(e,e._dbSchema,r),function(e,t){const n=Nn(qn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Kn(e,r)}catch(e){}var i;Bt.push(e),n.onversionchange=mt((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=mt((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!Wn(e)&&"__dbnames"!==n&&Un(e,t).put({name:n}).catch(Oe)}(e._deps,u),r()}),i)}))))]).then((()=>(o(),t.onReadyBeingFired=[],tt.resolve(Vn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(Ke,Oe);return t.onReadyBeingFired=[],tt.resolve(Vn((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{s&&s.abort()}catch(e){}return r===t.openCanceller&&e._close(),$t(n)})).finally((()=>{t.openComplete=!0,i()}))}(this)}_close(){const e=this._state,t=Bt.indexOf(this);if(t>=0&&Bt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new tt((t=>{e.dbReadyResolve=t})),e.openCanceller=new tt(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new xe.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new tt(((n,r)=>{const o=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=mt((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Wn(e)&&"__dbnames"!==n&&Un(e,t).delete(n).catch(Oe)}(this._deps,this.name),n()})),e.onerror=wn(r),e.onblocked=this._fireOnBlocked};if(e)throw new xe.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(o):o()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return S(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Gn.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Xe.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const o=-1!==e.indexOf("?");let i,s;e=e.replace("!","").replace("?","");try{if(s=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)i="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new xe.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(r){if("readonly"===r.mode&&"readwrite"===i){if(!o)throw new xe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!o)throw new xe.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),o&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):$t(e)}const a=Qn.bind(null,this,i,s,r,n);return r?r._promise(i,a,"lock"):Xe.trans?Tt(Xe.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!T(this._allTables,e))throw new xe.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const fr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class dr{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[fr](){return this}}function pr(e,t){return S(t).forEach((n=>{sr(e[n]||(e[n]=new or),t[n])})),e}let yr;try{yr={indexedDB:O.indexedDB||O.mozIndexedDB||O.webkitIndexedDB||O.msIndexedDB,IDBKeyRange:O.IDBKeyRange||O.webkitIDBKeyRange}}catch(O){yr={indexedDB:null,IDBKeyRange:null}}const mr=hr;function vr(e){let t=gr;try{gr=!0,xn.storagemutated.fire(e)}finally{gr=t}}C(mr,{...ke,delete:e=>new mr(e,{addons:[]}).delete(),exists:e=>new mr(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Wn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):Un(e,t).toCollection().primaryKeys()}(mr.dependencies).then(e)}catch(e){return $t(new xe.MissingAPI)}},defineClass:()=>function(e){P(this,e)},ignoreTransaction:e=>Xe.trans?Tt(Xe.transless,e):e(),vip:Vn,async:function(e){return function(){try{var t=Hn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:tt.resolve(t)}catch(e){return $t(e)}}},spawn:function(e,t,n){try{var r=Hn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:tt.resolve(r)}catch(e){return $t(e)}},currentTransaction:{get:()=>Xe.trans||null},waitFor:function(e,t){const n=tt.resolve("function"==typeof e?mr.ignoreTransaction(e):e).timeout(t||6e4);return Xe.trans?Xe.trans.waitFor(n):n},Promise:tt,debug:{get:()=>ae,set:e=>{ue(e,"dexie"===e?()=>!0:Ut)}},derive:D,extend:P,props:C,override:B,Events:Qt,on:xn,liveQuery:function(e){return new dr((t=>{const n=se(e);let r=!1,o={},i={};const s={get closed(){return r},unsubscribe:()=>{r=!0,xn.storagemutated.unsubscribe(l)}};t.start&&t.start(s);let a=!1,u=!1;function c(){return S(i).some((e=>o[e]&&function(e,t){const n=ar(t);let r=n.next();if(r.done)return!1;let o=r.value;const i=ar(e);let s=i.next(o.from),a=s.value;for(;!r.done&&!s.done;){if(sn(a.from,o.to)<=0&&sn(a.to,o.from)>=0)return!0;sn(o.from,a.from)<0?o=(r=n.next(a.from)).value:a=(s=i.next(o.from)).value}return!1}(o[e],i[e])))}const l=e=>{pr(o,e),c()&&h()},h=()=>{if(a||r)return;o={};const f={},d=function(t){n&&kt();const r=()=>Et(e,{subscr:t,trans:null}),o=Xe.trans?Tt(Xe.transless,r):r();return n&&o.then(Ot,Ot),o}(f);u||(xn("storagemutated",l),u=!0),a=!0,Promise.resolve(d).then((e=>{a=!1,r||(c()?h():(o={},i=f,t.next&&t.next(e)))}),(e=>{["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||(a=!1,t.error&&t.error(e),s.unsubscribe())}))};return h(),s}))},extendObservabilitySet:pr,getByKeyPath:U,setByKeyPath:W,delByKeyPath:function(e,t){"string"==typeof t?W(e,t,void 0):"length"in t&&[].map.call(t,(function(t){W(e,t,void 0)}))},shallowClone:V,deepClone:J,getObjectDiff:Zn,cmp:sn,asap:L,minKey:-1/0,addons:[],connections:Bt,errnames:we,dependencies:yr,semVer:"4.0.0-alpha.4",version:"4.0.0-alpha.4".split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),mr.maxKey=jn(mr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(xn("storagemutated",(e=>{if(!gr){let t;qt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),gr=!0,dispatchEvent(t),gr=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{gr||vr(e)})));let gr=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),xn("storagemutated",(t=>{gr||e.postMessage(t)})),e.onmessage=e=>{e.data&&vr(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){xn("storagemutated",(e=>{try{gr||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&vr(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&vr(e.changedParts)}))}tt.rejectionMapper=function(e,t){if(!e||e instanceof me||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ee[e.name])return e;var n=new Ee[e.name](t||e.message,e);return"stack"in e&&M(n,"stack",{get:function(){return this.inner.stack}}),n},ue(ae,Ut);const br=Number.MAX_SAFE_INTEGER,wr=Number.MIN_SAFE_INTEGER,_r=Symbol("missing"),xr=e=>{const t=Jr(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},Er=new Set(["null","undefined","boolean","number","string","date","regexp"]),kr={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},Or=(e,t)=>{e===_r&&(e=void 0),t===_r&&(t=void 0);const n=kr[Ir(e).toLowerCase()],r=kr[Ir(t).toLowerCase()];return n!==r?n-r:e<t?-1:e>t?1:0},Sr=Object.getPrototypeOf({}),jr=/^\[object ([a-zA-Z0-9]+)\]$/;function Pr(e,t){if(!e)throw new Error(t)}function Ar(e){return e instanceof Array?e.map(Ar):e instanceof Date?new Date(e):Dr(e)?function(e,t){const n={},r=Object.keys(e);for(let o=0;o<r.length;o++){const i=r[o];n[i]=t(e[i],i)}return n}(e,Ar):e}function Ir(e){return jr.exec(Object.prototype.toString.call(e))[1]}function Tr(e){return"boolean"==typeof e}function Cr(e){return"string"==typeof e}function Kr(e){return!isNaN(e)&&"number"==typeof e}const Mr=Array.isArray;function Dr(e){if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Sr||null===t)&&"[object Object]"===Object.prototype.toString.call(e)}function $r(e){return e===Object(e)}function Rr(e){return e instanceof Date}function Nr(e){return e instanceof RegExp}function Fr(e){return null==e}function Br(e,t){return e.includes(t)}function qr(e,t){return!Br(e,t)}function Lr(e){return Fr(e)||Cr(e)&&!e||e instanceof Array&&0===e.length||Dr(e)&&0===Object.keys(e).length}function zr(e){return e===_r}function Ur(e){return e instanceof Array?e:[e]}function Wr(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function Vr(e,t,n){if(zr(e))return t;if(zr(t))return e;const r=[e,t];if(!r.every(Dr)&&!r.every(Mr))throw Error("mismatched types. must both be array or object");if(n=n||{flatten:!1},Mr(e)){const r=e,o=t;if(n.flatten){let e=0,i=0;for(;e<r.length&&i<o.length;)r[e]=Vr(r[e++],o[i++],n);for(;i<o.length;)r.push(t[i++])}else ro(r,o)}else Object.keys(t).forEach((r=>{Wr(t,r)&&(Wr(e,r)?e[r]=Vr(e[r],t[r],n):e[r]=t[r])}));return e}function Yr(e,t,n){e.key<t?e.right?Yr(e.right,t,n):e.right={key:t,indexes:[n]}:e.key>t?e.left?Yr(e.left,t,n):e.left={key:t,indexes:[n]}:e.indexes.push(n)}function Hr(e,t){return e.key==t?e.indexes:e.key<t?e.right?Hr(e.right,t):void 0:e.key>t&&e.left?Hr(e.left,t):void 0}function Gr(e,t=xr){if(e.some((e=>0==e.length)))return[];const n=e.map(((e,t)=>[t,e.length]));n.sort(((e,t)=>e[1]-t[1]));const r=[],o=e[n[0][0]],i={key:Zr(o[0],t),indexes:[0]};for(let e=1;e<o.length;e++){Yr(i,Zr(o[e],t),e)}let s=n[0][1];const a=[];for(let u=1;u<n.length;u++){const c=n[u][0],l=e[c];let h=0;for(let e=0;e<l.length;e++){const n=Hr(i,Zr(l[e],t));if(!n)continue;const s=n.map((e=>o[e])).findIndex((t=>Xr(t,l[e])));-1!=s&&(r.length<u&&r.push({}),r[r.length-1][n[s]]=!0,h=Object.keys(r[r.length-1]).length,0==c&&-1==a.indexOf(n[s])&&a.push(n[s]))}if(0==h)return[];s=Math.min(s,h)}const u={};r.forEach((e=>{Object.keys(e).forEach((e=>{const t=parseFloat(e);u[t]=u[t]||0,u[t]++}))}));const c=a;return 0==c.length&&(c.push(...Object.keys(u).map(parseFloat)),c.sort()),c.filter((t=>u[t]==e.length-1)).map((e=>o[e]))}function Qr(e,t){const n=[];return function e(t,r){for(let o=0,i=t.length;o<i;o++)Mr(t[o])&&(r>0||r<0)?e(t[o],Math.max(-1,r-1)):n.push(t[o])}(e,t),n}function Xr(e,t){const n=[e],r=[t];for(;n.length>0;){if((e=n.pop())===(t=r.pop()))continue;const o=Ir(e).toLowerCase();if(o!==Ir(t).toLowerCase()||"function"===o)return!1;if("array"===o){const o=e,i=t;if(o.length!==i.length)return!1;if(o.length===i.length&&0===o.length)continue;ro(n,o),ro(r,i)}else if("object"===o){const o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(let i=0,s=o.length;i<s;i++){const s=o[i];if(!Wr(t,s))return!1;n.push(e[s]),r.push(t[s])}}else if(Jr(e)!==Jr(t))return!1}return 0===n.length}function Jr(e){const t=Ir(e).toLowerCase();switch(t){case"boolean":case"number":case"regexp":return e.toString();case"string":return JSON.stringify(e);case"date":return e.toISOString();case"null":case"undefined":return t;case"array":return"["+e.map(Jr).join(",")+"]"}const n="object"===t?"":`${Ir(e)}`,r=Object.keys(e);return r.sort(),`${n}{`+r.map((t=>`${Jr(t)}:${Jr(e[t])}`)).join(",")+"}"}function Zr(e,t=xr){return Fr(e)?null:t(e).toString()}function eo(e,t,n=Or){const r=[],o=[];if(Lr(e))return e;for(let n=0;n<e.length;n++){const i=e[n],s=t(i,n);Fr(s)?o.push(i):r.push([s,i])}return r.sort(((e,t)=>n(e[0],t[0]))),o.push(...r.map((e=>e[1]))),o}function to(e,t,n=xr){const r={keys:new Array,groups:new Array},o={};for(let i=0;i<e.length;i++){const s=e[i],a=t(s,i),u=Zr(a,n);let c=-1;void 0===o[u]&&(c=r.keys.length,o[u]=c,r.keys.push(a),r.groups.push([])),c=o[u],r.groups[c].push(s)}return r}const no=5e4;function ro(e,...t){return e instanceof Array?t.reduce(((e,t)=>{let n=Math.ceil(t.length/no),r=0;for(;n-- >0;)Array.prototype.push.apply(e,t.slice(r,r+no)),r+=no;return e}),e):t.filter($r).reduce(((e,t)=>(Object.assign(e,t),e)),e)}function oo(e,t){return $r(e)?e[t]:void 0}function io(e,t,n){let r=0;const o=Er.has(Ir(e).toLowerCase())?e:function e(t,n){let o=t;for(let t=0;t<n.length;t++){const i=n[t];if(null===/^\d+$/.exec(i)&&o instanceof Array){if(0===t&&r>0)break;r+=1;const i=n.slice(t);o=o.reduce(((t,n)=>{const r=e(n,i);return void 0!==r&&t.push(r),t}),[]);break}if(o=oo(o,i),void 0===o)break}return o}(e,t.split("."));return o instanceof Array&&n?.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(o,r):o}function so(e,t,n){const r=t.split("."),o=r[0],i=r.slice(1).join("."),s=null!==/^\d+$/.exec(o),a=r.length>1;let u,c;if(e instanceof Array)if(s)u=oo(e,Number(o)),a&&(u=so(u,i,n)),u=[u];else{u=[];for(const r of e)c=so(r,t,n),n?.preserveMissing?(void 0===c&&(c=_r),u.push(c)):void 0!==c&&u.push(c)}else{if(c=oo(e,o),a&&(c=so(c,i,n)),void 0===c)return;u=n?.preserveKeys?{...e}:{},u[o]=c}return u}function ao(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===_r?e.splice(t,1):ao(e[t]);else if(Dr(e))for(const t in e)Wr(e,t)&&ao(e[t])}function uo(e,t,n,r){if(Fr(e))return;const o=t.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)n(e,i);else{r?.buildGraph&&Fr(e[i])&&(e[i]={});const t=e[i],a=!!(o.length>1&&o[1].match(/^\d+$/));t instanceof Array&&r?.descendArray&&!a?t.forEach((e=>uo(e,s,n,r))):uo(t,s,n,r)}}function co(e,t,n){uo(e,t,((e,t)=>{e[t]=n}),{buildGraph:!0})}function lo(e,t,n){uo(e,t,((e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)Dr(n)&&delete n[t]}else Dr(e)&&delete e[t]}),n)}const ho=/^\$[a-zA-Z0-9_]+$/;function fo(e){return ho.test(e)}function po(e){if(Er.has(Ir(e).toLowerCase()))return Nr(e)?{$regex:e}:{$eq:e};if($r(e)){if(!Object.keys(e).some(fo))return{$eq:e};if(Wr(e,"$regex"))return{$regex:new RegExp(e.$regex,e.$options)}}return e}var yo,mo;!function(e){e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF"}(yo||(yo={}));class vo{options;_root;_local;timestamp;constructor(e,t,n,r=Date.now()){this.options=e,this._root=t,this._local=n,this.timestamp=r,this.options=e,this.update(t,n)}static init(e,t,n){return e instanceof vo?e.update(Fr(e.root)?t:e.root,e.local||n):new vo(e||go(),t,n)}update(e,t){return this._root=e,this._local=t,this}get root(){return this._root}get local(){return this._local}get idKey(){return this.options?.idKey}get collation(){return this.options?.collation}get processingMode(){return this.options?.processingMode||yo.CLONE_OFF}get useStrictMode(){return this.options?.useStrictMode}get scriptEnabled(){return this.options?.scriptEnabled}get hashFunction(){return this.options?.hashFunction}get collectionResolver(){return this.options?.collectionResolver}get jsonSchemaValidator(){return this.options?.jsonSchemaValidator}get variables(){return this.options?.variables}}function go(e){return Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,processingMode:yo.CLONE_OFF,...e})}!function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window"}(mo||(mo={}));const bo={[mo.ACCUMULATOR]:{},[mo.EXPRESSION]:{},[mo.PIPELINE]:{},[mo.PROJECTION]:{},[mo.QUERY]:{},[mo.WINDOW]:{}};function wo(e,t){for(const[n,r]of Object.entries(t)){Pr(r instanceof Function&&fo(n),`'${n}' is not a valid operator`);const t=_o(e,n);Pr(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}ro(bo[e],t)}function _o(e,t){return bo[e][t]}const xo={$$ROOT:(e,t,n)=>n.root,$$CURRENT:(e,t,n)=>e,$$REMOVE(e,t,n){},$$NOW:(e,t,n)=>new Date(n.timestamp)},Eo={$$KEEP:(e,t,n)=>e,$$PRUNE(e,t,n){},$$DESCEND(e,t,n){if(!Wr(t,"$cond"))return e;let r;for(const[o,i]of Object.entries(e))if($r(i)){if(i instanceof Array){const e=[];for(let r of i)Dr(r)&&(r=Oo(r,t,n.update(r))),Fr(r)||e.push(r);r=e}else r=Oo(i,t,n.update(i));Fr(r)?delete e[o]:e[o]=r}return e}};function ko(e,t,n,r){const o=vo.init(r,e);if(fo(n)){const r=_o(mo.EXPRESSION,n);if(r)return r(e,t,o);const i=_o(mo.ACCUMULATOR,n);if(i)return e instanceof Array||(e=ko(e,t,null,o),t=null),Pr(e instanceof Array,`'${n}' target must be an array.`),i(e,t,o.update(null,o.local));throw new Error(`operator '${n}' is not registered`)}if(Cr(t)&&t.length>0&&"$"===t[0]){if(Wr(Eo,t))return t;let n=o.root;const r=t.split(".");if(Wr(xo,r[0]))n=xo[r[0]](e,null,o),t=t.slice(r[0].length+1);else if("$$"===r[0].slice(0,2)){n=Object.assign({},o.variables,{this:e},o.local?.variables);const i=r[0].slice(2);Pr(Wr(n,i),`Use of undefined variable: ${i}`),t=t.slice(2)}else t=t.slice(1);return""===t?n:io(n,t)}if(t instanceof Array)return t.map((t=>ko(e,t,null,o)));if(Dr(t)){const n={};for(const[r,i]of Object.entries(t))if(n[r]=ko(e,i,r,o),[mo.EXPRESSION,mo.ACCUMULATOR].some((e=>Wr(bo[e],r))))return Pr(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),n[r];return n}return t}function Oo(e,t,n){const r=ko(e,t,null,n);return Wr(Eo,r)?Eo[r](e,t,n):r}function So(e){return e instanceof Io?e:new Io(e)}function jo(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const Po=new Error;var Ao;!function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"}(Ao||(Ao={}));class Io{iteratees=[];yieldedValues=[];getNext;isDone=!1;constructor(e){let t;if(e instanceof Function&&(e={next:e}),function(e){return!!e&&"object"==typeof e&&e?.next instanceof Function}(e)){const n=e;t=()=>{const e=n.next();if(e.done)throw Po;return e.value}}else if(e instanceof Array){const n=e,r=n.length;let o=0;t=()=>{if(o<r)return n[o++];throw Po}}else if(!(e instanceof Function))throw new Error(`Source is of type '${typeof e}'. Must be Array, Function, or Generator`);this.getNext=function(e,t,n){let r=!1,o=-1,i=0;return function(s){try{e:for(;!r;){let a=e();o++;let u=-1;const c=t.length;let l=!1;for(;++u<c;){const e=t[u];switch(e.action){case Ao.MAP:a=e.func(a,o);break;case Ao.FILTER:if(!e.func(a,o))continue e;break;case Ao.TAKE:--e.count,e.count||(l=!0);break;case Ao.DROP:--e.count,e.count||jo(t,u);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(e){if(e!==Po)throw e}return r=!0,{done:r}}}(t,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(Ao.MAP,e)}filter(e){return this.push(Ao.FILTER,e)}take(e){return e>0?this.push(Ao.TAKE,e):this}drop(e){return e>0?this.push(Ao.DROP,e):this}transform(e){const t=this;let n;return So((()=>(n||(n=So(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}class To{pipeline;options;constructor(e,t){this.pipeline=e,this.options=t,this.options=go(t)}stream(e){let t=So(e);const n=this.options.processingMode;n!=yo.CLONE_ALL&&n!=yo.CLONE_INPUT||t.map(Ar);const r=[];if(!Lr(this.pipeline))for(const e of this.pipeline){const n=Object.keys(e),o=n[0],i=_o(mo.PIPELINE,o);Pr(1===n.length&&!!i,`invalid aggregation operator ${o}`),r.push(o),t=i(t,e[o],this.options)}return(n==yo.CLONE_OUTPUT||n==yo.CLONE_ALL&&Gr([["$group","$unwind"],r]).length)&&t.map(Ar),t}run(e){return this.stream(e).value()}}class Co{source;predicate;projection;options;operators=[];result=null;buffer=[];constructor(e,t,n,r){this.source=e,this.predicate=t,this.projection=n,this.options=r}fetch(){return this.result||(Dr(this.projection)&&this.operators.push({$project:this.projection}),this.result=So(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new To(this.operators,this.options).stream(this.result))),this.result}fetchAll(){const e=So([...this.buffer]);return this.buffer=[],function(...e){let t=0;return So((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options={...this.options,collation:e},this}next(){if(this.buffer.length>0)return this.buffer.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.buffer.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.buffer.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}class Ko{criteria;options;compiled;constructor(e,t){this.criteria=e,this.options=t,this.options=go(t),this.compiled=[],this.compile()}compile(){let e;Pr(Dr(this.criteria),"query criteria must be an object");for(const[t,n]of Object.entries(this.criteria)){if("$where"===t)e={field:t,expr:n};else if(Br(["$and","$or","$nor","$expr","$jsonSchema"],t))this.processOperator(t,t,n);else{Pr(!fo(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(po(n)))this.processOperator(t,e,r)}Dr(e)&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=_o(mo.QUERY,t);Pr(!!r,`unknown operator ${t}`);const o=r(e,n,this.options);this.compiled.push(o)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}find(e,t){return new Co(e,(e=>this.test(e)),t||{},this.options)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}function Mo(e,t,n){if(Lr(t))return e;let r=Object.keys(t),o=!1;$o(t,n);const i=n.idKey;if(Br(r,i)){const e=t[i];0!==e&&!1!==e||(r=r.filter(qr.bind(null,[i])),o=0==r.length)}else r.push(i);const s=vo.init(n);return e.map((e=>Do(e,t,s.update(e),r,o)))}function Do(e,t,n,r,o){let i={},s=!1,a=!1;const u=[];o&&u.push(n.idKey);for(const o of r){let r;const c=t[o];if(o!==n.idKey&&Br([0,!1],c)&&(a=!0),o===n.idKey&&Lr(c))r=e[o];else if(Cr(c))r=ko(e,c,o,n);else if(Br([1,!0],c));else if(c instanceof Array)r=c.map((t=>{const r=ko(e,t,null,n);return Fr(r)?null:r}));else{if(!Dr(c)){u.push(o);continue}{const t=c,i=Object.keys(c),a=1==i.length?i[0]:null,u=_o(mo.PROJECTION,a);if(u)"$slice"===a?Ur(t[a]).every(Kr)?(r=u(e,t[a],o),s=!0):r=ko(e,t,o,n):r=u(e,t[a],o,n);else if(fo(a))r=ko(e,t[a],a,n);else if(Wr(e,o)){$o(t,n);let s=e[o];s instanceof Array?r=s.map((e=>Do(e,t,n,i,!1))):(s=Dr(s)?s:e,r=Do(s,t,n,i,!1))}else r=ko(e,c,null,n)}}const l=so(e,o,{preserveMissing:!0});void 0!==l&&Vr(i,l,{flatten:!0}),qr([0,1,!1,!0],c)&&(void 0===r?lo(i,o,{descendArray:!0}):co(i,o,r))}if(ao(i),(s||a||o)&&(i=ro({},e,i),u.length>0))for(const e of u)lo(i,e,{descendArray:!0});return i}function $o(e,t){const n=[!1,!1];for(const[r,o]of Object.entries(e)){if(r===t.idKey)return;0===o||!1===o?n[0]=!0:1!==o&&!0!==o||(n[1]=!0),Pr(!(n[0]&&n[1]),"Projection cannot have a mix of inclusion and exclusion.")}}function Ro(e,t,n){if(Lr(t)||!Dr(t))return e;let r=Or;const o=n.collation;return Dr(o)&&Cr(o.locale)&&(r=function(e){const t={sensitivity:No[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!Cr(e)||!Cr(t))return Or(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(o)),e.transform((e=>{const o=Object.keys(t);for(const i of o.reverse()){const o=to(e,(e=>io(e,i)),n?.hashFunction),s={},a=eo(o.keys,((e,t)=>(s[e]=t,e)),r);-1===t[i]&&a.reverse(),e=[];for(const t of a)ro(e,o.groups[s[t]])}return e}))}const No={1:"base",2:"accent",3:"variant"};function Fo(e){return(t,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,t.split(".").length-1);return s=>{const a=io(s,t,o);return e(a,n,{...r,depth:i})}}}function Bo(e,t,n){if(Xr(e,t))return!0;if(Fr(e)&&Fr(t))return!0;if(e instanceof Array){const r=Xr.bind(null,t);return e.some(r)||Qr(e,n?.depth).some(r)}return!1}function qo(e,t,n){return Fr(e)?t.some((e=>null===e)):Gr([Ur(e),t],n?.hashFunction).length>0}function Lo(e){return fo(e)&&-1===["$and","$or","$nor"].indexOf(e)}function zo(e,t,n){if(Mr(e)&&!Lr(e)){let r=e=>e,o=t;Object.keys(t).every(Lo)&&(o={temp:t},r=e=>({temp:e}));const i=new Ko(o,n);for(let t=0,n=e.length;t<n;t++)if(i.test(r(e[t])))return!0}return!1}const Uo=e=>null===e,Wo=e=>Kr(e)&&e>=-2147483648&&e<=2147483647&&-1===e.toString().indexOf("."),Vo=e=>Kr(e)&&e>=wr&&e<=br&&-1===e.toString().indexOf("."),Yo={array:Mr,bool:Tr,boolean:Tr,date:Rr,decimal:Kr,double:Kr,int:Wo,long:Vo,number:Kr,null:Uo,object:Dr,regex:Nr,regexp:Nr,string:Cr,undefined:Fr,function:e=>{throw new Error("unsupported type key `function`.")},1:Kr,2:Cr,3:Dr,4:Mr,6:Fr,8:Tr,9:Rr,10:Uo,11:Nr,16:Wo,18:Vo,19:Kr};function Ho(e,t,n){const r=Yo[t];return!!r&&r(e)}function Go(e,t,n){return Ur(e).some((e=>Ir(e)===Ir(t)&&n(e,t)))}Fo((function(e,t,n){if(!(Mr(e)&&Mr(t)&&e.length&&t.length))return!1;let r=!0;for(const o of t){if(!r)break;r=Dr(o)&&Br(Object.keys(o),"$elemMatch")?zo(e,o.$elemMatch,n):o instanceof RegExp?e.some((e=>"string"==typeof e&&o.test(e))):e.some((e=>Xr(o,e)))}return r}));const Qo=Fo(zo),Xo=Fo((function(e,t,n){return e.length===t})),Jo=e=>Fo(((t,n,r)=>{let o=0;if(n instanceof Array)for(const e of n)o|=1<<e;else o=n;return e(t&o,o)})),Zo=(Jo(((e,t)=>0==e)),Jo(((e,t)=>e==t)),Jo(((e,t)=>e<t)),Jo(((e,t)=>e>0)),Fo(Bo)),ei=Fo((function(e,t,n){return Go(e,t,((e,t)=>e>t))})),ti=Fo((function(e,t,n){return Go(e,t,((e,t)=>e>=t))})),ni=Fo(qo),ri=Fo((function(e,t,n){return Go(e,t,((e,t)=>e<t))})),oi=Fo((function(e,t,n){return Go(e,t,((e,t)=>e<=t))})),ii=Fo((function(e,t,n){return!Bo(e,t,n)})),si=Fo((function(e,t,n){return!qo(e,t,n)})),ai=Fo((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),ui=Fo((function(e,t,n){return Array.isArray(t)?t.findIndex((t=>Ho(e,t)))>=0:Ho(e,t)}));const ci=Fo((function(e,t,n){return Ur(e).some((e=>2===t.length&&e%t[0]===t[1]))})),li=Fo((function(e,t,n){const r=Ur(e),o=e=>Cr(e)&&!!t.exec(e);return r.some(o)||Qr(r,1).some(o)}));function hi(e,t,n){Pr(Mr(t),"Invalid expression: $and expects value to be an Array");const r=new Array;return t.forEach((e=>r.push(new Ko(e,n)))),e=>{for(let t=0;t<r.length;t++)if(!r[t].test(e))return!1;return!0}}function fi(e,t,n){Pr(Mr(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new Ko(e,n)));return e=>{for(let t=0;t<r.length;t++)if(r[t].test(e))return!0;return!1}}function di(e,t,n){Pr(Mr(t),"Invalid expression. $nor expects value to be an Array");const r=fi(0,t,n);return e=>!r(e)}function pi(e,t,n){const r={};r[e]=po(t);const o=new Ko(r,n);return e=>!o.test(e)}var yi=!1;function mi(e){return yi||(wo(mo.PIPELINE,{$sort:Ro,$project:Mo}),wo(mo.QUERY,{$and:hi,$eq:Zo,$elemMatch:Qo,$exists:ai,$gt:ei,$gte:ti,$in:ni,$lt:ri,$lte:oi,$ne:ii,$nin:si,$mod:ci,$nor:di,$not:pi,$or:fi,$regex:li,$size:Xo,$type:ui}),yi=!0),new Ko(e)}new Map,new Map;var vi=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},gi=new Set(["__proto__","prototype","constructor"]),bi=new Set("0123456789");function wi(e){var t=[],n="",r="start",o=!1;for(var i of e)switch(i){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");o&&(n+=i),r="property",o=!o;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(o){o=!1,n+=i;break}if(gi.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(o){o=!1,n+=i;break}if("property"===r){if(gi.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!bi.has(i))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),o&&(o=!1,n+="\\"),n+=i}switch(o&&(n+="\\"),r){case"property":if(gi.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function _i(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function xi(e,t){var n=t,r=function(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!vi(e)||"string"!=typeof t)return void 0===n?e:n;var r=wi(t);if(0===r.length)return n;for(var o=0;o<r.length;o++){var i=r[o];if(null==(e=_i(e,i)?o===r.length-1?void 0:null:e[i])){if(o!==r.length-1)return n;break}}return void 0===e?n:e}(e,n=function(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}(n="properties."+(n=n.replace(/\./g,".properties."))));return r}function Ei(e){return"string"==typeof e?e:e.key}var ki=String.fromCharCode(65535),Oi=-1/0;function Si(e,t){var n=Ei(e.primaryKey),r=t.selector,o=e.indexes?e.indexes.slice(0):[];t.index?o=[t.index]:o.push([n]);var i,s=t.sort.map((e=>Object.keys(e)[0])).join(","),a=!!t.sort.find((e=>"desc"===Object.values(e)[0])),u=-1;return o.forEach((e=>{var n=!0,o=!0,c=e.map((e=>{var t=r[e],i=t?Object.keys(t):[],s={};return t&&i.length?i.forEach((e=>{if(ji.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t};case"$lte":return{endKey:t};case"$gte":return{startKey:t};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);s=Object.assign(s,n)}})):s={startKey:o?Oi:ki,endKey:n?ki:Oi,inclusiveStart:!0,inclusiveEnd:!0},void 0===s.startKey&&(s.startKey=Oi),void 0===s.endKey&&(s.endKey=ki),void 0===s.inclusiveStart&&(s.inclusiveStart=!0),void 0===s.inclusiveEnd&&(s.inclusiveEnd=!0),o&&!s.inclusiveStart&&(o=!1),n&&!s.inclusiveEnd&&(n=!1),s})),l={index:e,startKeys:c.map((e=>e.startKey)),endKeys:c.map((e=>e.endKey)),inclusiveEnd:n,inclusiveStart:o,sortFieldsSameAsIndexFields:!a&&s===e.join(","),selectorSatisfiedByIndex:Ii(e,t.selector)},h=function(e,t,n){var r=0,o=10,i=n.startKeys.findIndex((e=>e===Oi));i>0&&(r+=i*o);var s=n.endKeys.findIndex((e=>e===ki));s>0&&(r+=s*o);var a=5;n.sortFieldsSameAsIndexFields&&(r+=a);return r}(0,0,l);(h>0&&h>u||t.index)&&(u=h,i=l)})),i||(i={index:[n],startKeys:[Oi],endKeys:[ki],inclusiveEnd:!0,inclusiveStart:!0,sortFieldsSameAsIndexFields:!a&&s===n,selectorSatisfiedByIndex:Ii([n],t.selector)}),i}var ji=new Set(["$eq","$gt","$gte","$lt","$lte"]),Pi=new Set(["$eq","$gt","$gte"]),Ai=new Set(["$eq","$lt","$lte"]);function Ii(e,t){var n,r;return!Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!ji.has(e)))))&&(!e.find((e=>{var r=t[e];if(!r)return!1;var o=Object.keys(r).find((e=>Pi.has(e)));return!(!n||!o)||("$eq"!==o&&(n=o),!1)}))&&!e.find((e=>{var n=t[e];if(!n)return!1;var o=Object.keys(n).find((e=>Ai.has(e)));return!(!r||!o)||("$eq"!==o&&(r=o),!1)})))}var Ti={prepareQuery(e,t){if(!t.sort)throw p("SNH",{query:t});return{query:t,queryPlan:Si(e,t)}},getSortComparator:(e,t)=>function(e,t){var n={};if(!t.sort)throw p("SNH",{query:t});return t.sort.forEach((e=>{var t=Object.keys(e)[0],r=Object.values(e)[0];n[t]=function(e){return"asc"===e?1:-1}(r)})),(e,t)=>mi({}).find([e,t],{}).sort(n).next()===e?-1:1}(0,t.query),getQueryMatcher(e,t){var n=mi(t.query.selector);return e=>!e._deleted&&!!n.find([e]).next()},checkpointSchema:{type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}},Ci=function(e,t){return Ci=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ci(e,t)};function Ki(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ci(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;function Mi(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Di(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function $i(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;function Ri(e){return"function"==typeof e}function Ni(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Fi=Ni((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Bi(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var qi=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=Mi(i),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var u=this.initialTeardown;if(Ri(u))try{u()}catch(e){o=e instanceof Fi?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var l=Mi(c),h=l.next();!h.done;h=l.next()){var f=h.value;try{Ui(f)}catch(e){o=null!=o?o:[],e instanceof Fi?o=$i($i([],Di(o)),Di(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new Fi(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Ui(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Bi(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Bi(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Li=qi.EMPTY;function zi(e){return e instanceof qi||e&&"closed"in e&&Ri(e.remove)&&Ri(e.add)&&Ri(e.unsubscribe)}function Ui(e){Ri(e)?e():e.unsubscribe()}var Wi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Vi={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Vi.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,$i([e,t],Di(n))):setTimeout.apply(void 0,$i([e,t],Di(n)))},clearTimeout:function(e){var t=Vi.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Yi(){}var Hi=Gi("C",void 0,void 0);function Gi(e,t,n){return{kind:e,value:t,error:n}}var Qi=null;function Xi(e){if(Wi.useDeprecatedSynchronousErrorHandling){var t=!Qi;if(t&&(Qi={errorThrown:!1,error:null}),e(),t){var n=Qi,r=n.errorThrown,o=n.error;if(Qi=null,r)throw o}}else e()}var Ji=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,zi(t)&&t.add(n)):n.destination=is,n}return Ki(t,e),t.create=function(e,t,n){return new ns(e,t,n)},t.prototype.next=function(e){this.isStopped?os(function(e){return Gi("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?os(Gi("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?os(Hi,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(qi),Zi=Function.prototype.bind;function es(e,t){return Zi.call(e,t)}var ts=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){rs(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){rs(e)}else rs(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){rs(e)}},e}(),ns=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;Ri(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Wi.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&es(t.next,i),error:t.error&&es(t.error,i),complete:t.complete&&es(t.complete,i)}):o=t;return s.destination=new ts(o),s}return Ki(t,e),t}(Ji);function rs(e){var t;Wi.useDeprecatedSynchronousErrorHandling?(t=e,Wi.useDeprecatedSynchronousErrorHandling&&Qi&&(Qi.errorThrown=!0,Qi.error=t)):function(e){Vi.setTimeout((function(){var t=Wi.onUnhandledError;if(!t)throw e;t(e)}))}(e)}function os(e,t){var n=Wi.onStoppedNotification;n&&Vi.setTimeout((function(){return n(e,t)}))}var is={closed:!0,next:Yi,error:function(e){throw e},complete:Yi},ss="function"==typeof Symbol&&Symbol.observable||"@@observable";function as(e){return e}function us(e){return 0===e.length?as:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var cs=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof Ji||function(e){return e&&Ri(e.next)&&Ri(e.error)&&Ri(e.complete)}(r)&&zi(r)?e:new ns(e,t,n);return Xi((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=ls(t))((function(t,r){var o=new ns({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ss]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return us(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=ls(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function ls(e){var t;return null!==(t=null!=e?e:Wi.Promise)&&void 0!==t?t:Promise}var hs=Ni((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),fs=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ki(t,e),t.prototype.lift=function(e){var t=new ds(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new hs},t.prototype.next=function(e){var t=this;Xi((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Mi(t.currentObservers),i=o.next();!i.done;i=o.next()){i.value.next(e)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Xi((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Xi((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?Li:(this.currentObservers=null,i.push(e),new qi((function(){t.currentObservers=null,Bi(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new cs;return e.source=this,e},t.create=function(e,t){return new ds(e,t)},t}(cs),ds=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ki(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Li},t}(fs);function ps(e,t){var n=t.map((t=>{var n=xi(e,t);if(!n)throw new Error("not in schema: "+t);var r,o,i,s=n.type;return"number"!==s&&"integer"!==s||(r=ys(n)),{fieldName:t,schemaPart:n,parsedLengths:r,hasComplexPath:t.includes("."),getValueFn:(o=t,i=o.split("."),1===i.length?e=>e[o]:e=>{for(var t=e,n=0;n<i.length;){if(void 0===(t=t[i[n]]))return t;n++}return t})}}));return function(e){var t="";return n.forEach((n=>{var r=n.schemaPart,o=r.type,i=n.getValueFn(e);if("string"===o)i||(i=""),t+=i.padEnd(r.maxLength," ");else if("boolean"===o){t+=i?"1":"0"}else{var s=y(n.parsedLengths);i||(i=0),t+=ms(s,i)}})),t}}function ys(e){var t=Math.floor(e.minimum),n=Math.ceil(e.maximum),r=e.multipleOf,o=(n-t).toString().length,i=r.toString().split("."),s=0;return i.length>1&&(s=i[1].length),{nonDecimals:o,decimals:s,roundedMinimum:t}}function ms(e,t){var n="";n+=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");var r=t.toString().split(".");return n+=(r.length>1?r[1]:"0").padEnd(e.decimals,"0")}function vs(e,t,n,r){var o="";return t.forEach(((t,i)=>{var s=xi(e,t),a=n[i],u=s.type;switch(u){case"string":var c=y(s.maxLength);o+="string"==typeof a?a.padEnd(c," "):"".padEnd(c," ");break;case"boolean":if(null===a)o+=r?"0":ki;else o+=a?"1":"0";break;case"number":case"integer":var l=ys(s);if(null===a||a===Oi)o+=(r?"0":ki).repeat(l.nonDecimals+l.decimals);else o+=ms(l,a);break;default:throw new Error("unknown index type "+u)}})),o}var gs=Promise.resolve(!0),bs=(Promise.resolve(!1),Promise.resolve(null),Promise.resolve());function ws(e,t,n,r,o){for(var i=o+1;r<=o;){var s=r+o>>>1,a=e[s];(void 0!==n?n(a,t):a-t)>=0?(i=s,o=s-1):r=s+1}return i}function _s(e,t,n,r,o){for(var i=o+1;r<=o;){var s=r+o>>>1,a=e[s];(void 0!==n?n(a,t):a-t)>0?(i=s,o=s-1):r=s+1}return i}function xs(e,t,n,r,o){for(var i=r-1;r<=o;){var s=r+o>>>1,a=e[s];(void 0!==n?n(a,t):a-t)<=0?(i=s,r=s+1):o=s-1}return i}function Es(e,t,n,r,o){for(;r<=o;){var i=r+o>>>1,s=e[i],a=void 0!==n?n(s,t):s-t;if(0===a)return i;a<=0?r=i+1:o=i-1}return-1}function ks(e,t,n,r,o,i){return"function"==typeof n?i(e,t,n,void 0===r?0:0|r,void 0===o?e.length-1:0|o):i(e,t,void 0,void 0===n?0:0|n,void 0===r?e.length-1:0|r)}function Os(e,t,n,r,o){return ks(e,t,n,r,o,_s)}function Ss(e,t,n,r,o){return ks(e,t,n,r,o,Es)}function js(e,t){return e+"--memory--"+t}function Ps(e){if(e.internals.removed)throw new Error("removed")}function As(e,t){return e+"||"+t}var Is=(e,t)=>e.indexString<t.indexString?-1:1;function Ts(e,t,n,r,o){t.documents.set(e,r.document),n.forEach((t=>{var n=t.docsWithIndex,i=t.getIndexableString(r.document),[,s]=function(e,t,n,r){var o,i=r?e:e.slice(0),s=i.length-1,a=0,u=0;if(0===i.length)return i.push(t),[i,0];for(;a<=s;)n(o=i[u=a+(s-a>>1)],t)<=0?a=u+1:s=u-1;return n(o,t)<=0&&u++,i.splice(u,0,t),[i,u]}(n,{id:e,doc:r.document,indexString:i},Is,!0);if(o){var a=t.getIndexableString(o);if(a===i){var u=n[s-1];if(u&&u.id===e)n.splice(s-1,1);else{if(n[s+1].id!==e)throw p("SNH",{args:{row:r,byIndex:t}});n.splice(s+1,1)}}else{var c=Ss(n,{indexString:a},Ks);n.splice(c,1)}}}))}function Cs(e,t,n,r){var o=r[e];n.documents.delete(o),Object.values(n.byIndex).forEach((e=>{var t=e.docsWithIndex,n=Ss(t,{indexString:e.getIndexableString(r)},Ks);t.splice(n,1)}))}function Ks(e,t){return e.indexString<t.indexString?-1:e.indexString===t.indexString?0:1}function Ms(e,t){var n=Ei(t.primaryKey),r=t.indexes?t.indexes.map((e=>{return t=e,Array.isArray(t)?t.slice(0):[t];var t})):[];r.push([n]),r.push(["_meta.lwt",n]),r.forEach((n=>{n.unshift("_deleted"),e.byIndex[Ds(n)]={index:n,docsWithIndex:[],getIndexableString:ps(t,n)}}));var o=["_meta.lwt",n],i=Ds(o);e.byIndex[i]={index:o,docsWithIndex:[],getIndexableString:ps(t,o)}}function Ds(e){return e.join(",")}var $s=function(){function e(e,t,n,r,o,i,s){this.closed=!1,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=o,this.options=i,this.settings=s,this.primaryPath=Ei(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=function(e,t){Ps(this);var n={success:{},error:{}},r=function(e,t,n,r,o){var i=!!e.schema.attachments,s=[],a=[],u={},c=[],l={id:v(10),events:[],checkpoint:null,context:o},h=[],f=[],d=[],m=b(),g="function"==typeof n.get;return r.forEach((r=>{var o,v=r.document[t],w=g?n.get(v):n[v];if(w){var _=w._rev;if(!r.previous||r.previous&&_!==r.previous._rev){var O={isError:!0,status:409,documentId:v,writeRow:r,documentInDb:w};return void(u[v]=O)}var S=i?x(r):r;r.document._deleted?r.previous&&Object.keys(r.previous._attachments).forEach((e=>{f.push({documentId:v,attachmentId:e})})):(Object.entries(r.document._attachments).find((([e,t])=>((r.previous?r.previous._attachments[e]:void 0)||t.data||(o={documentId:v,documentInDb:w,isError:!0,status:510,writeRow:r,attachmentId:e}),!0))),o||Object.entries(r.document._attachments).forEach((([e,t])=>{var n=r.previous?r.previous._attachments[e]:void 0;if(n){var o=S.document._attachments[e].digest;t.data&&n.digest!==o&&d.push({documentId:v,attachmentId:e,attachmentData:t})}else h.push({documentId:v,attachmentId:e,attachmentData:t})}))),o?u[v]=o:a.push(S);var j=r.document,P=null,A=null,I=null;if(r.previous&&r.previous._deleted&&!j._deleted)I="INSERT",P=i?E(j):j;else if(!r.previous||r.previous._deleted||j._deleted){if(!j._deleted)throw p("SNH",{args:{writeRow:r}});I="DELETE",P=y(r.document),A=r.previous}else I="UPDATE",P=i?E(j):j,A=r.previous;c.push(v),l.events.push({eventId:k(e,t,r),documentId:v,documentData:y(P),previousDocumentData:A,operation:I,startTime:m,endTime:b()})}else{var T=!!r.document._deleted;Object.entries(r.document._attachments).forEach((([e,t])=>{t.data?h.push({documentId:v,attachmentId:e,attachmentData:t}):(o={documentId:v,isError:!0,status:510,writeRow:r,attachmentId:e},u[v]=o)})),o||(i?s.push(x(r)):s.push(r)),T||(c.push(v),l.events.push({eventId:k(e,t,r),documentId:v,operation:"INSERT",documentData:i?E(r.document):r.document,previousDocumentData:i&&r.previous?E(r.previous):r.previous,startTime:m,endTime:b()}))}})),{bulkInsertDocs:s,bulkUpdateDocs:a,errors:u,changedDocumentIds:c,eventBulk:l,attachmentsAdd:h,attachmentsRemove:f,attachmentsUpdate:d}}(this,this.primaryPath,this.internals.documents,e,t);n.error=r.errors;var o=Object.values(this.internals.byIndex);r.bulkInsertDocs.forEach((e=>{var t=e.document[this.primaryPath];Ts(t,this.internals,o,e,void 0),n.success[t]=e.document})),r.bulkUpdateDocs.forEach((e=>{var t=e.document[this.primaryPath];Ts(t,this.internals,o,e,this.internals.documents.get(t)),n.success[t]=e.document}));var i=this.internals.attachments;if(r.attachmentsAdd.forEach((e=>{i.set(As(e.documentId,e.attachmentId),e.attachmentData)})),r.attachmentsUpdate.forEach((e=>{i.set(As(e.documentId,e.attachmentId),e.attachmentData)})),r.attachmentsRemove.forEach((e=>{i.delete(As(e.documentId,e.attachmentId))})),r.eventBulk.events.length>0){var s=function(e,t){var n=null;return t.forEach((t=>{(!n||t._meta.lwt>n._meta.lwt||t._meta.lwt===n._meta.lwt&&t[e]>n[e])&&(n=t)})),y(n)}(this.primaryPath,Object.values(n.success));r.eventBulk.checkpoint={id:s[this.primaryPath],lwt:s._meta.lwt},this.internals.changes$.next(r.eventBulk)}return Promise.resolve(n)},t.findDocumentsById=function(e,t){var n={};return e.forEach((e=>{var r=this.internals.documents.get(e);!r||r._deleted&&!t||(n[e]=r)})),Promise.resolve(n)},t.query=function(e){var t=e.queryPlan,n=e.query,r=n.skip?n.skip:0,o=r+(n.limit?n.limit:1/0),i=!1;t.selectorSatisfiedByIndex||(i=Ti.getQueryMatcher(this.schema,e));var s=t.index,a=!t.sortFieldsSameAsIndexFields,u=["_deleted"].concat(s),c=t.startKeys;c=[!1].concat(c);var l=vs(this.schema,u,c,t.inclusiveStart),h=t.endKeys;h=[!1].concat(h);for(var f=function(e,t,n,r){var o="";return t.forEach(((t,i)=>{var s=xi(e,t),a=n[i],u=s.type;switch(u){case"string":var c=y(s.maxLength);o+="string"==typeof a?a.padEnd(c,r?ki:" "):"".padEnd(c,r?ki:" ");break;case"boolean":o+=null===a?r?"0":"1":a?"1":"0";break;case"number":case"integer":var l=ys(s);o+=null===a||a===ki?(r?"9":"0").repeat(l.nonDecimals+l.decimals):ms(l,a);break;default:throw new Error("unknown index type "+u)}})),o}(this.schema,u,h,t.inclusiveEnd),d=Ds(u),p=this.internals.byIndex[d].docsWithIndex,m=function(e,t,n,r,o){return ks(e,t,n,r,o,ws)}(p,{indexString:l},Ks),v=function(e,t,n,r,o){return ks(e,t,n,r,o,xs)}(p,{indexString:f},Ks),g=[],b=!1;!b;){var w=p[m];if(!w||m>v)break;i&&!i(w.doc)||g.push(w.doc),(g.length>=o&&!a||m>=p.length)&&(b=!0),m++}if(a){var _=Ti.getSortComparator(this.schema,e);g=g.sort(_)}return g=g.slice(r,o),Promise.resolve({documents:g})},t.count=async function(e){return{count:(await this.query(e)).documents.length,mode:"fast"}},t.getChangedDocumentsSince=function(e,t){for(var n=t?t.lwt:1,r=t?t.id:"",o=Ds(["_meta.lwt",this.primaryPath]),i=vs(this.schema,["_meta.lwt",this.primaryPath],[n,r],!1),s=this.internals.byIndex[o].docsWithIndex,a=Os(s,{indexString:i},Ks),u=[];u.length<e&&a<s.length;){var c=s[a];u.push(c.doc),a++}var l,h=(l=u)[l.length-1];return Promise.resolve({documents:u,checkpoint:h?{id:h[this.primaryPath],lwt:h._meta.lwt}:t||{id:"",lwt:0}})},t.cleanup=function(e){for(var t=b()-e,n=["_deleted","_meta.lwt",this.primaryPath],r=Ds(n),o=this.internals.byIndex[r].docsWithIndex,i=Os(o,{indexString:vs(this.schema,n,[!0,0,""],!1)},Ks),s=!1;!s;){var a=o[i];!a||a.doc._meta.lwt>t?s=!0:(Cs(this.primaryPath,this.schema,this.internals,a.doc),i++)}return gs},t.getAttachmentData=function(e,t){Ps(this);var n=m(this.internals.attachments,As(e,t));return Promise.resolve(n.data)},t.changeStream=function(){return Ps(this),this.internals.changes$.asObservable()},t.remove=async function(){Ps(this),this.internals.removed=!0,this.storage.collectionStates.delete(js(this.databaseName,this.collectionName)),await this.close()},t.close=function(){return this.closed?Promise.reject(new Error("already closed")):(this.closed=!0,this.internals.refCount=this.internals.refCount-1,bs)},t.conflictResultionTasks=function(){return this.internals.conflictResultionTasks$.asObservable()},t.resolveConflictResultionTask=function(e){return bs},e}();var Rs=new Map;var Ns=n(934);const Fs=Ns.expose;Ns.registerSerializer,Ns.Transfer;var Bs,qs,Ls,zs,Us=function(e={}){var t={name:"memory",statics:Ti,collectionStates:Rs,createStorageInstance(t){return function(e){if(e.schema.keyCompression)throw p("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw p("UT6",{args:{params:e}});var t}(t),(t=_(t)).collectionName=t.collectionName+"-"+t.schema.version,function(e,t,n){var r=js(t.databaseName,t.collectionName),o=e.collectionStates.get(r);o?o.refCount=o.refCount+1:(Ms(o={removed:!1,refCount:1,documents:new Map,attachments:t.schema.attachments?new Map:void 0,byIndex:{},conflictResultionTasks$:new fs,changes$:new fs},t.schema),e.collectionStates.set(r,o));var i=new $s(e,t.databaseName,t.collectionName,t.schema,o,t.options,n);return Promise.resolve(i)}(this,t,Object.assign({},e,t.options))}};return t}({});Bs={storage:Us},qs=0,Ls=new Map,zs={async createStorageInstance(e){var t=qs++,n=await Bs.storage.createStorageInstance(e);return Ls.set(t,n),t},bulkWrite:(e,t,n)=>m(Ls,e).bulkWrite(t,n),findDocumentsById:(e,t,n)=>m(Ls,e).findDocumentsById(t,n),query:(e,t)=>m(Ls,e).query(t),count:(e,t)=>m(Ls,e).count(t),getAttachmentData:(e,t,n)=>m(Ls,e).getAttachmentData(t,n),getChangedDocumentsSince:(e,t,n)=>m(Ls,e).getChangedDocumentsSince(t,n),changeStream:e=>m(Ls,e).changeStream(),cleanup:(e,t)=>m(Ls,e).cleanup(t),close:e=>m(Ls,e).close(),remove:e=>m(Ls,e).remove(),conflictResultionTasks:e=>m(Ls,e).conflictResultionTasks(),resolveConflictResultionTask:(e,t)=>m(Ls,e).resolveConflictResultionTask(t)},Fs(zs)})()})();
//# sourceMappingURL=memory.worker.js.map