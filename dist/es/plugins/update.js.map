{"version":3,"file":"update.js","names":["modifyjs","update","updateObj","oldDocData","_data","newDocData","_saveData","RxQueryUpdate","exec","then","docs","Array","isArray","Promise","all","map","doc","RxDBUpdatePlugin","name","rxdb","prototypes","RxDocument","proto","RxQuery"],"sources":["../../../src/plugins/update.ts"],"sourcesContent":["/**\n * this plugin allows delta-updates with mongo-like-syntax\n * It's using modifyjs internally\n * @link https://github.com/lgandecki/modifyjs\n */\nimport modifyjs from 'modifyjs';\nimport type {\n    RxDocument,\n    RxQuery,\n    RxPlugin\n} from '../types';\n\nexport function update(this: RxDocument, updateObj: any) {\n    const oldDocData = this._data;\n    const newDocData = modifyjs(oldDocData, updateObj);\n    return this._saveData(newDocData, oldDocData);\n}\n\nexport function RxQueryUpdate(\n    this: RxQuery,\n    updateObj: any\n): Promise<any> {\n    return this.exec()\n        .then(docs => {\n            if (!docs) {\n                return null;\n            }\n            if (Array.isArray(docs)) {\n                return Promise.all(\n                    docs.map(doc => doc.update(updateObj))\n                ).then(() => docs);\n            } else {\n                // via findOne()\n                return docs.update(updateObj).then(() => docs);\n            }\n        });\n}\n\n\nexport const RxDBUpdatePlugin: RxPlugin = {\n    name: 'update',\n    rxdb: true,\n    prototypes: {\n        RxDocument: (proto: any) => {\n            proto.update = update;\n        },\n        RxQuery: (proto: any) => {\n            proto.update = RxQueryUpdate;\n        }\n    }\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,QAAP,MAAqB,UAArB;AAOA,OAAO,SAASC,MAAT,CAAkCC,SAAlC,EAAkD;EACrD,IAAMC,UAAU,GAAG,KAAKC,KAAxB;EACA,IAAMC,UAAU,GAAGL,QAAQ,CAACG,UAAD,EAAaD,SAAb,CAA3B;EACA,OAAO,KAAKI,SAAL,CAAeD,UAAf,EAA2BF,UAA3B,CAAP;AACH;AAED,OAAO,SAASI,aAAT,CAEHL,SAFG,EAGS;EACZ,OAAO,KAAKM,IAAL,GACFC,IADE,CACG,UAAAC,IAAI,EAAI;IACV,IAAI,CAACA,IAAL,EAAW;MACP,OAAO,IAAP;IACH;;IACD,IAAIC,KAAK,CAACC,OAAN,CAAcF,IAAd,CAAJ,EAAyB;MACrB,OAAOG,OAAO,CAACC,GAAR,CACHJ,IAAI,CAACK,GAAL,CAAS,UAAAC,GAAG;QAAA,OAAIA,GAAG,CAACf,MAAJ,CAAWC,SAAX,CAAJ;MAAA,CAAZ,CADG,EAELO,IAFK,CAEA;QAAA,OAAMC,IAAN;MAAA,CAFA,CAAP;IAGH,CAJD,MAIO;MACH;MACA,OAAOA,IAAI,CAACT,MAAL,CAAYC,SAAZ,EAAuBO,IAAvB,CAA4B;QAAA,OAAMC,IAAN;MAAA,CAA5B,CAAP;IACH;EACJ,CAbE,CAAP;AAcH;AAGD,OAAO,IAAMO,gBAA0B,GAAG;EACtCC,IAAI,EAAE,QADgC;EAEtCC,IAAI,EAAE,IAFgC;EAGtCC,UAAU,EAAE;IACRC,UAAU,EAAE,oBAACC,KAAD,EAAgB;MACxBA,KAAK,CAACrB,MAAN,GAAeA,MAAf;IACH,CAHO;IAIRsB,OAAO,EAAE,iBAACD,KAAD,EAAgB;MACrBA,KAAK,CAACrB,MAAN,GAAeM,aAAf;IACH;EANO;AAH0B,CAAnC"}