{"version":3,"sources":["../../../../src/plugins/replication/revision-flag.ts"],"names":["hash","createRevisionForPulledDocument","replicationIdentifier","doc","replicationIdentifierHash","dataHash","ret","substring","wasRevisionfromPullReplication","revision","useFromHash","endsWith"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SACIA,IADJ,QAEO,YAFP;AAKA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,+BAAT,CACHC,qBADG,EAEHC,GAFG,EAGL;AACE,MAAMC,yBAAyB,GAAGJ,IAAI,CAACE,qBAAD,CAAtC;AACA,MAAMG,QAAQ,GAAGL,IAAI,CAACG,GAAD,CAArB;AAEA,MAAMG,GAAG,GACLD,QAAQ,CAACE,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,IACAH,yBAAyB,CAACG,SAA1B,CAAoC,CAApC,EAAuC,EAAvC,CAFJ;AAGA,SAAOD,GAAP;AACH;AAED,OAAO,SAASE,8BAAT,CACHN,qBADG,EAEHO,QAFG,EAGL;AACE,MAAML,yBAAyB,GAAGJ,IAAI,CAACE,qBAAD,CAAtC;AACA,MAAMQ,WAAW,GAAGN,yBAAyB,CAACG,SAA1B,CAAoC,CAApC,EAAuC,EAAvC,CAApB;AAEA,MAAMD,GAAG,GAAGG,QAAQ,CAACE,QAAT,CAAkBD,WAAlB,CAAZ;AACA,SAAOJ,GAAP;AACH","sourcesContent":["/**\n * The replication handler needs to know\n * which local documents have been lastly written locally\n * and which came from the remote.\n * To determine this, we 'flag' the document\n * by setting a specially crafted revision string.\n */\n\nimport {\n    hash\n} from '../../util';\n\n\n/**\n * Returns a new revision key without the revision height.\n * The revision is crafted for the graphql replication\n * and contains the information that this document data was pulled\n * from the remote server and not saved by the client.\n */\nexport function createRevisionForPulledDocument(\n    replicationIdentifier: string,\n    doc: any\n) {\n    const replicationIdentifierHash = hash(replicationIdentifier);\n    const dataHash = hash(doc);\n\n    const ret =\n        dataHash.substring(0, 8) +\n        replicationIdentifierHash.substring(0, 30);\n    return ret;\n}\n\nexport function wasRevisionfromPullReplication(\n    replicationIdentifier: string,\n    revision: string\n) {\n    const replicationIdentifierHash = hash(replicationIdentifier);\n    const useFromHash = replicationIdentifierHash.substring(0, 30)\n\n    const ret = revision.endsWith(useFromHash);\n    return ret;\n}\n"],"file":"revision-flag.js"}