{"version":3,"file":"utils.js","names":["getKey","getUserFields","selector","sort","selectorFields","Object","keys","sortFields","map","userFields","length","fields","left","right","leftIdx","indexOf","Number","MAX_VALUE","rightIdx","sortOrder"],"sources":["../../../../../../src/plugins/dexie/query/pouchdb-find-query-planer/utils.ts"],"sourcesContent":["import { getKey } from 'pouchdb-selector-core';\n\n// determine the maximum number of fields\n// we're going to need to query, e.g. if the user\n// has selection ['a'] and sorting ['a', 'b'], then we\n// need to use the longer of the two: ['a', 'b']\nexport function getUserFields(selector: any, sort: any) {\n  const selectorFields = Object.keys(selector);\n  const sortFields = sort? sort.map(getKey) : [];\n  let userFields;\n  if (selectorFields.length >= sortFields.length) {\n    userFields = selectorFields;\n  } else {\n    userFields = sortFields;\n  }\n\n  if (sortFields.length === 0) {\n    return {\n      fields: userFields\n    };\n  }\n\n  // sort according to the user's preferred sorting\n  userFields = userFields.sort(function (left: any, right: any) {\n    let leftIdx = sortFields.indexOf(left);\n    if (leftIdx === -1) {\n      leftIdx = Number.MAX_VALUE;\n    }\n    let rightIdx = sortFields.indexOf(right);\n    if (rightIdx === -1) {\n      rightIdx = Number.MAX_VALUE;\n    }\n    return leftIdx < rightIdx ? -1 : leftIdx > rightIdx ? 1 : 0;\n  });\n\n  return {\n    fields: userFields,\n    sortOrder: sort.map(getKey)\n  };\n}\n"],"mappings":"AAAA,SAASA,MAAT,QAAuB,uBAAvB,C,CAEA;AACA;AACA;AACA;;AACA,OAAO,SAASC,aAAT,CAAuBC,QAAvB,EAAsCC,IAAtC,EAAiD;EACtD,IAAMC,cAAc,GAAGC,MAAM,CAACC,IAAP,CAAYJ,QAAZ,CAAvB;EACA,IAAMK,UAAU,GAAGJ,IAAI,GAAEA,IAAI,CAACK,GAAL,CAASR,MAAT,CAAF,GAAqB,EAA5C;EACA,IAAIS,UAAJ;;EACA,IAAIL,cAAc,CAACM,MAAf,IAAyBH,UAAU,CAACG,MAAxC,EAAgD;IAC9CD,UAAU,GAAGL,cAAb;EACD,CAFD,MAEO;IACLK,UAAU,GAAGF,UAAb;EACD;;EAED,IAAIA,UAAU,CAACG,MAAX,KAAsB,CAA1B,EAA6B;IAC3B,OAAO;MACLC,MAAM,EAAEF;IADH,CAAP;EAGD,CAdqD,CAgBtD;;;EACAA,UAAU,GAAGA,UAAU,CAACN,IAAX,CAAgB,UAAUS,IAAV,EAAqBC,KAArB,EAAiC;IAC5D,IAAIC,OAAO,GAAGP,UAAU,CAACQ,OAAX,CAAmBH,IAAnB,CAAd;;IACA,IAAIE,OAAO,KAAK,CAAC,CAAjB,EAAoB;MAClBA,OAAO,GAAGE,MAAM,CAACC,SAAjB;IACD;;IACD,IAAIC,QAAQ,GAAGX,UAAU,CAACQ,OAAX,CAAmBF,KAAnB,CAAf;;IACA,IAAIK,QAAQ,KAAK,CAAC,CAAlB,EAAqB;MACnBA,QAAQ,GAAGF,MAAM,CAACC,SAAlB;IACD;;IACD,OAAOH,OAAO,GAAGI,QAAV,GAAqB,CAAC,CAAtB,GAA0BJ,OAAO,GAAGI,QAAV,GAAqB,CAArB,GAAyB,CAA1D;EACD,CAVY,CAAb;EAYA,OAAO;IACLP,MAAM,EAAEF,UADH;IAELU,SAAS,EAAEhB,IAAI,CAACK,GAAL,CAASR,MAAT;EAFN,CAAP;AAID"}