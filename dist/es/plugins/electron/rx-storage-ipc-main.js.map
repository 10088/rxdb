{"version":3,"file":"rx-storage-ipc-main.js","names":["Subject","IPC_RENDERER_KEY_PREFIX","exposeRxStorageMessageChannel","exposeIpcMainRxStorage","args","channelId","key","join","messages$","openRenderers","Set","ipcMain","on","event","message","add","sender","next","send","msg","forEach","storage"],"sources":["../../../../src/plugins/electron/rx-storage-ipc-main.ts"],"sourcesContent":["/**\n * This file contains everything\n * that is supposed to run inside of the electron main process\n */\nimport type {\n    RxStorage\n} from '../../types';\nimport { Subject } from 'rxjs';\nimport {\n    IPC_RENDERER_KEY_PREFIX\n} from './electron-helper';\nimport {\n    exposeRxStorageMessageChannel,\n    RxMessageChannelExposeSettings,\n    RxStorageMessageToRemote\n} from '../../rx-storage-message-channel';\nexport function exposeIpcMainRxStorage<T, D>(\n    args: {\n        key: string;\n        storage: RxStorage<T, D>;\n        ipcMain: any;\n    }\n) {\n    const channelId = [\n        IPC_RENDERER_KEY_PREFIX,\n        args.key,\n    ].join('|');\n    const messages$ = new Subject<RxStorageMessageToRemote>();\n    const openRenderers: Set<any> = new Set();\n    args.ipcMain.on(\n        channelId,\n        (event: any, message: any) => {\n            openRenderers.add(event.sender);\n            if (message) {\n                messages$.next(message);\n            }\n        }\n    );\n    const send: RxMessageChannelExposeSettings['send'] = (msg) => {\n        /**\n         * TODO we could improve performance\n         * by only sending the message to the 'correct' sender\n         * and removing senders whose browser window is closed.\n         */\n        openRenderers.forEach(sender => {\n            sender.send(channelId, msg);\n        });\n    };\n    exposeRxStorageMessageChannel({\n        storage: args.storage,\n        messages$,\n        send\n    });\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAIA,SAASA,OAAO,QAAQ,MAAM;AAC9B,SACIC,uBAAuB,QACpB,mBAAmB;AAC1B,SACIC,6BAA6B,QAG1B,kCAAkC;AACzC,OAAO,SAASC,sBAAsB,CAClCC,IAIC,EACH;EACE,IAAMC,SAAS,GAAG,CACdJ,uBAAuB,EACvBG,IAAI,CAACE,GAAG,CACX,CAACC,IAAI,CAAC,GAAG,CAAC;EACX,IAAMC,SAAS,GAAG,IAAIR,OAAO,EAA4B;EACzD,IAAMS,aAAuB,GAAG,IAAIC,GAAG,EAAE;EACzCN,IAAI,CAACO,OAAO,CAACC,EAAE,CACXP,SAAS,EACT,UAACQ,KAAU,EAAEC,OAAY,EAAK;IAC1BL,aAAa,CAACM,GAAG,CAACF,KAAK,CAACG,MAAM,CAAC;IAC/B,IAAIF,OAAO,EAAE;MACTN,SAAS,CAACS,IAAI,CAACH,OAAO,CAAC;IAC3B;EACJ,CAAC,CACJ;EACD,IAAMI,IAA4C,GAAG,SAA/CA,IAA4C,CAAIC,GAAG,EAAK;IAC1D;AACR;AACA;AACA;AACA;IACQV,aAAa,CAACW,OAAO,CAAC,UAAAJ,MAAM,EAAI;MAC5BA,MAAM,CAACE,IAAI,CAACb,SAAS,EAAEc,GAAG,CAAC;IAC/B,CAAC,CAAC;EACN,CAAC;EACDjB,6BAA6B,CAAC;IAC1BmB,OAAO,EAAEjB,IAAI,CAACiB,OAAO;IACrBb,SAAS,EAATA,SAAS;IACTU,IAAI,EAAJA;EACJ,CAAC,CAAC;AACN"}