{"version":3,"file":"unallowed-properties.js","names":["ensureCollectionNameValid","args","includes","name","validateDatabaseName","ensureDatabaseNameIsValid","endsWith","validCouchDBStringRegexStr","validCouchDBStringRegex","RegExp","length","match","regex","givenName"],"sources":["../../../../src/plugins/dev-mode/unallowed-properties.ts"],"sourcesContent":["import type { RxCollectionCreator, RxDatabaseCreator } from '../../types';\nimport { newRxError, newRxTypeError } from '../../rx-error';\nimport { rxDatabaseProperties } from './entity-properties';\nimport { isFolderPath } from '../../util';\n\n/**\n * if the name of a collection\n * clashes with a property of RxDatabase,\n * we get problems so this function prohibits this\n */\nexport function ensureCollectionNameValid(\n    args: RxCollectionCreator & { name: string; }\n) {\n    if (rxDatabaseProperties().includes(args.name)) {\n        throw newRxError('DB5', {\n            name: args.name\n        });\n    }\n    validateDatabaseName(args.name);\n}\n\nexport function ensureDatabaseNameIsValid(args: RxDatabaseCreator<any, any>) {\n\n    validateDatabaseName(args.name);\n\n    /**\n     * The server-plugin has problems when a path with and ending slash is given\n     * So we do not allow this.\n     * @link https://github.com/pubkey/rxdb/issues/2251\n     */\n    if (isFolderPath(args.name)) {\n        if (args.name.endsWith('/') || args.name.endsWith('\\\\')) {\n            throw newRxError('DB11', {\n                name: args.name,\n            });\n        }\n    }\n}\n\n\n\nconst validCouchDBStringRegexStr = '^[a-z][_$a-z0-9\\\\-]*$';\nconst validCouchDBStringRegex = new RegExp(validCouchDBStringRegexStr);\n\n/**\n * Validates that a given string is ok to be used with couchdb-collection-names.\n * We only allow these strings as database- or collection names because it ensures\n * that you later do not get in troubble when you want to use the database together witch couchdb.\n *\n * @link https://docs.couchdb.org/en/stable/api/database/common.html\n * @link https://neighbourhood.ie/blog/2020/10/13/everything-you-need-to-know-about-couchdb-database-names/\n * @throws  {RxError}\n */\nexport function validateDatabaseName(name: string): true {\n    if (\n        typeof name !== 'string' ||\n        name.length === 0\n    ) {\n        throw newRxTypeError('UT1', {\n            name\n        });\n    }\n\n\n    // do not check, if foldername is given\n    if (isFolderPath(name)) {\n        return true;\n    }\n\n    if (!name.match(validCouchDBStringRegex)) {\n        throw newRxError('UT2', {\n            regex: validCouchDBStringRegexStr,\n            givenName: name,\n        });\n    }\n\n    return true;\n}\n"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASA,yBAAT,CACHC,IADG,EAEL;EACE,IAAI,8CAAuBC,QAAvB,CAAgCD,IAAI,CAACE,IAArC,CAAJ,EAAgD;IAC5C,MAAM,yBAAW,KAAX,EAAkB;MACpBA,IAAI,EAAEF,IAAI,CAACE;IADS,CAAlB,CAAN;EAGH;;EACDC,oBAAoB,CAACH,IAAI,CAACE,IAAN,CAApB;AACH;;AAEM,SAASE,yBAAT,CAAmCJ,IAAnC,EAAsE;EAEzEG,oBAAoB,CAACH,IAAI,CAACE,IAAN,CAApB;EAEA;AACJ;AACA;AACA;AACA;;EACI,IAAI,wBAAaF,IAAI,CAACE,IAAlB,CAAJ,EAA6B;IACzB,IAAIF,IAAI,CAACE,IAAL,CAAUG,QAAV,CAAmB,GAAnB,KAA2BL,IAAI,CAACE,IAAL,CAAUG,QAAV,CAAmB,IAAnB,CAA/B,EAAyD;MACrD,MAAM,yBAAW,MAAX,EAAmB;QACrBH,IAAI,EAAEF,IAAI,CAACE;MADU,CAAnB,CAAN;IAGH;EACJ;AACJ;;AAID,IAAMI,0BAA0B,GAAG,uBAAnC;AACA,IAAMC,uBAAuB,GAAG,IAAIC,MAAJ,CAAWF,0BAAX,CAAhC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASH,oBAAT,CAA8BD,IAA9B,EAAkD;EACrD,IACI,OAAOA,IAAP,KAAgB,QAAhB,IACAA,IAAI,CAACO,MAAL,KAAgB,CAFpB,EAGE;IACE,MAAM,6BAAe,KAAf,EAAsB;MACxBP,IAAI,EAAJA;IADwB,CAAtB,CAAN;EAGH,CARoD,CAWrD;;;EACA,IAAI,wBAAaA,IAAb,CAAJ,EAAwB;IACpB,OAAO,IAAP;EACH;;EAED,IAAI,CAACA,IAAI,CAACQ,KAAL,CAAWH,uBAAX,CAAL,EAA0C;IACtC,MAAM,yBAAW,KAAX,EAAkB;MACpBI,KAAK,EAAEL,0BADa;MAEpBM,SAAS,EAAEV;IAFS,CAAlB,CAAN;EAIH;;EAED,OAAO,IAAP;AACH"}