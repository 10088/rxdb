{"version":3,"sources":["../../../../src/plugins/migration/migration-state.ts"],"names":["DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE","WeakMap","getMigrationStateByDatabase","database","has","set","BehaviorSubject","subject","get","onDatabaseDestroy","complete"],"mappings":";;;;;;;;;AAAA;;AASA;;AAOO,IAAMA,wCAAwC,GAAG,IAAIC,OAAJ,EAAjD;;;AAEA,SAASC,2BAAT,CAAqCC,QAArC,EAAwH;AAC3H,MAAI,CAACH,wCAAwC,CAACI,GAAzC,CAA6CD,QAA7C,CAAL,EAA6D;AACzDH,IAAAA,wCAAwC,CAACK,GAAzC,CACIF,QADJ,EAEI,IAAIG,qBAAJ,CAAgE,EAAhE,CAFJ;AAIH;;AACD,MAAMC,OAAO,GAAGP,wCAAwC,CAACQ,GAAzC,CAA6CL,QAA7C,CAAhB;AACA,SAAO,0BAAeI,OAAf,CAAP;AACH;AAED;AACA;AACA;AACA;;;AACO,SAASE,iBAAT,CAA2BN,QAA3B,EAAiD;AACpD,MAAMI,OAAO,GAAGP,wCAAwC,CAACQ,GAAzC,CAA6CL,QAA7C,CAAhB;;AACA,MAAII,OAAJ,EAAa;AACTA,IAAAA,OAAO,CAACG,QAAR;AACH;AACJ","sourcesContent":["import {\n    BehaviorSubject,\n    Observable\n} from 'rxjs';\nimport type {\n    MigrationState,\n    RxCollection,\n    RxDatabase\n} from '../../types';\nimport { ensureNotFalsy } from '../../util';\n\nexport type MigrationStateWithCollection = {\n    collection: RxCollection;\n    state: MigrationState;\n};\n\nexport const DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE = new WeakMap<RxDatabase, BehaviorSubject<Observable<MigrationStateWithCollection>[]>>();\n\nexport function getMigrationStateByDatabase(database: RxDatabase): BehaviorSubject<Observable<MigrationStateWithCollection>[]> {\n    if (!DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.has(database)) {\n        DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.set(\n            database,\n            new BehaviorSubject<Observable<MigrationStateWithCollection>[]>([])\n        );\n    }\n    const subject = DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.get(database);\n    return ensureNotFalsy(subject);\n}\n\n/**\n * Complete on database destroy\n * so people do not have to unsubscribe\n */\nexport function onDatabaseDestroy(database: RxDatabase) {\n    const subject = DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.get(database);\n    if (subject) {\n        subject.complete();\n    }\n}\n"],"file":"migration-state.js"}