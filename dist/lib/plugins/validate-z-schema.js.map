{"version":3,"file":"validate-z-schema.js","names":["getValidator","schema","validatorInstance","ZSchema","validator","obj","validate","docData","useValidator","errors","getLastErrors","formattedZSchemaErrors","map","title","description","message","newRxError","document","wrappedValidateZSchemaStorage","wrappedValidateStorageFactory"],"sources":["../../../src/plugins/validate-z-schema.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using z-schema as jsonschema-validator\n * @link https://github.com/zaggino/z-schema\n */\nimport ZSchema from 'z-schema';\nimport {\n    newRxError\n} from '../rx-error';\nimport type { RxJsonSchema } from '../types';\nimport { wrappedValidateStorageFactory } from '../plugin-helpers';\n\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validatorInstance = new (ZSchema as any)();\n    const validator = (obj: any) => {\n        validatorInstance.validate(obj, schema);\n        return validatorInstance;\n    };\n    return (docData: any) => {\n        const useValidator = validator(docData);\n        if (useValidator === true) {\n            return;\n        }\n        const errors: ZSchema.SchemaErrorDetail[] = (useValidator as any).getLastErrors();\n        if (errors) {\n            const formattedZSchemaErrors = (errors as any).map(({\n                title,\n                description,\n                message\n            }: any) => ({\n                title,\n                description,\n                message\n            }));\n            throw newRxError('VD2', {\n                errors: formattedZSchemaErrors,\n                document: docData,\n                schema\n            });\n        }\n    };\n}\n\nexport const wrappedValidateZSchemaStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'z-schema'\n);\n"],"mappings":";;;;;;;;AAKA;AACA;AAIA;AAVA;AACA;AACA;AACA;AACA;;AASO,SAASA,YAAY,CACxBC,MAAyB,EAC3B;EACE,IAAMC,iBAAiB,GAAG,IAAKC,mBAAO,EAAU;EAChD,IAAMC,SAAS,GAAG,SAAZA,SAAS,CAAIC,GAAQ,EAAK;IAC5BH,iBAAiB,CAACI,QAAQ,CAACD,GAAG,EAAEJ,MAAM,CAAC;IACvC,OAAOC,iBAAiB;EAC5B,CAAC;EACD,OAAO,UAACK,OAAY,EAAK;IACrB,IAAMC,YAAY,GAAGJ,SAAS,CAACG,OAAO,CAAC;IACvC,IAAIC,YAAY,KAAK,IAAI,EAAE;MACvB;IACJ;IACA,IAAMC,MAAmC,GAAID,YAAY,CAASE,aAAa,EAAE;IACjF,IAAID,MAAM,EAAE;MACR,IAAME,sBAAsB,GAAIF,MAAM,CAASG,GAAG,CAAC;QAAA,IAC/CC,KAAK,QAALA,KAAK;UACLC,WAAW,QAAXA,WAAW;UACXC,OAAO,QAAPA,OAAO;QAAA,OACC;UACRF,KAAK,EAALA,KAAK;UACLC,WAAW,EAAXA,WAAW;UACXC,OAAO,EAAPA;QACJ,CAAC;MAAA,CAAC,CAAC;MACH,MAAM,IAAAC,mBAAU,EAAC,KAAK,EAAE;QACpBP,MAAM,EAAEE,sBAAsB;QAC9BM,QAAQ,EAAEV,OAAO;QACjBN,MAAM,EAANA;MACJ,CAAC,CAAC;IACN;EACJ,CAAC;AACL;AAEO,IAAMiB,6BAA6B,GAAG,IAAAC,4CAA6B,EACtEnB,YAAY,EACZ,UAAU,CACb;AAAC"}