{"version":3,"sources":["../../../../../src/plugins/query-builder/mquery/nosql-query-builder.ts"],"names":[],"mappings":"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","file":"nosql-query-builder.js","sourcesContent":["/**\n * this is based on\n * @link https://github.com/aheckmann/mquery/blob/master/lib/mquery.js\n */\nimport {\n    isObject,\n    merge\n} from './mquery-utils';\nimport {\n    newRxTypeError,\n    newRxError\n} from '../../../rx-error';\nimport type {\n    MangoQuery,\n    MangoQuerySelector,\n    MangoQuerySortPart,\n    MangoQuerySortDirection\n} from '../../../types';\n\n\ndeclare type MQueryOptions = {\n    limit?: number;\n    skip?: number;\n    sort?: any;\n};\n\nexport class NoSqlQueryBuilderClass<DocType> {\n\n    public options: MQueryOptions = {};\n    public _conditions: MangoQuerySelector<DocType> = {};\n    public _fields: any = {};\n    public _path?: any;\n    private _distinct: any;\n\n    /**\n     * MQuery constructor used for building queries.\n     *\n     * ####Example:\n     *     var query = new MQuery({ name: 'mquery' });\n     *     query.where('age').gte(21).exec(callback);\n     *\n     */\n    constructor(\n        mangoQuery?: MangoQuery<DocType>\n    ) {\n        if (mangoQuery) {\n            const queryBuilder: NoSqlQueryBuilder<DocType> = this as any;\n\n            if (mangoQuery.selector) {\n                queryBuilder.find(mangoQuery.selector);\n            }\n            if (mangoQuery.limit) {\n                queryBuilder.limit(mangoQuery.limit);\n            }\n            if (mangoQuery.skip) {\n                queryBuilder.skip(mangoQuery.skip);\n            }\n            if (mangoQuery.sort) {\n                mangoQuery.sort.forEach(s => queryBuilder.sort(s));\n            }\n        }\n    }\n\n    /**\n     * Specifies a `path` for use with chaining.\n     */\n    where(_path: string, _val?: MangoQuerySelector<DocType>): NoSqlQueryBuilder<DocType> {\n        if (!arguments.length) return this as any;\n        const type = typeof arguments[0];\n        if ('string' === type) {\n            this._path = arguments[0];\n            if (2 === arguments.length) {\n                this._conditions[this._path] = arguments[1];\n            }\n            return this as any;\n        }\n\n        if ('object' === type && !Array.isArray(arguments[0])) {\n            return this.merge(arguments[0]);\n        }\n\n        throw newRxTypeError('MQ1', {\n            path: arguments[0]\n        });\n    }\n\n    /**\n     * Specifies the complementary comparison value for paths specified with `where()`\n     * ####Example\n     *     User.where('age').equals(49);\n     */\n    equals(val: any): NoSqlQueryBuilder<DocType> {\n        this._ensurePath('equals');\n        const path = this._path;\n        this._conditions[path] = val;\n        return this as any;\n    }\n\n    /**\n     * Specifies the complementary comparison value for paths specified with `where()`\n     * This is alias of `equals`\n     */\n    eq(val: any): NoSqlQueryBuilder<DocType> {\n        this._ensurePath('eq');\n        const path = this._path;\n        this._conditions[path] = val;\n        return this as any;\n    }\n\n    /**\n     * Specifies arguments for an `$or` condition.\n     * ####Example\n     *     query.or([{ color: 'red' }, { status: 'emergency' }])\n     */\n    or(array: any[]): NoSqlQueryBuilder<DocType> {\n        const or = this._conditions.$or || (this._conditions.$or = []);\n        if (!Array.isArray(array)) array = [array];\n        or.push.apply(or, array);\n        return this as any;\n    }\n\n    /**\n     * Specifies arguments for a `$nor` condition.\n     * ####Example\n     *     query.nor([{ color: 'green' }, { status: 'ok' }])\n     */\n    nor(array: any[]): NoSqlQueryBuilder<DocType> {\n        const nor = this._conditions.$nor || (this._conditions.$nor = []);\n        if (!Array.isArray(array)) array = [array];\n        nor.push.apply(nor, array);\n        return this as any;\n    }\n\n    /**\n     * Specifies arguments for a `$and` condition.\n     * ####Example\n     *     query.and([{ color: 'green' }, { status: 'ok' }])\n     * @see $and http://docs.mongodb.org/manual/reference/operator/and/\n     */\n    and(array: any[]): NoSqlQueryBuilder<DocType> {\n        const and = this._conditions.$and || (this._conditions.$and = []);\n        if (!Array.isArray(array)) array = [array];\n        and.push.apply(and, array);\n        return this as any;\n    }\n\n    /**\n     * Specifies a `$mod` condition\n     */\n    mod(_path: string, _val: number): NoSqlQueryBuilder<DocType> {\n        let val;\n        let path;\n\n        if (1 === arguments.length) {\n            this._ensurePath('mod');\n            val = arguments[0];\n            path = this._path;\n        } else if (2 === arguments.length && !Array.isArray(arguments[1])) {\n            this._ensurePath('mod');\n            val = (arguments as any).slice();\n            path = this._path;\n        } else if (3 === arguments.length) {\n            val = (arguments as any).slice(1);\n            path = arguments[0];\n        } else {\n            val = arguments[1];\n            path = arguments[0];\n        }\n\n        const conds = this._conditions[path] || (this._conditions[path] = {});\n        conds.$mod = val;\n        return this as any;\n    }\n\n    /**\n     * Specifies an `$exists` condition\n     * ####Example\n     *     // { name: { $exists: true }}\n     *     Thing.where('name').exists()\n     *     Thing.where('name').exists(true)\n     *     Thing.find().exists('name')\n     */\n    exists(_path: string, _val: number): NoSqlQueryBuilder<DocType> {\n        let path;\n        let val;\n        if (0 === arguments.length) {\n            this._ensurePath('exists');\n            path = this._path;\n            val = true;\n        } else if (1 === arguments.length) {\n            if ('boolean' === typeof arguments[0]) {\n                this._ensurePath('exists');\n                path = this._path;\n                val = arguments[0];\n            } else {\n                path = arguments[0];\n                val = true;\n            }\n        } else if (2 === arguments.length) {\n            path = arguments[0];\n            val = arguments[1];\n        }\n\n        const conds = this._conditions[path] || (this._conditions[path] = {});\n        conds.$exists = val;\n        return this as any;\n    }\n\n    /**\n     * Specifies an `$elemMatch` condition\n     * ####Example\n     *     query.elemMatch('comment', { author: 'autobot', votes: {$gte: 5}})\n     *     query.where('comment').elemMatch({ author: 'autobot', votes: {$gte: 5}})\n     *     query.elemMatch('comment', function (elem) {\n     *       elem.where('author').equals('autobot');\n     *       elem.where('votes').gte(5);\n     *     })\n     *     query.where('comment').elemMatch(function (elem) {\n     *       elem.where({ author: 'autobot' });\n     *       elem.where('votes').gte(5);\n     *     })\n     */\n    elemMatch(_path: string, _criteria: any): NoSqlQueryBuilder<DocType> {\n        if (null === arguments[0])\n            throw newRxTypeError('MQ2');\n\n        let fn;\n        let path;\n        let criteria;\n\n        if ('function' === typeof arguments[0]) {\n            this._ensurePath('elemMatch');\n            path = this._path;\n            fn = arguments[0];\n        } else if (isObject(arguments[0])) {\n            this._ensurePath('elemMatch');\n            path = this._path;\n            criteria = arguments[0];\n        } else if ('function' === typeof arguments[1]) {\n            path = arguments[0];\n            fn = arguments[1];\n        } else if (arguments[1] && isObject(arguments[1])) {\n            path = arguments[0];\n            criteria = arguments[1];\n        } else\n            throw newRxTypeError('MQ2');\n\n        if (fn) {\n            criteria = new NoSqlQueryBuilderClass;\n            fn(criteria);\n            criteria = criteria._conditions;\n        }\n\n        const conds = this._conditions[path] || (this._conditions[path] = {});\n        conds.$elemMatch = criteria;\n        return this as any;\n    }\n\n    /**\n     * Sets the sort order\n     * If an object is passed, values allowed are 'asc', 'desc', 'ascending', 'descending', 1, and -1.\n     * If a string is passed, it must be a space delimited list of path names.\n     * The sort order of each path is ascending unless the path name is prefixed with `-` which will be treated as descending.\n     * ####Example\n     *     query.sort({ field: 'asc', test: -1 });\n     *     query.sort('field -test');\n     *     query.sort([['field', 1], ['test', -1]]);\n     */\n    sort(arg: any): NoSqlQueryBuilder<DocType> {\n        if (!arg) return this as any;\n        let len;\n        const type = typeof arg;\n        // .sort([['field', 1], ['test', -1]])\n        if (Array.isArray(arg)) {\n            len = arg.length;\n            for (let i = 0; i < arg.length; ++i) {\n                _pushArr(this.options, arg[i][0], arg[i][1]);\n            }\n\n            return this as any;\n        }\n\n        // .sort('field -test')\n        if (1 === arguments.length && 'string' === type) {\n            arg = arg.split(/\\s+/);\n            len = arg.length;\n            for (let i = 0; i < len; ++i) {\n                let field = arg[i];\n                if (!field) continue;\n                const ascend = '-' === field[0] ? -1 : 1;\n                if (ascend === -1) field = field.substring(1);\n                push(this.options, field, ascend);\n            }\n\n            return this as any;\n        }\n\n        // .sort({ field: 1, test: -1 })\n        if (isObject(arg)) {\n            const keys = Object.keys(arg);\n            keys.forEach(field => push(this.options, field, arg[field]));\n            return this as any;\n        }\n\n        throw newRxTypeError('MQ3', {\n            args: arguments\n        });\n    }\n\n    /**\n     * Merges another MQuery or conditions object into this one.\n     *\n     * When a MQuery is passed, conditions, field selection and options are merged.\n     *\n     */\n    merge(source: any): NoSqlQueryBuilder<DocType> {\n        if (!source) {\n            return this as any;\n        }\n\n        if (!canMerge(source)) {\n            throw newRxTypeError('MQ4', {\n                source\n            });\n        }\n\n        if (source instanceof NoSqlQueryBuilderClass) {\n            // if source has a feature, apply it to ourselves\n\n            if (source._conditions)\n                merge(this._conditions, source._conditions);\n\n            if (source._fields) {\n                if (!this._fields) this._fields = {};\n                merge(this._fields, source._fields);\n            }\n\n            if (source.options) {\n                if (!this.options) this.options = {};\n                merge(this.options, source.options);\n            }\n\n            if (source._distinct)\n                this._distinct = source._distinct;\n\n            return this as any;\n        }\n\n        // plain object\n        merge(this._conditions, source);\n\n        return this as any;\n    }\n\n    /**\n     * Finds documents.\n     * ####Example\n     *     query.find()\n     *     query.find({ name: 'Burning Lights' })\n     */\n    find(criteria: any): NoSqlQueryBuilder<DocType> {\n        if (canMerge(criteria)) {\n            this.merge(criteria);\n        }\n\n        return this as any;\n    }\n\n    /**\n     * Make sure _path is set.\n     *\n     * @parmam {String} method\n     */\n    _ensurePath(method: any) {\n        if (!this._path) {\n            throw newRxError('MQ5', {\n                method\n            });\n        }\n    }\n\n    toJSON(): {\n        query: MangoQuery<DocType>,\n        path?: string\n    } {\n        const query: MangoQuery<DocType> = {\n            selector: this._conditions,\n        };\n\n        if (this.options.skip) {\n            query.skip = this.options.skip;\n        }\n        if (this.options.limit) {\n            query.limit = this.options.limit;\n        }\n        if (this.options.sort) {\n            query.sort = mQuerySortToRxDBSort(this.options.sort);\n        }\n\n        return {\n            query,\n            path: this._path\n        };\n    }\n}\n\nexport function mQuerySortToRxDBSort<DocType>(\n    sort: { [k: string]: 1 | -1 }\n): MangoQuerySortPart<DocType>[] {\n    return Object.entries(sort).map(([k, v]) => {\n        const direction: MangoQuerySortDirection = v === 1 ? 'asc' : 'desc';\n        const part: MangoQuerySortPart<DocType> = { [k]: direction } as any;\n        return part;\n    });\n}\n\n/**\n * Because some prototype-methods are generated,\n * we have to define the type of NoSqlQueryBuilder here\n */\n\nexport interface NoSqlQueryBuilder<DocType = any> extends NoSqlQueryBuilderClass<DocType> {\n    maxScan: ReturnSelfNumberFunction<DocType>;\n    batchSize: ReturnSelfNumberFunction<DocType>;\n    limit: ReturnSelfNumberFunction<DocType>;\n    skip: ReturnSelfNumberFunction<DocType>;\n    comment: ReturnSelfFunction<DocType>;\n\n    gt: ReturnSelfFunction<DocType>;\n    gte: ReturnSelfFunction<DocType>;\n    lt: ReturnSelfFunction<DocType>;\n    lte: ReturnSelfFunction<DocType>;\n    ne: ReturnSelfFunction<DocType>;\n    in: ReturnSelfFunction<DocType>;\n    nin: ReturnSelfFunction<DocType>;\n    all: ReturnSelfFunction<DocType>;\n    regex: ReturnSelfFunction<DocType>;\n    size: ReturnSelfFunction<DocType>;\n\n}\n\ndeclare type ReturnSelfFunction<DocType> = (v: any) => NoSqlQueryBuilder<DocType>;\ndeclare type ReturnSelfNumberFunction<DocType> = (v: number | null) => NoSqlQueryBuilder<DocType>;\n\n/**\n * limit, skip, maxScan, batchSize, comment\n *\n * Sets these associated options.\n *\n *     query.comment('feed query');\n */\nexport const OTHER_MANGO_ATTRIBUTES = ['limit', 'skip', 'maxScan', 'batchSize', 'comment'];\nOTHER_MANGO_ATTRIBUTES.forEach(function (method) {\n    (NoSqlQueryBuilderClass.prototype as any)[method] = function (v: any) {\n        this.options[method] = v;\n        return this;\n    };\n});\n\n\n/**\n * gt, gte, lt, lte, ne, in, nin, all, regex, size, maxDistance\n *\n *     Thing.where('type').nin(array)\n */\nexport const OTHER_MANGO_OPERATORS = [\n    'gt', 'gte', 'lt', 'lte', 'ne',\n    'in', 'nin', 'all', 'regex', 'size'\n];\nOTHER_MANGO_OPERATORS.forEach(function ($conditional) {\n    (NoSqlQueryBuilderClass.prototype as any)[$conditional] = function () {\n        let path;\n        let val;\n        if (1 === arguments.length) {\n            this._ensurePath($conditional);\n            val = arguments[0];\n            path = this._path;\n        } else {\n            val = arguments[1];\n            path = arguments[0];\n        }\n\n        const conds = this._conditions[path] === null || typeof this._conditions[path] === 'object' ?\n            this._conditions[path] :\n            (this._conditions[path] = {});\n        conds['$' + $conditional] = val;\n        return this;\n    };\n});\n\n\nfunction push(opts: any, field: string, value: any) {\n    if (Array.isArray(opts.sort)) {\n        throw newRxTypeError('MQ6', {\n            opts,\n            field,\n            value\n        });\n    }\n\n    if (value && value.$meta) {\n        const sort = opts.sort || (opts.sort = {});\n        sort[field] = {\n            $meta: value.$meta\n        };\n        return;\n    }\n\n    const val = String(value || 1).toLowerCase();\n    if (!/^(?:ascending|asc|descending|desc|1|-1)$/.test(val)) {\n        if (Array.isArray(value)) value = '[' + value + ']';\n        throw newRxTypeError('MQ7', {\n            field,\n            value\n        });\n    }\n    // store `sort` in a sane format\n    const s = opts.sort || (opts.sort = {});\n    const valueStr = value.toString()\n        .replace('asc', '1')\n        .replace('ascending', '1')\n        .replace('desc', '-1')\n        .replace('descending', '-1');\n    s[field] = parseInt(valueStr, 10);\n}\n\nfunction _pushArr(opts: any, field: string, value: any) {\n    opts.sort = opts.sort || [];\n    if (!Array.isArray(opts.sort)) {\n        throw newRxTypeError('MQ8', {\n            opts,\n            field,\n            value\n        });\n    }\n\n    /*    const valueStr = value.toString()\n            .replace('asc', '1')\n            .replace('ascending', '1')\n            .replace('desc', '-1')\n            .replace('descending', '-1');*/\n    opts.sort.push([field, value]);\n}\n\n\n/**\n * Determines if `conds` can be merged using `mquery().merge()`\n */\nexport function canMerge(conds: any): boolean {\n    return conds instanceof NoSqlQueryBuilderClass || isObject(conds);\n}\n\n\nexport function createQueryBuilder<DocType>(query?: MangoQuery<DocType>): NoSqlQueryBuilder<DocType> {\n    return new NoSqlQueryBuilderClass(query) as NoSqlQueryBuilder<DocType>;\n}\n"]}