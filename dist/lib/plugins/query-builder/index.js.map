{"version":3,"file":"index.js","names":["RXQUERY_OTHER_FLAG","runBuildingStep","rxQuery","functionName","value","queryBuilder","mangoQuery","other","_path","queryBuilderJson","toJSON","newQuery","RxQueryBase","op","query","collection","path","tunneled","applyBuildingStep","proto","RxDBQueryBuilderPlugin","name","rxdb","prototypes","RxQuery","forEach","attribute","OTHER_MANGO_ATTRIBUTES","OTHER_MANGO_OPERATORS","operator"],"sources":["../../../../src/plugins/query-builder/index.ts"],"sourcesContent":["import {\n    createQueryBuilder,\n    OTHER_MANGO_ATTRIBUTES,\n    OTHER_MANGO_OPERATORS\n} from './mquery/nosql-query-builder';\nimport type { RxPlugin, RxQuery } from '../../types';\nimport { RxQueryBase, tunnelQueryCache } from '../../rx-query';\nimport { clone } from '../../util';\n\n// if the query-builder plugin is used, we have to save it's last path\nconst RXQUERY_OTHER_FLAG = 'queryBuilderPath';\n\nexport function runBuildingStep<RxDocumentType, RxQueryResult>(\n    rxQuery: RxQuery<RxDocumentType, RxQueryResult>,\n    functionName: string,\n    value: any\n): RxQuery<RxDocumentType, RxQueryResult> {\n    const queryBuilder = createQueryBuilder(clone(rxQuery.mangoQuery));\n    if (rxQuery.other[RXQUERY_OTHER_FLAG]) {\n        queryBuilder._path = rxQuery.other[RXQUERY_OTHER_FLAG];\n    }\n\n    (queryBuilder as any)[functionName](value); // run\n\n    const queryBuilderJson = queryBuilder.toJSON();\n    const newQuery = new RxQueryBase(\n        rxQuery.op,\n        queryBuilderJson.query,\n        rxQuery.collection\n    ) as RxQuery;\n    if (queryBuilderJson.path) {\n        newQuery.other[RXQUERY_OTHER_FLAG] = queryBuilderJson.path;\n    }\n\n    const tunneled = tunnelQueryCache(newQuery);\n    return tunneled;\n}\n\nexport function applyBuildingStep(\n    proto: any,\n    functionName: string\n): void {\n    proto[functionName] = function (this: RxQuery, value: any) {\n        return runBuildingStep(this, functionName, value);\n    };\n}\n\nexport * from './mquery/nosql-query-builder';\n\nexport const RxDBQueryBuilderPlugin: RxPlugin = {\n    name: 'query-builder',\n    rxdb: true,\n    prototypes: {\n        RxQuery(proto: any) {\n            [\n                'where',\n                'equals',\n                'eq',\n                'or',\n                'nor',\n                'and',\n                'mod',\n                'exists',\n                'elemMatch',\n                'sort'\n            ].forEach(attribute => {\n                applyBuildingStep(proto, attribute);\n            });\n            OTHER_MANGO_ATTRIBUTES.forEach(attribute => {\n                applyBuildingStep(proto, attribute);\n            });\n            OTHER_MANGO_OPERATORS.forEach(operator => {\n                applyBuildingStep(proto, operator);\n            });\n        }\n    }\n};\n"],"mappings":";;;;;;;;;;;;;;AAAA;;AA+CA;EAAA;EAAA;EAAA;EAAA;IAAA;IAAA;MAAA;IAAA;EAAA;AAAA;;AAzCA;;AACA;;AAEA;AACA,IAAMA,kBAAkB,GAAG,kBAA3B;;AAEO,SAASC,eAAT,CACHC,OADG,EAEHC,YAFG,EAGHC,KAHG,EAImC;EACtC,IAAMC,YAAY,GAAG,2CAAmB,iBAAMH,OAAO,CAACI,UAAd,CAAnB,CAArB;;EACA,IAAIJ,OAAO,CAACK,KAAR,CAAcP,kBAAd,CAAJ,EAAuC;IACnCK,YAAY,CAACG,KAAb,GAAqBN,OAAO,CAACK,KAAR,CAAcP,kBAAd,CAArB;EACH;;EAEAK,YAAD,CAAsBF,YAAtB,EAAoCC,KAApC,EANsC,CAMM;;EAE5C,IAAMK,gBAAgB,GAAGJ,YAAY,CAACK,MAAb,EAAzB;EACA,IAAMC,QAAQ,GAAG,IAAIC,oBAAJ,CACbV,OAAO,CAACW,EADK,EAEbJ,gBAAgB,CAACK,KAFJ,EAGbZ,OAAO,CAACa,UAHK,CAAjB;;EAKA,IAAIN,gBAAgB,CAACO,IAArB,EAA2B;IACvBL,QAAQ,CAACJ,KAAT,CAAeP,kBAAf,IAAqCS,gBAAgB,CAACO,IAAtD;EACH;;EAED,IAAMC,QAAQ,GAAG,+BAAiBN,QAAjB,CAAjB;EACA,OAAOM,QAAP;AACH;;AAEM,SAASC,iBAAT,CACHC,KADG,EAEHhB,YAFG,EAGC;EACJgB,KAAK,CAAChB,YAAD,CAAL,GAAsB,UAAyBC,KAAzB,EAAqC;IACvD,OAAOH,eAAe,CAAC,IAAD,EAAOE,YAAP,EAAqBC,KAArB,CAAtB;EACH,CAFD;AAGH;;AAIM,IAAMgB,sBAAgC,GAAG;EAC5CC,IAAI,EAAE,eADsC;EAE5CC,IAAI,EAAE,IAFsC;EAG5CC,UAAU,EAAE;IACRC,OADQ,mBACAL,KADA,EACY;MAChB,CACI,OADJ,EAEI,QAFJ,EAGI,IAHJ,EAII,IAJJ,EAKI,KALJ,EAMI,KANJ,EAOI,KAPJ,EAQI,QARJ,EASI,WATJ,EAUI,MAVJ,EAWEM,OAXF,CAWU,UAAAC,SAAS,EAAI;QACnBR,iBAAiB,CAACC,KAAD,EAAQO,SAAR,CAAjB;MACH,CAbD;;MAcAC,0CAAuBF,OAAvB,CAA+B,UAAAC,SAAS,EAAI;QACxCR,iBAAiB,CAACC,KAAD,EAAQO,SAAR,CAAjB;MACH,CAFD;;MAGAE,yCAAsBH,OAAtB,CAA8B,UAAAI,QAAQ,EAAI;QACtCX,iBAAiB,CAACC,KAAD,EAAQU,QAAR,CAAjB;MACH,CAFD;IAGH;EAtBO;AAHgC,CAAzC"}