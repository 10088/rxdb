{"version":3,"sources":["../../../../src/plugins/pouchdb/pouch-db.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAMA;;AAGA;;AAYA;;AAOA;;AA5BA;AACA;AACA;AACA;AACA;AACA;AAGA;;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AAWA,cAAc,CAAC,uBAAD,CAAd;AACA;AAGA;AACA;AACA;AACA;;AACO,SAAS,WAAT,CAAqB,OAArB,EAAmC;AACtC,MAAI,CAAC,OAAD,IAAY,OAAO,OAAO,CAAC,MAAf,KAA0B,UAA1C,EAAsD;AAClD,UAAM,yBAAW,KAAX,EAAkB;AACpB,MAAA,OAAO,EAAP;AADoB,KAAlB,CAAN;AAGH;AACJ;AAED;AACA;AACA;;;AACO,SAAS,wBAAT,CACH,KADG,QAMA;AAAA,uBAHC,IAGD;AAAA,MAHC,IAGD,0BAHQ,IAGR;AAAA,uBAFC,IAED;AAAA,MAFC,IAED,0BAFQ,IAER;AACH,MAAI,IAAI,IAAI,IAAZ,EAAkB,OAAO,KAAK,CAAC,IAAN,CAAW,IAAX,CAAgB,KAAhB,CAAP;AAClB,MAAI,CAAC,IAAD,IAAS,IAAb,EAAmB,OAAQ,KAAK,CAAC,SAAP,CAAyB,EAAzB,CAA4B,IAA5B,CAAiC,KAAjC,CAAP;AACnB,MAAI,IAAI,IAAI,CAAC,IAAb,EAAmB,OAAQ,KAAK,CAAC,SAAP,CAAyB,IAAzB,CAA8B,IAA9B,CAAmC,KAAnC,CAAP;;AACnB,MAAI,CAAC,IAAD,IAAS,CAAC,IAAd,EAAoB;AAChB,UAAM,yBAAW,KAAX,EAAkB;AACpB,MAAA,IAAI,EAAJ,IADoB;AAEpB,MAAA,IAAI,EAAJ;AAFoB,KAAlB,CAAN;AAIH;AACJ;;AAEM,SAAS,YAAT,CAAsB,GAAtB,EAAgC;AACnC,SAAO,GAAG,YAAY,uBAAtB;AACH;AAGD;AACA;AACA;;;AACO,SAAS,cAAT,CAAwB,MAAxB,EAAqC;AACxC,MAAI,MAAM,CAAC,IAAX,EAAiB;AACb,UAAM,6BAAe,KAAf,EAAsB;AACxB,MAAA,MAAM,EAAN;AADwB,KAAtB,CAAN;AAGH;AACD;AACJ;AACA;AACA;AACA;;;AACI,MAAI,OAAO,MAAP,KAAkB,QAAlB,IAA8B,MAAM,WAAxC,EAAkD;AAC9C,IAAA,MAAM,GAAG,MAAM,WAAf;AACH;;AACD,0BAAY,MAAZ,CAAmB,MAAnB;AACH;;AAGM,IAAM,OAAY,GAAG,uBAArB","file":"pouch-db.js","sourcesContent":["/**\n * this handles the pouchdb-instance\n * to easy add modules and manipulate things\n * Adapters can be found here:\n * @link https://github.com/pouchdb/pouchdb/tree/master/packages/node_modules\n */\nimport PouchDBCore from 'pouchdb-core';\n\n// pouchdb-find\nimport PouchDBFind from 'pouchdb-find';\n\n/*\n// comment in to debug\nconst pouchdbDebug = require('pouchdb-debug');\nPouchDB.plugin(pouchdbDebug);\nPouchDB.debug.enable('*');\n*/\n\n\n// TODO we can delete most of these functions in the file because it was migrated to rx-storage-pouchdb\n\nimport {\n    newRxError,\n    newRxTypeError\n} from '../../rx-error';\nimport type {\n    PouchDBInstance\n} from '../../types';\nimport { addCustomEventsPluginToPouch } from './custom-events-plugin';\n\naddPouchPlugin(PouchDBFind);\naddCustomEventsPluginToPouch();\n\n\n/**\n * check if the given module is a leveldown-adapter\n * throws if not\n */\nexport function isLevelDown(adapter: any) {\n    if (!adapter || typeof adapter.super_ !== 'function') {\n        throw newRxError('UT4', {\n            adapter\n        });\n    }\n}\n\n/**\n * get the correct function-name for pouchdb-replication\n */\nexport function pouchReplicationFunction(\n    pouch: PouchDBInstance,\n    {\n        pull = true,\n        push = true\n    }\n): any {\n    if (pull && push) return pouch.sync.bind(pouch);\n    if (!pull && push) return (pouch.replicate as any).to.bind(pouch);\n    if (pull && !push) return (pouch.replicate as any).from.bind(pouch);\n    if (!pull && !push) {\n        throw newRxError('UT3', {\n            pull,\n            push\n        });\n    }\n}\n\nexport function isInstanceOf(obj: any) {\n    return obj instanceof PouchDBCore;\n}\n\n\n/**\n * Add a pouchdb plugin to the pouchdb library.\n */\nexport function addPouchPlugin(plugin: any) {\n    if (plugin.rxdb) {\n        throw newRxTypeError('PL2', {\n            plugin\n        });\n    }\n    /**\n     * Pouchdb has confusing typings and modules.\n     * So we monkeypatch the plugin to use the default property\n     * when it was imported or packaged this way.\n     */\n    if (typeof plugin === 'object' && plugin.default) {\n        plugin = plugin.default;\n    }\n    PouchDBCore.plugin(plugin);\n}\n\n\nexport const PouchDB: any = PouchDBCore as any;\n"]}