{"version":3,"sources":["../../src/util.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AAyDA;;AAgSA;;AArVA;AACA;AACA;AACA;AACA;AACO,SAAS,aAAT,CACH,SADG,EAEE;AACL,MAAM,QAAQ,GAAG,SAAS,CAAC,KAAV,CAAgB,GAAhB,CAAjB;AACA,MAAI,UAAU,GAAG,MAAjB;AACA,EAAA,QAAQ,CAAC,OAAT,CAAiB,UAAA,IAAI,EAAI;AACrB,IAAA,UAAU,IAAI,OAAO,CAAC,IAAD,CAArB;AACH,GAFD;AAGA,EAAA,UAAU,IAAI,QAAd;AACA,SAAO,IAAI,KAAJ,iLAGY,UAHZ,8BAG+C,SAH/C,oCAIe,UAJf,kBAAP;AAOH;AAED;AACA;AACA;AACA;AACA;;;AACO,SAAS,gBAAT,CAA0B,GAA1B,EAA4C;AAC/C,MAAI,OAAO,GAAP,KAAe,QAAnB,EAA6B,GAAG,GAAG,IAAI,CAAC,SAAL,CAAe,GAAf,CAAN;AAC7B,MAAI,SAAS,GAAG,CAAhB;AAAA,MACI,CADJ;AAAA,MACO,GADP;AAAA,MACY,GADZ;AAEA,MAAI,GAAG,CAAC,MAAJ,KAAe,CAAnB,EAAsB,OAAO,SAAP;;AACtB,OAAK,CAAC,GAAG,CAAJ,EAAO,GAAG,GAAG,GAAG,CAAC,MAAtB,EAA8B,CAAC,GAAG,GAAlC,EAAuC,CAAC,EAAxC,EAA4C;AACxC,IAAA,GAAG,GAAG,GAAG,CAAC,UAAJ,CAAe,CAAf,CAAN,CADwC,CAExC;;AACA,IAAA,SAAS,GAAI,CAAC,SAAS,IAAI,CAAd,IAAmB,SAApB,GAAiC,GAA7C,CAHwC,CAIxC;;AACA,IAAA,SAAS,IAAI,CAAb,CALwC,CAKxB;AACnB;;AACD,MAAI,SAAS,GAAG,CAAhB,EAAmB,SAAS,GAAG,SAAS,GAAG,CAAC,CAAzB;AACnB,SAAO,SAAP;AACH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEO,IAAM,cAAc,GAAG,yBAAvB;;;AACA,SAAS,IAAT,CAAc,GAAd,EAAyC;AAC5C,MAAI,OAAO,GAAP,KAAe,QAAnB,EAA6B;AACzB,IAAA,GAAG,GAAG,IAAI,CAAC,SAAL,CAAe,GAAf,CAAN;AACH;;AACD,SAAO,oBAAI,IAAJ,CAAS,cAAc,GAAG,GAA1B,CAAP;AACH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAI,QAAgB,GAAG,CAAvB;AACA;AACA;AACA;AACA;;AACO,SAAS,GAAT,GAAuB;AAC1B,MAAI,GAAG,GAAG,IAAI,IAAJ,GAAW,OAAX,EAAV;;AACA,MAAI,GAAG,IAAI,QAAX,EAAqB;AACjB,IAAA,GAAG,GAAG,QAAQ,GAAG,CAAjB;AACH;;AACD,EAAA,QAAQ,GAAG,GAAX;AACA,SAAO,GAAP;AACH;AAED;AACA;AACA;;;AACO,SAAS,QAAT,GAAmC;AACtC,SAAO,IAAI,OAAJ,CAAY,UAAA,GAAG;AAAA,WAAI,UAAU,CAAC,GAAD,EAAM,CAAN,CAAd;AAAA,GAAf,CAAP;AACH;;AAEM,SAAS,WAAT,GAAoD;AAAA,MAA/B,EAA+B,uEAAlB,CAAkB;AACvD,SAAO,IAAI,OAAJ,CAAY,UAAA,GAAG;AAAA,WAAI,UAAU,CAAC,GAAD,EAAM,EAAN,CAAd;AAAA,GAAf,CAAP;AACH;;AAEM,SAAS,SAAT,CAAsB,YAAtB,EAAgE;AACnE,MAAI,YAAY,IAAI,OAAQ,YAAD,CAAsB,IAA7B,KAAsC,UAA1D,EAAsE;AAClE;AACA,WAAO,YAAP;AACH,GAHD,MAGO;AACH,WAAO,OAAO,CAAC,OAAR,CAAgB,YAAhB,CAAP;AACH;AACJ;;AAEM,IAAM,oBAAmC,GAAG,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAA5C;;AACA,IAAM,qBAAqC,GAAG,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAA9C;;AACA,IAAM,oBAAmC,GAAG,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAA5C;;AACA,IAAM,oBAAmC,GAAG,OAAO,CAAC,OAAR,EAA5C;;;AAEA,SAAS,kBAAT,GAA2D;AAAA,MAA/B,OAA+B,uEAAN,IAAM;;AAC9D,MACI,OAAO,MAAP,KAAkB,QAAlB,IACC,MAAD,CAAgB,qBAAhB,CAFJ,EAGE;AACE,WAAO,IAAI,OAAJ,CACH,UAAA,GAAG;AAAA,aAAK,MAAD,CAAgB,qBAAhB,EAAuC,GAAvC,EAA4C;AAC/C,QAAA,OAAO,EAAP;AAD+C,OAA5C,CAAJ;AAAA,KADA,CAAP;AAKH,GATD,MASO;AACH,WAAO,WAAW,CAAC,CAAD,CAAlB;AACH;AACJ;AAGD;AACA;AACA;AACA;AACA;;;AACO,SAAS,aAAT,CACH,KADG,EAEH,OAFG,EAGW;AACd,SAAO,KAAK,CACP,MADE,CAEC,UAAC,OAAD,EAAU,IAAV;AAAA,WAAoB,OAAD,CAAiB,IAAjB,CAAsB,IAAtB,CAAnB;AAAA,GAFD,EAGC,OAAO,CAAC,OAAR,CAAgB,OAAhB,CAHD,CAAP;AAKH;AAED;AACA;AACA;AACA;AACA;;;AACO,SAAS,8BAAT,CAAwC,GAAxC,EAA6D;AAChE,MACI,OAAO,MAAP,KAAkB,QAAlB,IACC,MAAD,CAAgB,qBAAhB,CAFJ,EAGG,MAAD,CAAgB,qBAAhB,EAAuC,GAAvC;AACL;AAED;AACA;AACA;;;AACO,SAAS,OAAT,CAAiB,GAAjB,EAAsC;AACzC,EAAA,GAAG,IAAI,EAAP;AACA,MAAM,CAAC,GAAG,GAAG,CAAC,MAAJ,CAAW,CAAX,EACL,WADK,EAAV;AAEA,SAAO,CAAC,GAAG,GAAG,CAAC,MAAJ,CAAW,CAAX,CAAX;AACH;AAED;AACA;AACA;;;AACO,SAAS,QAAT,CAAkB,GAAlB,EAAuC;AAC1C;AACA,SAAO,GAAG,CAAC,MAAJ,CAAW,CAAX,MAAkB,GAAzB;AACI,IAAA,GAAG,GAAG,GAAG,CAAC,MAAJ,CAAW,CAAX,CAAN;AADJ,GAF0C,CAK1C;;;AACA,SAAO,GAAG,CAAC,KAAJ,CAAU,CAAC,CAAX,MAAkB,GAAzB;AACI,IAAA,GAAG,GAAG,GAAG,CAAC,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAN;AADJ;;AAGA,SAAO,GAAP;AACH;;AAGM,SAAS,cAAT,CAA2B,GAA3B,EAAiE;AACpE,MAAI,CAAC,GAAL,EAAU;AACN,UAAM,IAAI,KAAJ,CAAU,2BAAV,CAAN;AACH;;AACD,SAAO,GAAP;AACH;AAED;AACA;AACA;AACA;;;AACO,SAAS,UAAT,CAAoB,GAApB,EAAwD;AAAA,MAA1B,WAA0B,uEAAZ,KAAY;AAC3D,MAAI,CAAC,GAAL,EAAU,OAAO,GAAP,CADiD,CACrC;AAEtB;;AACA,MAAI,CAAC,WAAD,IAAgB,KAAK,CAAC,OAAN,CAAc,GAAd,CAApB,EAAwC;AACpC,WAAO,GAAG,CACL,IADE,CACG,UAAC,CAAD,EAAI,CAAJ,EAAU;AACZ,UAAI,OAAO,CAAP,KAAa,QAAb,IAAyB,OAAO,CAAP,KAAa,QAA1C,EACI,OAAO,CAAC,CAAC,aAAF,CAAgB,CAAhB,CAAP;AAEJ,UAAI,OAAO,CAAP,KAAa,QAAjB,EAA2B,OAAO,CAAP,CAA3B,KACK,OAAO,CAAC,CAAR;AACR,KAPE,EAQF,GARE,CAQE,UAAA,CAAC;AAAA,aAAI,UAAU,CAAC,CAAD,EAAI,WAAJ,CAAd;AAAA,KARH,CAAP;AASH,GAd0D,CAgB3D;AACA;;;AACA,MAAI,OAAO,GAAP,KAAe,QAAf,IAA2B,CAAC,KAAK,CAAC,OAAN,CAAc,GAAd,CAAhC,EAAoD;AAChD,QAAI,GAAG,YAAY,MAAnB,EACI,OAAO,GAAP;AAEJ,QAAM,GAAQ,GAAG,EAAjB;AACA,IAAA,MAAM,CAAC,IAAP,CAAY,GAAZ,EACK,IADL,CACU,UAAC,CAAD,EAAI,CAAJ;AAAA,aAAU,CAAC,CAAC,aAAF,CAAgB,CAAhB,CAAV;AAAA,KADV,EAEK,OAFL,CAEa,UAAA,GAAG,EAAI;AACZ,MAAA,GAAG,CAAC,GAAD,CAAH,GAAW,UAAU,CAAC,GAAG,CAAC,GAAD,CAAJ,EAAW,WAAX,CAArB;AACH,KAJL;AAKA,WAAO,GAAP;AACH,GA7B0D,CA+B3D;;;AACA,SAAO,GAAP;AACH;AAGD;AACA;AACA;AACA;;;AACO,SAAS,eAAT,CAAyB,GAAzB,EAAsC,KAAtC,EAAkD;AACrD,MAAI,KAAK,YAAY,MAArB,EAA6B;AACzB,WAAO,KAAK,CAAC,QAAN,EAAP;AACH;;AACD,SAAO,KAAP;AACH;AAED;AACA;AACA;AACA;;;AACO,SAAS,iBAAT,GAAwD;AAAA,MAA7B,MAA6B,uEAAZ,EAAY;AAC3D,MAAI,IAAI,GAAG,EAAX;AACA,MAAM,QAAQ,GAAG,4BAAjB;;AAEA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,MAApB,EAA4B,CAAC,EAA7B,EAAiC;AAC7B,IAAA,IAAI,IAAI,QAAQ,CAAC,MAAT,CAAgB,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,MAAL,KAAgB,QAAQ,CAAC,MAApC,CAAhB,CAAR;AACH;;AAED,SAAO,IAAP;AACH;AAED;AACA;AACA;;;AACO,IAAM,aAAa,GAAG,kCAAtB;;;AAGA,SAAS,WAAT,CAAwB,EAAxB,EAAoC;AACvC,SAAO,EAAE,CAAC,EAAE,CAAC,MAAH,GAAY,CAAb,CAAT;AACH;AAED;AACA;AACA;;;AACO,SAAS,YAAT,CAAyB,GAAzB,EAAwC;AAC3C,SAAO,GAAG,CAAC,IAAJ,CAAS;AAAA,WAAO,IAAI,CAAC,MAAL,KAAgB,GAAvB;AAAA,GAAT,CAAP;AACH;AAED;AACA;AACA;AACA;;;AACO,SAAS,UAAT,CAAuB,KAAvB,EAAmC,SAAnC,EAA6D;AAChE,EAAA,KAAK,GAAG,KAAK,CAAC,KAAN,CAAY,CAAZ,CAAR;AACA,MAAM,GAAU,GAAG,EAAnB;;AACA,SAAO,KAAK,CAAC,MAAb,EAAqB;AACjB,QAAM,KAAK,GAAG,KAAK,CAAC,MAAN,CAAa,CAAb,EAAgB,SAAhB,CAAd;AACA,IAAA,GAAG,CAAC,IAAJ,CAAS,KAAT;AACH;;AACD,SAAO,GAAP;AACH;AAGD;AACA;AACA;;;AACO,SAAS,2BAAT,CAAwC,EAAxC,EAAiD,SAAjD,EAAoF;AACvF,EAAA,EAAE,GAAG,EAAE,CAAC,KAAH,EAAL;AACA,MAAI,CAAC,GAAG,EAAE,CAAC,MAAX;AACA,MAAI,IAAI,GAAG,KAAX;;AACA,SAAO,CAAC,MAAM,CAAC,IAAf,EAAqB;AACjB,QAAI,SAAS,CAAC,EAAE,CAAC,CAAD,CAAH,CAAb,EAAsB;AAClB,MAAA,IAAI,GAAG,IAAP;AACA,MAAA,EAAE,CAAC,MAAH,CAAU,CAAV,EAAa,CAAb;AACH;AACJ;;AACD,SAAO,EAAP;AACH;AAGD;AACA;AACA;;;AACO,SAAS,aAAT,CAAuB,OAAvB,EAA0C;AAC7C,MAAI,UAAe,GAAG;AAClB,IAAA,EAAE,EAAE;AADc,GAAtB;;AAGA,MAAI,OAAO,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,IAAA,UAAU,GAAG;AACT,MAAA,OAAO,EAAP;AADS,KAAb;AAGH;;AACD,SAAO,UAAP;AACH;;AAGD,SAAS,iBAAT,CAA8B,CAA9B,EAA+D;AAC3D,MAAI,CAAC,CAAL,EAAQ,OAAO,CAAP;AACR,SAAO,uBAAU,CAAV,EAAa,KAAb,CAAP;AACH;;AACM,IAAM,KAAK,GAAG,iBAAd;AAEP;AACA;AACA;AACA;AACA;;;;AACO,SAAS,SAAT,CAAsB,GAAtB,EAAyD;AAC5D,SAAO,MAAM,CAAC,MAAP,CAAc,EAAd,EAAkB,GAAlB,CAAP;AACH;AAED;AACA;AACA;;;AACO,SAAS,yBAAT,CAAmC,GAAnC,EAAqD;AACxD,SAAO,GAAG,CAAC,MAAM,CAAC,IAAP,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAAV;AACH;;AAGM,IAAM,kBAAkB,GAAG,6BAA3B;AAGP;AACA;AACA;AACA;;;;AACO,SAAS,aAAT,CAAuB,EAAvB,EAAgC;AACnC,MAAM,QAAa,GAAG,EAAtB;;AAEA,OAAK,IAAM,CAAX,IAAgB,EAAhB,EAAoB;AAChB,QAAI,CAAC,EAAE,CAAC,cAAH,CAAkB,CAAlB,CAAL,EAA2B;;AAE3B,QAAK,OAAO,EAAE,CAAC,CAAD,CAAV,KAAmB,QAAvB,EAAiC;AAC7B,UAAM,UAAU,GAAG,aAAa,CAAC,EAAE,CAAC,CAAD,CAAH,CAAhC;;AACA,WAAK,IAAM,EAAX,IAAgB,UAAhB,EAA4B;AACxB,YAAI,CAAC,UAAU,CAAC,cAAX,CAA0B,EAA1B,CAAL,EAAmC;AAEnC,QAAA,QAAQ,CAAC,CAAC,GAAG,GAAJ,GAAU,EAAX,CAAR,GAAwB,UAAU,CAAC,EAAD,CAAlC;AACH;AACJ,KAPD,MAOO;AACH,MAAA,QAAQ,CAAC,CAAD,CAAR,GAAc,EAAE,CAAC,CAAD,CAAhB;AACH;AACJ;;AACD,SAAO,QAAP;AACH;;AAGM,SAAS,aAAT,CAAuB,QAAvB,EAA2E;AAC9E,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAT,CAAe,GAAf,CAAd;AACA,SAAO;AACH,IAAA,MAAM,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAD,CAAN,EAAW,EAAX,CADb;AAEH,IAAA,IAAI,EAAE,KAAK,CAAC,CAAD;AAFR,GAAP;AAIH;;AAEM,SAAS,mBAAT,CAA6B,QAA7B,EAAuD;AAC1D,SAAO,aAAa,CAAC,QAAD,CAAb,CAAwB,MAA/B;AACH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAAS,cAAT,CAAwB,OAAxB,EAA8C;AACjD,MAAM,aAAa,GAAG,MAAM,CAAC,MAAP,CAAc,EAAd,EAAkB,OAAlB,EAA2B;AAC7C,IAAA,SAAS,EAAE;AADkC,GAA3B,CAAtB;AAIA,MAAM,aAAa,GAAG,IAAI,CAAC,SAAL,CAAe,aAAf,CAAtB;AACA,SAAO,oBAAI,IAAJ,CAAS,aAAT,CAAP;AACH;AAED;AACA;AACA;AACA;;;AACO,SAAS,yBAAT,CACH,GADG,EAEH,UAFG,EAGH,KAHG,EAIM;AACT,EAAA,MAAM,CAAC,cAAP,CAAsB,GAAtB,EAA2B,UAA3B,EAAuC;AACnC,IAAA,GAAG,EAAE,eAAY;AAAE,aAAO,KAAP;AAAe;AADC,GAAvC;AAGA,SAAO,KAAP;AACH;AAED;AACA;AACA;;;AACO,SAAS,YAAT,CAAsB,IAAtB,EAAoC;AACvC;AACA,MACI,IAAI,CAAC,QAAL,CAAc,GAAd,KAAsB;AACtB,EAAA,IAAI,CAAC,QAAL,CAAc,IAAd,CAFJ,CAEwB;AAFxB,IAGE;AACE,WAAO,IAAP;AACH,GALD,MAKO;AACH,WAAO,KAAP;AACH;AACJ;;AAEM,SAAS,iBAAT,CAAiC,GAAjC,EAAmE,GAAnE,EAA8E;AACjF,MAAM,GAAG,GAAG,GAAG,CAAC,GAAJ,CAAQ,GAAR,CAAZ;;AACA,MAAI,CAAC,GAAL,EAAU;AACN,UAAM,IAAI,KAAJ,CAAU,4BAA4B,GAAtC,CAAN;AACH;;AACD,SAAO,GAAP;AACH;;AAEM,IAAM,cAAc,GAAG;AAC1B;AACJ;AACA;AACA;AACI,EAAA,gBAL0B,4BAMtB,IANsB,EAOtB,IAPsB,EAQZ;AACV,QAAI,UAAJ;;AACA,QAAI,kBAAJ,EAAwB;AACpB;AACA,aAAO,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB;AACrB,QAAA,IAAI,EAAJ;AADqB,OAAlB,CAAP;AAGH;;AAED,QAAI;AACA;AACA,MAAA,UAAU,GAAG,IAAI,IAAJ,CAAS,CAAC,IAAD,CAAT,EAAiB;AAC1B,QAAA,IAAI,EAAJ;AAD0B,OAAjB,CAAb;AAGH,KALD,CAKE,OAAO,CAAP,EAAU;AACR;AACA,MAAA,UAAU,GAAG,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB;AAC3B,QAAA,IAAI,EAAJ;AAD2B,OAAlB,CAAb;AAGH;;AAED,WAAO,UAAP;AACH,GA9ByB;AA+B1B,EAAA,YA/B0B,wBA+Bb,IA/Ba,EA+BO;AAC7B,QAAK,OAAO,MAAP,KAAkB,WAAlB,IAAiC,MAAM,CAAC,QAAP,CAAgB,IAAhB,CAAlC,IAA4D,IAAI,YAAY,IAAhF,EAAsF;AAClF,aAAO,IAAP;AACH,KAFD,MAEO;AACH,aAAO,KAAP;AACH;AACJ,GArCyB;AAsC1B,EAAA,QAtC0B,oBAsCjB,UAtCiB,EAsCwB;AAC9C,QAAI,OAAO,MAAP,KAAkB,WAAlB,IAAiC,UAAU,YAAY,MAA3D,EAAmE;AAC/D;AACA,aAAO,QAAQ,GACV,IADE,CACG;AAAA,eAAM,UAAU,CAAC,QAAX,EAAN;AAAA,OADH,CAAP;AAEH;;AACD,WAAO,IAAI,OAAJ,CAAY,UAAA,GAAG,EAAI;AACtB;AACA,UAAM,MAAM,GAAG,IAAI,UAAJ,EAAf;AACA,MAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,UAAA,CAAC,EAAI;AACpC,YAAM,IAAI,GAAI,CAAC,CAAC,MAAH,CAAkB,MAA/B;AACA,QAAA,GAAG,CAAC,IAAD,CAAH;AACH,OAHD;AAKA,UAAM,cAAc,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAjB,CAA0B,IAA1B,CAA+B,UAA/B,CAAvB;AAEA;AACZ;AACA;AACA;AACA;;AACY,UAAI,cAAc,KAAK,qBAAvB,EAA8C;AAC1C,QAAA,UAAU,GAAG,IAAI,IAAJ,CAAS,CAAC,UAAD,CAAT,CAAb;AACH;;AAED,MAAA,MAAM,CAAC,UAAP,CAAkB,UAAlB;AACH,KApBM,CAAP;AAqBH;AAjEyB,CAAvB","file":"util.js","sourcesContent":["import type { BlobBuffer, DeepReadonlyObject } from './types';\nimport {\n    default as deepClone\n} from 'clone';\n\n/**\n * Returns an error that indicates that a plugin is missing\n * We do not throw a RxError because this should not be handled\n * programmatically but by using the correct import\n */\nexport function pluginMissing(\n    pluginKey: string\n): Error {\n    const keyParts = pluginKey.split('-');\n    let pluginName = 'RxDB';\n    keyParts.forEach(part => {\n        pluginName += ucfirst(part);\n    });\n    pluginName += 'Plugin';\n    return new Error(\n        `You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { ${pluginName} } from 'rxdb/plugins/${pluginKey}';\n            addRxPlugin(${pluginName});\n        `\n    );\n}\n\n/**\n * this is a very fast hashing but its unsecure\n * @link http://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript-jquery\n * @return a number as hash-result\n */\nexport function fastUnsecureHash(obj: any): number {\n    if (typeof obj !== 'string') obj = JSON.stringify(obj);\n    let hashValue = 0,\n        i, chr, len;\n    if (obj.length === 0) return hashValue;\n    for (i = 0, len = obj.length; i < len; i++) {\n        chr = obj.charCodeAt(i);\n        // tslint:disable-next-line\n        hashValue = ((hashValue << 5) - hashValue) + chr;\n        // tslint:disable-next-line\n        hashValue |= 0; // Convert to 32bit integer\n    }\n    if (hashValue < 0) hashValue = hashValue * -1;\n    return hashValue;\n}\n\n/**\n * Does a RxDB-specific hashing of the given data.\n * We use a static salt so using a rainbow-table\n * or google-ing the hash will not work.\n *\n * spark-md5 is used here\n * because pouchdb uses the same\n * and build-size could be reduced by 9kb\n */\nimport Md5 from 'spark-md5';\nexport const RXDB_HASH_SALT = 'rxdb-specific-hash-salt';\nexport function hash(msg: string | any): string {\n    if (typeof msg !== 'string') {\n        msg = JSON.stringify(msg);\n    }\n    return Md5.hash(RXDB_HASH_SALT + msg);\n}\n\n/**\n * Returns the current unix time in milliseconds\n * Because the accuracy of getTime() in javascript is bad,\n * and we cannot rely on performance.now() on all plattforms,\n * this method implements a way to never return the same value twice.\n * This ensures that when now() is called often, we do not loose the information\n * about which call came first and which came after.\n * Caution: Do not call this too often in a short timespan\n * because it might return 'the future'\n */\nlet _lastNow: number = 0;\n/**\n * Returns the current time in milliseconds,\n * also ensures to not return the same value twice.\n */\nexport function now(): number {\n    let ret = new Date().getTime();\n    if (ret <= _lastNow) {\n        ret = _lastNow + 1;\n    }\n    _lastNow = ret;\n    return ret;\n}\n\n/**\n * returns a promise that resolves on the next tick\n */\nexport function nextTick(): Promise<void> {\n    return new Promise(res => setTimeout(res, 0));\n}\n\nexport function promiseWait(ms: number = 0): Promise<void> {\n    return new Promise(res => setTimeout(res, ms));\n}\n\nexport function toPromise<T>(maybePromise: Promise<T> | T): Promise<T> {\n    if (maybePromise && typeof (maybePromise as any).then === 'function') {\n        // is promise\n        return maybePromise as any;\n    } else {\n        return Promise.resolve(maybePromise);\n    }\n}\n\nexport const PROMISE_RESOLVE_TRUE: Promise<true> = Promise.resolve(true);\nexport const PROMISE_RESOLVE_FALSE: Promise<false> = Promise.resolve(false);\nexport const PROMISE_RESOLVE_NULL: Promise<null> = Promise.resolve(null);\nexport const PROMISE_RESOLVE_VOID: Promise<void> = Promise.resolve();\n\nexport function requestIdlePromise(timeout: number | null = null) {\n    if (\n        typeof window === 'object' &&\n        (window as any)['requestIdleCallback']\n    ) {\n        return new Promise(\n            res => (window as any)['requestIdleCallback'](res, {\n                timeout\n            })\n        );\n    } else {\n        return promiseWait(0);\n    }\n}\n\n\n/**\n * like Promise.all() but runs in series instead of parallel\n * @link https://github.com/egoist/promise.series/blob/master/index.js\n * @param tasks array with functions that return a promise\n */\nexport function promiseSeries(\n    tasks: Function[],\n    initial?: any\n): Promise<any[]> {\n    return tasks\n        .reduce(\n            (current, next) => (current as any).then(next),\n            Promise.resolve(initial)\n        );\n}\n\n/**\n * run the callback if requestIdleCallback available\n * do nothing if not\n * @link https://developer.mozilla.org/de/docs/Web/API/Window/requestIdleCallback\n */\nexport function requestIdleCallbackIfAvailable(fun: Function): void {\n    if (\n        typeof window === 'object' &&\n        (window as any)['requestIdleCallback']\n    ) (window as any)['requestIdleCallback'](fun);\n}\n\n/**\n * uppercase first char\n */\nexport function ucfirst(str: string): string {\n    str += '';\n    const f = str.charAt(0)\n        .toUpperCase();\n    return f + str.substr(1);\n}\n\n/**\n * removes trailing and ending dots from the string\n */\nexport function trimDots(str: string): string {\n    // start\n    while (str.charAt(0) === '.')\n        str = str.substr(1);\n\n    // end\n    while (str.slice(-1) === '.')\n        str = str.slice(0, -1);\n\n    return str;\n}\n\n\nexport function ensureNotFalsy<T>(obj: T | false | undefined | null): T {\n    if (!obj) {\n        throw new Error('ensureNotFalsy() is falsy');\n    }\n    return obj;\n}\n\n/**\n * deep-sort an object so its attributes are in lexical order.\n * Also sorts the arrays inside of the object if no-array-sort not set\n */\nexport function sortObject(obj: any, noArraySort = false): any {\n    if (!obj) return obj; // do not sort null, false or undefined\n\n    // array\n    if (!noArraySort && Array.isArray(obj)) {\n        return obj\n            .sort((a, b) => {\n                if (typeof a === 'string' && typeof b === 'string')\n                    return a.localeCompare(b);\n\n                if (typeof a === 'object') return 1;\n                else return -1;\n            })\n            .map(i => sortObject(i, noArraySort));\n    }\n\n    // object\n    // array is also of type object\n    if (typeof obj === 'object' && !Array.isArray(obj)) {\n        if (obj instanceof RegExp)\n            return obj;\n\n        const out: any = {};\n        Object.keys(obj)\n            .sort((a, b) => a.localeCompare(b))\n            .forEach(key => {\n                out[key] = sortObject(obj[key], noArraySort);\n            });\n        return out;\n    }\n\n    // everything else\n    return obj;\n}\n\n\n/**\n * used to JSON.stringify() objects that contain a regex\n * @link https://stackoverflow.com/a/33416684 thank you Fabian Jakobs!\n */\nexport function stringifyFilter(key: string, value: any) {\n    if (value instanceof RegExp) {\n        return value.toString();\n    }\n    return value;\n}\n\n/**\n * get a random string which can be used with couchdb\n * @link http://stackoverflow.com/a/1349426/3443137\n */\nexport function randomCouchString(length: number = 10): string {\n    let text = '';\n    const possible = 'abcdefghijklmnopqrstuvwxyz';\n\n    for (let i = 0; i < length; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\n/**\n * A random string that is never inside of any storage\n */\nexport const RANDOM_STRING = 'Fz7SZXPmYJujkzjY1rpXWvlWBqoGAfAX';\n\n\nexport function lastOfArray<T>(ar: T[]): T {\n    return ar[ar.length - 1];\n}\n\n/**\n * shuffle the given array\n */\nexport function shuffleArray<T>(arr: T[]): T[] {\n    return arr.sort(() => (Math.random() - 0.5));\n}\n\n/**\n * Split array with items into smaller arrays with items\n * @link https://stackoverflow.com/a/7273794/3443137\n */\nexport function batchArray<T>(array: T[], batchSize: number): T[][] {\n    array = array.slice(0);\n    const ret: T[][] = [];\n    while (array.length) {\n        const batch = array.splice(0, batchSize);\n        ret.push(batch);\n    }\n    return ret;\n}\n\n\n/**\n * @link https://stackoverflow.com/a/15996017\n */\nexport function removeOneFromArrayIfMatches<T>(ar: T[], condition: (x: T) => boolean): T[] {\n    ar = ar.slice();\n    let i = ar.length;\n    let done = false;\n    while (i-- && !done) {\n        if (condition(ar[i])) {\n            done = true;\n            ar.splice(i, 1);\n        }\n    }\n    return ar;\n}\n\n\n/**\n * transforms the given adapter into a pouch-compatible object\n */\nexport function adapterObject(adapter: any): any {\n    let adapterObj: any = {\n        db: adapter\n    };\n    if (typeof adapter === 'string') {\n        adapterObj = {\n            adapter\n        };\n    }\n    return adapterObj;\n}\n\n\nfunction recursiveDeepCopy<T>(o: T | DeepReadonlyObject<T>): T {\n    if (!o) return o;\n    return deepClone(o, false) as any;\n}\nexport const clone = recursiveDeepCopy;\n\n/**\n * does a flat copy on the objects,\n * is about 3 times faster then using deepClone\n * @link https://jsperf.com/object-rest-spread-vs-clone/2\n */\nexport function flatClone<T>(obj: T | DeepReadonlyObject<T>): T {\n    return Object.assign({}, obj) as any;\n}\n\n/**\n * @link https://stackoverflow.com/a/11509718/3443137\n */\nexport function firstPropertyNameOfObject(obj: any): string {\n    return obj[Object.keys(obj)[0]];\n}\n\nimport isElectron from 'is-electron';\nexport const isElectronRenderer = isElectron();\n\n\n/**\n * returns a flattened object\n * @link https://gist.github.com/penguinboy/762197\n */\nexport function flattenObject(ob: any) {\n    const toReturn: any = {};\n\n    for (const i in ob) {\n        if (!ob.hasOwnProperty(i)) continue;\n\n        if ((typeof ob[i]) === 'object') {\n            const flatObject = flattenObject(ob[i]);\n            for (const x in flatObject) {\n                if (!flatObject.hasOwnProperty(x)) continue;\n\n                toReturn[i + '.' + x] = flatObject[x];\n            }\n        } else {\n            toReturn[i] = ob[i];\n        }\n    }\n    return toReturn;\n}\n\n\nexport function parseRevision(revision: string): { height: number; hash: string } {\n    const split = revision.split('-');\n    return {\n        height: parseInt(split[0], 10),\n        hash: split[1]\n    }\n}\n\nexport function getHeightOfRevision(revision: string): number {\n    return parseRevision(revision).height;\n}\n\n/**\n * Creates a revision string that does NOT include the revision height\n * Copied and adapted from pouchdb-utils/src/rev.js\n * \n * We use our own function so RxDB usage without pouchdb RxStorage\n * does not include pouchdb code in the bundle.\n */\nexport function createRevision(docData: any): string {\n    const docWithoutRev = Object.assign({}, docData, {\n        _rev_tree: undefined\n    });\n\n    const diggestString = JSON.stringify(docWithoutRev);\n    return Md5.hash(diggestString);\n}\n\n/**\n * overwrites the getter with the actual value\n * Mostly used for caching stuff on the first run\n */\nexport function overwriteGetterForCaching<ValueType = any>(\n    obj: any,\n    getterName: string,\n    value: ValueType\n): ValueType {\n    Object.defineProperty(obj, getterName, {\n        get: function () { return value; }\n    });\n    return value;\n}\n\n/**\n * returns true if the given name is likely a folder path\n */\nexport function isFolderPath(name: string) {\n    // do not check, if foldername is given\n    if (\n        name.includes('/') || // unix\n        name.includes('\\\\') // windows\n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nexport function getFromMapOrThrow<K, V>(map: Map<K, V> | WeakMap<any, V>, key: K): V {\n    const val = map.get(key);\n    if (!val) {\n        throw new Error('missing value from map ' + key);\n    }\n    return val;\n}\n\nexport const blobBufferUtil = {\n    /**\n     * depending if we are on node or browser,\n     * we have to use Buffer(node) or Blob(browser)\n     */\n    createBlobBuffer(\n        data: string,\n        type: string\n    ): BlobBuffer {\n        let blobBuffer: any;\n        if (isElectronRenderer) {\n            // if we are inside of electron-renderer, always use the node-buffer\n            return Buffer.from(data, {\n                type\n            } as any);\n        }\n\n        try {\n            // for browsers\n            blobBuffer = new Blob([data], {\n                type\n            } as any);\n        } catch (e) {\n            // for node\n            blobBuffer = Buffer.from(data, {\n                type\n            } as any);\n        }\n\n        return blobBuffer;\n    },\n    isBlobBuffer(data: any): boolean {\n        if ((typeof Buffer !== 'undefined' && Buffer.isBuffer(data)) || data instanceof Blob) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n    toString(blobBuffer: BlobBuffer): Promise<string> {\n        if (typeof Buffer !== 'undefined' && blobBuffer instanceof Buffer) {\n            // node\n            return nextTick()\n                .then(() => blobBuffer.toString());\n        }\n        return new Promise(res => {\n            // browsers\n            const reader = new FileReader();\n            reader.addEventListener('loadend', e => {\n                const text = (e.target as any).result;\n                res(text);\n            });\n\n            const blobBufferType = Object.prototype.toString.call(blobBuffer);\n\n            /**\n             * in the electron-renderer we have a typed array insteaf of a blob\n             * so we have to transform it.\n             * @link https://github.com/pubkey/rxdb/issues/1371\n             */\n            if (blobBufferType === '[object Uint8Array]') {\n                blobBuffer = new Blob([blobBuffer]);\n            }\n\n            reader.readAsText(blobBuffer as any);\n        });\n    }\n};\n"]}