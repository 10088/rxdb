{"version":3,"file":"plugin.js","names":["PROTOTYPES","RxSchema","prototype","RxDocument","RxDocumentPrototype","RxQuery","RxQueryBase","RxCollection","RxCollectionBase","RxDatabase","RxDatabaseBase","ADDED_PLUGINS","Set","addRxPlugin","plugin","runPluginHooks","plugins","has","add","rxdb","newRxTypeError","init","prototypes","Object","entries","forEach","name","fun","overwritable","assign","hooks","hooksObj","after","HOOKS","push","before","unshift"],"sources":["../../src/plugin.ts"],"sourcesContent":["/**\n * this handles how plugins are added to rxdb\n * basically it changes the internal prototypes\n * by passing them to the plugins-functions\n */\nimport {\n    RxSchema\n} from './rx-schema';\nimport {\n    basePrototype as RxDocumentPrototype\n} from './rx-document';\nimport {\n    RxQueryBase\n} from './rx-query';\nimport {\n    RxCollectionBase\n} from './rx-collection';\nimport {\n    RxDatabaseBase\n} from './rx-database';\nimport type {\n    RxPlugin\n} from './types';\n\nimport { overwritable } from './overwritable';\nimport {\n    HOOKS,\n    runPluginHooks\n} from './hooks';\nimport { newRxTypeError } from './rx-error';\n\n/**\n * prototypes that can be manipulated with a plugin\n */\nconst PROTOTYPES: { [k: string]: any } = {\n    RxSchema: RxSchema.prototype,\n    RxDocument: RxDocumentPrototype,\n    RxQuery: RxQueryBase.prototype,\n    RxCollection: RxCollectionBase.prototype,\n    RxDatabase: RxDatabaseBase.prototype\n};\n\nconst ADDED_PLUGINS: Set<RxPlugin | any> = new Set();\n\n/**\n * Add a plugin to the RxDB library.\n * Plugins are added globally and cannot be removed.\n */\nexport function addRxPlugin(plugin: RxPlugin) {\n    runPluginHooks('preAddRxPlugin', { plugin, plugins: ADDED_PLUGINS });\n\n    // do nothing if added before\n    if (ADDED_PLUGINS.has(plugin)) {\n        return;\n    } else {\n        ADDED_PLUGINS.add(plugin);\n    }\n\n    /**\n     * Since version 10.0.0 we decoupled pouchdb from\n     * the rxdb core. Therefore pouchdb plugins must be added\n     * with the addPouchPlugin() method of the pouchdb plugin.\n     */\n    if (!plugin.rxdb) {\n        throw newRxTypeError('PL1', {\n            plugin\n        });\n    }\n\n    if (plugin.init) {\n        plugin.init();\n    }\n\n    // prototype-overwrites\n    if (plugin.prototypes) {\n        Object\n            .entries(plugin.prototypes)\n            .forEach(([name, fun]) => {\n                return (fun as any)(PROTOTYPES[name]);\n            });\n    }\n    // overwritable-overwrites\n    if (plugin.overwritable) {\n        Object.assign(\n            overwritable,\n            plugin.overwritable\n        );\n    }\n    // extend-hooks\n    if (plugin.hooks) {\n        Object\n            .entries(plugin.hooks)\n            .forEach(([name, hooksObj]) => {\n                if (hooksObj.after) {\n                    HOOKS[name].push(hooksObj.after)\n                }\n                if (hooksObj.before) {\n                    HOOKS[name].unshift(hooksObj.before)\n                }\n            });\n    }\n}\n"],"mappings":";;;;;;AAKA;AAGA;AAGA;AAGA;AAGA;AAOA;AACA;AAIA;AA7BA;AACA;AACA;AACA;AACA;;AA2BA;AACA;AACA;AACA,IAAMA,UAAgC,GAAG;EACrCC,QAAQ,EAAEA,kBAAQ,CAACC,SAAS;EAC5BC,UAAU,EAAEC,yBAAmB;EAC/BC,OAAO,EAAEC,oBAAW,CAACJ,SAAS;EAC9BK,YAAY,EAAEC,8BAAgB,CAACN,SAAS;EACxCO,UAAU,EAAEC,0BAAc,CAACR;AAC/B,CAAC;AAED,IAAMS,aAAkC,GAAG,IAAIC,GAAG,EAAE;;AAEpD;AACA;AACA;AACA;AACO,SAASC,WAAW,CAACC,MAAgB,EAAE;EAC1C,IAAAC,qBAAc,EAAC,gBAAgB,EAAE;IAAED,MAAM,EAANA,MAAM;IAAEE,OAAO,EAAEL;EAAc,CAAC,CAAC;;EAEpE;EACA,IAAIA,aAAa,CAACM,GAAG,CAACH,MAAM,CAAC,EAAE;IAC3B;EACJ,CAAC,MAAM;IACHH,aAAa,CAACO,GAAG,CAACJ,MAAM,CAAC;EAC7B;;EAEA;AACJ;AACA;AACA;AACA;EACI,IAAI,CAACA,MAAM,CAACK,IAAI,EAAE;IACd,MAAM,IAAAC,uBAAc,EAAC,KAAK,EAAE;MACxBN,MAAM,EAANA;IACJ,CAAC,CAAC;EACN;EAEA,IAAIA,MAAM,CAACO,IAAI,EAAE;IACbP,MAAM,CAACO,IAAI,EAAE;EACjB;;EAEA;EACA,IAAIP,MAAM,CAACQ,UAAU,EAAE;IACnBC,MAAM,CACDC,OAAO,CAACV,MAAM,CAACQ,UAAU,CAAC,CAC1BG,OAAO,CAAC,gBAAiB;MAAA,IAAfC,IAAI;QAAEC,GAAG;MAChB,OAAQA,GAAG,CAAS3B,UAAU,CAAC0B,IAAI,CAAC,CAAC;IACzC,CAAC,CAAC;EACV;EACA;EACA,IAAIZ,MAAM,CAACc,YAAY,EAAE;IACrBL,MAAM,CAACM,MAAM,CACTD,0BAAY,EACZd,MAAM,CAACc,YAAY,CACtB;EACL;EACA;EACA,IAAId,MAAM,CAACgB,KAAK,EAAE;IACdP,MAAM,CACDC,OAAO,CAACV,MAAM,CAACgB,KAAK,CAAC,CACrBL,OAAO,CAAC,iBAAsB;MAAA,IAApBC,IAAI;QAAEK,QAAQ;MACrB,IAAIA,QAAQ,CAACC,KAAK,EAAE;QAChBC,YAAK,CAACP,IAAI,CAAC,CAACQ,IAAI,CAACH,QAAQ,CAACC,KAAK,CAAC;MACpC;MACA,IAAID,QAAQ,CAACI,MAAM,EAAE;QACjBF,YAAK,CAACP,IAAI,CAAC,CAACU,OAAO,CAACL,QAAQ,CAACI,MAAM,CAAC;MACxC;IACJ,CAAC,CAAC;EACV;AACJ"}