{"version":3,"file":"rx-document.js","names":["body","recover","result","e","then","pact","state","value","s","v","o","bind","observer","prototype","onFulfilled","onRejected","callback","_this","thenable","test","update","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","basePrototype","_data","isInstanceOfRxDocument","undefined","_dataSync$","getValue","primaryPath","collection","schema","primary","revision","_rev","deleted$","_isDeleted$","asObservable","deleted","$","pipe","map","docData","overwritable","deepFreezeWhenDevMode","_handleChangeEvent","changeEvent","documentId","getDocumentDataOfRxChangeEvent","newRevNr","getHeightOfRevision","currentRevNr","operation","newData","documentData","next","_docCache","get$","path","includes","newRxError","finalFields","schemaObj","getSchemaByObjectPath","jsonSchema","data","objectPath","get","distinctUntilChanged","populate","PROMISE_RESOLVE_NULL","ref","refCollection","database","collections","type","findByIds","res","valuesIterator","values","Array","from","findOne","exec","objPath","valueObj","isArray","clone","defineGetterSetter","toJSON","withMetaFields","flatClone","_attachments","_deleted","_meta","toMutableJSON","set","_isTemporary","newRxTypeError","Object","is","pathEls","split","pop","rootPath","join","childpath","_updateObj","pluginMissing","putAttachment","getAttachment","allAttachments","allAttachments$","atomicUpdate","mutationFunction","Promise","rej","_atomicQueue","done","_saveData","oldData","err","useError","parameters","error","isConflict","isBulkWriteConflictError","createRevision","documentInDb","fillObjectWithDefaults","atomicPatch","patch","entries","forEach","k","id","document","assign","isDevMode","validateChange","_runHooks","validate","storageInstance","bulkWrite","previous","writeResult","isError","throwIfIsStorageWriteError","save","insert","remove","deletedData","ensureNotFalsy","success","destroy","createRxDocumentConstructor","proto","constructor","RxDocumentConstructor","jsonData","BehaviorSubject","PROMISE_RESOLVE_VOID","thisObj","pathProperties","properties","keys","key","fullPath","trimDots","__defineGetter__","ret","defineProperty","enumerable","configurable","__defineSetter__","val","createWithConstructor","startsWith","doc","runPluginHooks","isRxDocument","obj"],"sources":["../../src/rx-document.ts"],"sourcesContent":["import objectPath from 'object-path';\nimport {\n    Observable,\n    BehaviorSubject\n} from 'rxjs';\nimport {\n    distinctUntilChanged,\n    map\n} from 'rxjs/operators';\nimport {\n    clone,\n    trimDots,\n    getHeightOfRevision,\n    pluginMissing,\n    flatClone,\n    PROMISE_RESOLVE_NULL,\n    PROMISE_RESOLVE_VOID,\n    ensureNotFalsy,\n    createRevision\n} from './util';\nimport {\n    newRxError,\n    newRxTypeError,\n    isBulkWriteConflictError\n} from './rx-error';\nimport {\n    runPluginHooks\n} from './hooks';\n\nimport type {\n    RxDocument,\n    RxCollection,\n    RxDocumentData,\n    RxDocumentWriteData,\n    RxChangeEvent\n} from './types';\nimport { getDocumentDataOfRxChangeEvent } from './rx-change-event';\nimport { overwritable } from './overwritable';\nimport { getSchemaByObjectPath } from './rx-schema-helper';\nimport { throwIfIsStorageWriteError } from './rx-storage-helper';\n\nexport const basePrototype = {\n\n    /**\n     * TODO\n     * instead of appliying the _this-hack\n     * we should make these accesors functions instead of getters.\n     */\n    get _data() {\n        const _this: RxDocument = this as any;\n        /**\n         * Might be undefined when vuejs-devtools are used\n         * @link https://github.com/pubkey/rxdb/issues/1126\n         */\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n\n        return _this._dataSync$.getValue();\n    },\n    get primaryPath() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this.collection.schema.primaryPath;\n    },\n    get primary() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return (_this._data as any)[_this.primaryPath];\n    },\n    get revision() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._data._rev;\n    },\n    get deleted$() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._isDeleted$.asObservable();\n    },\n    get deleted() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._isDeleted$.getValue();\n    },\n\n    /**\n     * returns the observable which emits the plain-data of this document\n     */\n    get $(): Observable<any> {\n        const _this: RxDocument = this as any;\n        return _this._dataSync$.asObservable().pipe(\n            map(docData => overwritable.deepFreezeWhenDevMode(docData))\n        );\n    },\n\n    _handleChangeEvent(this: RxDocument, changeEvent: RxChangeEvent<any>) {\n        if (changeEvent.documentId !== this.primary) {\n            return;\n        }\n\n        // ensure that new _rev is higher then current\n        const docData = getDocumentDataOfRxChangeEvent(changeEvent);\n        const newRevNr = getHeightOfRevision(docData._rev);\n        const currentRevNr = getHeightOfRevision(this._data._rev);\n        if (currentRevNr > newRevNr) return;\n\n        switch (changeEvent.operation) {\n            case 'INSERT':\n                break;\n            case 'UPDATE':\n                const newData = changeEvent.documentData;\n                this._dataSync$.next(newData);\n                break;\n            case 'DELETE':\n                // remove from docCache to assure new upserted RxDocuments will be a new instance\n                this.collection._docCache.delete(this.primary);\n                this._isDeleted$.next(true);\n                break;\n        }\n    },\n\n    /**\n     * returns observable of the value of the given path\n     */\n    get$(this: RxDocument, path: string): Observable<any> {\n        if (path.includes('.item.')) {\n            throw newRxError('DOC1', {\n                path\n            });\n        }\n\n        if (path === this.primaryPath)\n            throw newRxError('DOC2');\n\n        // final fields cannot be modified and so also not observed\n        if (this.collection.schema.finalFields.includes(path)) {\n            throw newRxError('DOC3', {\n                path\n            });\n        }\n\n        const schemaObj = getSchemaByObjectPath(\n            this.collection.schema.jsonSchema,\n            path\n        );\n        if (!schemaObj) {\n            throw newRxError('DOC4', {\n                path\n            });\n        }\n\n        return this._dataSync$\n            .pipe(\n                map(data => objectPath.get(data, path)),\n                distinctUntilChanged()\n            );\n    },\n\n    /**\n     * populate the given path\n     */\n    populate(this: RxDocument, path: string): Promise<RxDocument | null> {\n        const schemaObj = getSchemaByObjectPath(\n            this.collection.schema.jsonSchema,\n            path\n        );\n        const value = this.get(path);\n        if (!value) {\n            return PROMISE_RESOLVE_NULL;\n        }\n        if (!schemaObj) {\n            throw newRxError('DOC5', {\n                path\n            });\n        }\n        if (!schemaObj.ref) {\n            throw newRxError('DOC6', {\n                path,\n                schemaObj\n            });\n        }\n\n        const refCollection: RxCollection = this.collection.database.collections[schemaObj.ref];\n        if (!refCollection) {\n            throw newRxError('DOC7', {\n                ref: schemaObj.ref,\n                path,\n                schemaObj\n            });\n        }\n\n        if (schemaObj.type === 'array') {\n            return refCollection.findByIds(value).then(res => {\n                const valuesIterator = res.values();\n                return Array.from(valuesIterator) as any;\n            });\n        } else {\n            return refCollection.findOne(value).exec();\n        }\n    },\n\n    /**\n     * get data by objectPath\n     */\n    get(this: RxDocument, objPath: string): any | null {\n        if (!this._data) return undefined;\n        let valueObj = objectPath.get(this._data, objPath);\n\n        // direct return if array or non-object\n        if (\n            typeof valueObj !== 'object' ||\n            Array.isArray(valueObj)\n        ) {\n            return overwritable.deepFreezeWhenDevMode(valueObj);\n        }\n\n        /**\n         * TODO find a way to deep-freeze together with defineGetterSetter\n         * so we do not have to do a deep clone here.\n         */\n        valueObj = clone(valueObj);\n        defineGetterSetter(\n            this.collection.schema,\n            valueObj,\n            objPath,\n            this as any\n        );\n        return valueObj;\n    },\n\n    toJSON(this: RxDocument, withMetaFields = false) {\n        if (!withMetaFields) {\n            const data = flatClone(this._data);\n            delete (data as any)._rev;\n            delete (data as any)._attachments;\n            delete (data as any)._deleted;\n            delete (data as any)._meta;\n            return overwritable.deepFreezeWhenDevMode(data);\n        } else {\n            return overwritable.deepFreezeWhenDevMode(this._data);\n        }\n    },\n    toMutableJSON(this: RxDocument, withMetaFields = false) {\n        return clone(this.toJSON(withMetaFields as any));\n    },\n\n    /**\n     * set data by objectPath\n     * This can only be called on temporary documents\n     */\n    set(this: RxDocument, objPath: string, value: any) {\n\n        // setters can only be used on temporary documents\n        if (!this._isTemporary) {\n            throw newRxTypeError('DOC16', {\n                objPath,\n                value\n            });\n        }\n\n        if (typeof objPath !== 'string') {\n            throw newRxTypeError('DOC15', {\n                objPath,\n                value\n            });\n        }\n\n        // if equal, do nothing\n        if (Object.is(this.get(objPath), value)) return;\n\n        // throw if nested without root-object\n        const pathEls = objPath.split('.');\n        pathEls.pop();\n        const rootPath = pathEls.join('.');\n        if (typeof objectPath.get(this._data, rootPath) === 'undefined') {\n            throw newRxError('DOC10', {\n                childpath: objPath,\n                rootPath\n            });\n        }\n\n        objectPath.set(this._data, objPath, value);\n        return this;\n    },\n\n    /**\n     * updates document\n     * @overwritten by plugin (optinal)\n     * @param updateObj mongodb-like syntax\n     */\n    update(_updateObj: any) {\n        throw pluginMissing('update');\n    },\n    putAttachment() {\n        throw pluginMissing('attachments');\n    },\n    getAttachment() {\n        throw pluginMissing('attachments');\n    },\n    allAttachments() {\n        throw pluginMissing('attachments');\n    },\n    get allAttachments$() {\n        throw pluginMissing('attachments');\n    },\n\n\n    /**\n     * runs an atomic update over the document\n     * @param function that takes the document-data and returns a new data-object\n     */\n    atomicUpdate(this: RxDocument, mutationFunction: Function): Promise<RxDocument> {\n        return new Promise((res, rej) => {\n            this._atomicQueue = this\n                ._atomicQueue\n                .then(async () => {\n                    let done = false;\n                    // we need a hacky while loop to stay incide the chain-link of _atomicQueue\n                    // while still having the option to run a retry on conflicts\n                    while (!done) {\n                        const oldData = this._dataSync$.getValue();\n                        // always await because mutationFunction might be async\n                        let newData;\n\n                        try {\n                            newData = await mutationFunction(\n                                clone(oldData),\n                                this\n                            );\n                            if (this.collection) {\n                                newData = this.collection.schema.fillObjectWithDefaults(newData);\n                            }\n                        } catch (err) {\n                            rej(err);\n                            return;\n                        }\n\n                        try {\n                            await this._saveData(newData, oldData);\n                            done = true;\n                        } catch (err: any) {\n                            const useError = err.parameters && err.parameters.error ? err.parameters.error : err;\n                            /**\n                             * conflicts cannot happen by just using RxDB in one process\n                             * There are two ways they still can appear which is\n                             * replication and multi-tab usage\n                             * Because atomicUpdate has a mutation function,\n                             * we can just re-run the mutation until there is no conflict\n                             */\n                            const isConflict = isBulkWriteConflictError(useError as any);\n                            if (isConflict) {\n                                // conflict error -> retrying\n                                newData._rev = createRevision(newData, isConflict.documentInDb);\n                            } else {\n                                rej(useError);\n                                return;\n                            }\n                        }\n                    }\n                    res(this);\n                });\n        });\n    },\n\n\n    /**\n     * patches the given properties\n     */\n    atomicPatch<RxDocumentType = any>(\n        this: RxDocument<RxDocumentType>,\n        patch: Partial<RxDocumentType>\n    ): Promise<RxDocument<RxDocumentType>> {\n        return this.atomicUpdate((docData: RxDocumentType) => {\n            Object\n                .entries(patch)\n                .forEach(([k, v]) => {\n                    (docData as any)[k] = v;\n                });\n            return docData;\n        });\n    },\n\n    /**\n     * saves the new document-data\n     * and handles the events\n     */\n    async _saveData<RxDocumentType>(\n        this: RxDocument<RxDocumentType>,\n        newData: RxDocumentWriteData<RxDocumentType>,\n        oldData: RxDocumentData<RxDocumentType>\n    ): Promise<void> {\n        newData = flatClone(newData);\n\n        // deleted documents cannot be changed\n        if (this._isDeleted$.getValue()) {\n            throw newRxError('DOC11', {\n                id: this.primary,\n                document: this\n            });\n        }\n\n        /**\n         * Meta values must always be merged\n         * instead of overwritten.\n         * This ensures that different plugins do not overwrite\n         * each others meta properties.\n         */\n        newData._meta = Object.assign(\n            {},\n            oldData._meta,\n            newData._meta\n        );\n\n        // ensure modifications are ok\n        if (overwritable.isDevMode()) {\n            this.collection.schema.validateChange(oldData, newData);\n        }\n\n        await this.collection._runHooks('pre', 'save', newData, this);\n        newData._rev = createRevision(newData, oldData);\n        this.collection.schema.validate(newData);\n\n        const writeResult = await this.collection.storageInstance.bulkWrite([{\n            previous: oldData,\n            document: newData\n        }]);\n\n        const isError = writeResult.error[this.primary];\n        throwIfIsStorageWriteError(this.collection, this.primary, newData, isError);\n\n        return this.collection._runHooks('post', 'save', newData, this);\n    },\n\n    /**\n     * saves the temporary document and makes a non-temporary out of it\n     * Saving a temporary doc is basically the same as RxCollection.insert()\n     * @return false if nothing to save\n     */\n    save(this: RxDocument): Promise<boolean> {\n        // .save() cannot be called on non-temporary-documents\n        if (!this._isTemporary) {\n            throw newRxError('DOC17', {\n                id: this.primary,\n                document: this\n            });\n        }\n\n        return this.collection.insert(this)\n            .then(() => {\n                this._isTemporary = false;\n                this.collection._docCache.set(this.primary, this);\n\n                // internal events\n                this._dataSync$.next(this._data);\n\n                return true;\n            });\n    },\n\n    /**\n     * remove the document,\n     * this not not equal to a pouchdb.remove(),\n     * instead we keep the values and only set _deleted: true\n     */\n    remove(this: RxDocument): Promise<RxDocument> {\n        const collection = this.collection;\n        if (this.deleted) {\n            return Promise.reject(newRxError('DOC13', {\n                document: this,\n                id: this.primary\n            }));\n        }\n\n        const deletedData = flatClone(this._data);\n        return collection._runHooks('pre', 'remove', deletedData, this)\n            .then(async () => {\n                deletedData._deleted = true;\n                deletedData._rev = createRevision(deletedData, this._data);\n\n                const writeResult = await collection.storageInstance.bulkWrite([{\n                    previous: this._data,\n                    document: deletedData\n                }]);\n                const isError = writeResult.error[this.primary];\n                throwIfIsStorageWriteError(collection, this.primary, deletedData, isError);\n                return ensureNotFalsy(writeResult.success[this.primary]);\n            })\n            .then(() => {\n                return this.collection._runHooks('post', 'remove', deletedData, this);\n            })\n            .then(() => this);\n    },\n    destroy() {\n        throw newRxError('DOC14');\n    }\n};\n\nexport function createRxDocumentConstructor(proto = basePrototype) {\n    const constructor = function RxDocumentConstructor(\n        this: RxDocument,\n        collection: RxCollection,\n        jsonData: any\n    ) {\n        this.collection = collection;\n\n        // if true, this is a temporary document\n        this._isTemporary = false;\n\n        // assume that this is always equal to the doc-data in the database\n        this._dataSync$ = new BehaviorSubject(jsonData);\n        this._isDeleted$ = new BehaviorSubject(false) as any;\n\n        this._atomicQueue = PROMISE_RESOLVE_VOID;\n\n        /**\n         * because of the prototype-merge,\n         * we can not use the native instanceof operator\n         */\n        this.isInstanceOfRxDocument = true;\n    };\n    constructor.prototype = proto;\n    return constructor;\n}\n\nexport function defineGetterSetter(\n    schema: any,\n    valueObj: any,\n    objPath = '',\n    thisObj = false\n) {\n    if (valueObj === null) return;\n\n\n    let pathProperties = getSchemaByObjectPath(\n        schema.jsonSchema,\n        objPath\n    );\n\n    if (typeof pathProperties === 'undefined') return;\n    if (pathProperties.properties) pathProperties = pathProperties.properties;\n\n    Object.keys(pathProperties)\n        .forEach(key => {\n            const fullPath = trimDots(objPath + '.' + key);\n\n            // getter - value\n            valueObj.__defineGetter__(\n                key,\n                function (this: RxDocument) {\n                    const _this: RxDocument = thisObj ? thisObj : (this as any);\n                    if (!_this.get || typeof _this.get !== 'function') {\n                        /**\n                         * When an object gets added to the state of a vuejs-component,\n                         * it happens that this getter is called with another scope.\n                         * To prevent errors, we have to return undefined in this case\n                         */\n                        return undefined;\n                    }\n                    const ret = _this.get(fullPath);\n                    return ret;\n                }\n            );\n            // getter - observable$\n            Object.defineProperty(valueObj, key + '$', {\n                get: function () {\n                    const _this = thisObj ? thisObj : this;\n                    return _this.get$(fullPath);\n                },\n                enumerable: false,\n                configurable: false\n            });\n            // getter - populate_\n            Object.defineProperty(valueObj, key + '_', {\n                get: function () {\n                    const _this = thisObj ? thisObj : this;\n                    return _this.populate(fullPath);\n                },\n                enumerable: false,\n                configurable: false\n            });\n            // setter - value\n            valueObj.__defineSetter__(key, function (\n                this: RxDocument,\n                val: any\n            ) {\n                const _this: any = thisObj ? thisObj : this;\n                return _this.set(fullPath, val);\n            });\n        });\n}\n\nexport function createWithConstructor<RxDocType>(\n    constructor: any,\n    collection: RxCollection<RxDocType>,\n    jsonData: RxDocumentData<RxDocType>\n): RxDocument<RxDocType> | null {\n    const primary: string = jsonData[collection.schema.primaryPath] as any;\n    if (\n        primary &&\n        primary.startsWith('_design')\n    ) {\n        return null;\n    }\n\n    const doc = new constructor(collection, jsonData);\n    runPluginHooks('createRxDocument', doc);\n    return doc;\n}\n\nexport function isRxDocument(obj: any): boolean {\n    if (typeof obj === 'undefined') return false;\n    return !!obj.isInstanceOfRxDocument;\n}\n"],"mappings":"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"}